import{r as p,j as c,o as l,c as d,a as r,t as b,E as _,b as C,d as n,h as j,v as E,F as M,f}from"./app-4f3951ff.js";const T={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 border-b pb-4 mb-4 dark:border-gray-700"},H={class:"flex items-center gap-3 mb-1"},I={class:"text-xl font-bold text-gray-800 dark:text-gray-200"},P={class:"text-xs text-gray-500 dark:text-gray-400"},q={key:0},A={class:"flex flex-wrap items-center gap-2"},G={key:1,class:"inline-flex items-center gap-2 text-sm px-3 py-1 rounded-full ring-1 ring-gray-200 dark:ring-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300"},J={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},K={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-md shadow-xl"},O={class:"space-y-4"},Q={key:0,class:"text-rose-600 text-sm mt-3"},R={class:"flex justify-end gap-2 mt-5"},Y={__name:"SubtaskHeader",props:["subtask","user"],emits:["refresh","startWork"],setup(o,{emit:D}){const a=o,y=D,g=p(!1),v=p(!1),x=p(""),i=p({title:"",due_date:""}),$=c(()=>{var k,m;const s=a.subtask,e=a.user;if(!s||!e)return!1;const t=((k=s.task)==null?void 0:k.project)||{};return(s.executors||[]).some(u=>u.id===e.id)||(s.responsibles||[]).some(u=>u.id===e.id)||(t.executors||[]).some(u=>u.id===e.id)||(t.managers||[]).some(u=>u.id===e.id)||((m=t.company)==null?void 0:m.user_id)===e.id||s.creator_id===e.id}),V=c(()=>$.value&&a.subtask.progress===100&&!a.subtask.completed),B=c(()=>a.subtask.completed||a.subtask.status==="in_work"?!1:(a.subtask.executors||[]).some(e=>{var t;return e.id===((t=a.user)==null?void 0:t.id)})),h=c(()=>{var e,t,k,m,u,S;const s=(e=a.user)==null?void 0:e.id;return s?s===a.subtask.creator_id||s===((m=(k=(t=a.subtask.task)==null?void 0:t.project)==null?void 0:k.company)==null?void 0:m.user_id)||(((S=(u=a.subtask.task)==null?void 0:u.project)==null?void 0:S.managers)||[]).some(L=>L.id===s):!1}),F=c(()=>{var s,e;return h.value||(((e=(s=a.subtask.task)==null?void 0:s.project)==null?void 0:e.executors)||[]).some(t=>t.id===a.user.id)}),w=c(()=>a.subtask.completed?{text:"‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞",class:"bg-emerald-100 text-emerald-700"}:a.subtask.status==="in_work"?{text:"‚öôÔ∏è –í —Ä–∞–±–æ—Ç–µ",class:"bg-blue-100 text-blue-700 ring-1 ring-blue-200"}:{text:"üÜï –ù–æ–≤–∞—è",class:"bg-gray-100 text-gray-600 ring-1 ring-gray-200"}),N=async()=>{confirm("–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á—É?")&&(await f.patch(`/api/subtasks/${a.subtask.id}/complete`),y("refresh"))},U=async()=>{var s,e;if(confirm("–£–¥–∞–ª–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á—É?"))try{await f.delete(`/api/subtasks/${a.subtask.id}`,{withCredentials:!0}),alert("–ü–æ–¥–∑–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞"),window.history.back()}catch(t){alert(((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"–û—à–∏–±–∫–∞")}},W=()=>{i.value.title=a.subtask.title,i.value.due_date=a.subtask.due_date,g.value=!0},z=async()=>{var s,e;v.value=!0,x.value="";try{await f.patch(`/api/subtasks/${a.subtask.id}/update`,i.value),y("refresh"),g.value=!1}catch(t){x.value=(e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message}finally{v.value=!1}};return(s,e)=>(l(),d(M,null,[r("div",T,[r("div",null,[r("div",H,[r("h2",I,b(o.subtask.title),1),r("span",{class:_(["px-2.5 py-0.5 text-xs rounded-full font-bold shadow-sm",w.value.class])},b(w.value.text),3)]),r("div",P,[C(" –°—Ä–æ–∫: "+b(new Date(o.subtask.due_date).toLocaleDateString())+" ",1),o.subtask.completed_at?(l(),d("span",q,"‚Ä¢ –ó–∞–≤–µ—Ä—à–µ–Ω–∞: "+b(new Date(o.subtask.completed_at).toLocaleString()),1)):n("",!0)])]),r("div",A,[B.value?(l(),d("button",{key:0,onClick:e[0]||(e[0]=t=>s.$emit("startWork",o.subtask.id)),class:"px-4 py-1.5 bg-sky-500 hover:bg-sky-600 text-white text-sm font-semibold rounded-md shadow-sm transition flex items-center gap-1"}," üöÄ –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É ")):n("",!0),o.subtask.completed?n("",!0):(l(),d("span",G,[r("span",{class:_(["w-2 h-2 rounded-full",{"bg-red-500":(o.subtask.progress??0)<30,"bg-amber-500":(o.subtask.progress??0)>=30&&(o.subtask.progress??0)<70,"bg-green-500":(o.subtask.progress??0)>=70}])},null,2),C(" "+b(o.subtask.progress??0)+"% ",1)])),V.value?(l(),d("button",{key:2,onClick:N,class:"px-3 py-1.5 rounded-md bg-emerald-600 text-white text-sm hover:bg-emerald-700 font-medium"}," ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å ")):n("",!0),F.value?(l(),d("button",{key:3,onClick:W,class:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-md"}," ‚úèÔ∏è –ò–∑–º. ")):n("",!0),h.value?(l(),d("button",{key:4,onClick:U,class:"px-3 py-1.5 bg-rose-600 hover:bg-rose-700 text-white text-sm rounded-md"}," üóë ")):n("",!0)])]),g.value?(l(),d("div",J,[r("div",K,[e[4]||(e[4]=r("h3",{class:"text-lg font-semibold dark:text-white mb-4"},"‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á—É",-1)),r("div",O,[j(r("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>i.value.title=t),class:"w-full border rounded-lg p-2 dark:bg-gray-700 dark:text-white",placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ"},null,512),[[E,i.value.title]]),j(r("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>i.value.due_date=t),type:"date",class:"w-full border rounded-lg p-2 dark:bg-gray-700 dark:text-white"},null,512),[[E,i.value.due_date]])]),x.value?(l(),d("p",Q,b(x.value),1)):n("",!0),r("div",R,[r("button",{onClick:e[3]||(e[3]=t=>g.value=!1),class:"px-4 py-2 border rounded-lg text-gray-600"},"–û—Ç–º–µ–Ω–∞"),r("button",{onClick:z,class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg"},"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")])])])):n("",!0)],64))}};export{Y as default};
