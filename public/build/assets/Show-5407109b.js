import{V as G,r as o,j as p,x as H,o as V,c as B,k as l,u as w,H as L,F as Q,f as v,Z as T,a as r,d as W}from"./app-2097a917.js";import{_ as Z}from"./AuthenticatedLayout-9323830d.js";import q from"./CompanyHero-789232e5.js";import z from"./ProjectGrid-20a84a31.js";import D from"./ProjectDurationChart-ee308b39.js";import J from"./TaskProgressChart-864ff48f.js";import K from"./CreateProjectModal-59d1d95a.js";import R from"./CompanyMembersModal-f52bcc20.js";import"./ApplicationLogo-fb32f1dc.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./install-a952193e.js";import"./index-2e56f616.js";const U={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12"},X={key:0,class:"space-y-8"},Y={class:"grid grid-cols-1 xl:grid-cols-2 gap-8"},ee={id:"task-stats-section"},ve={__name:"Show",setup(ae){const{props:i}=G(),m=i.id,f=o(!0),n=o(null),j=o([]),d=o(!1),g=o(!1),y=o(!1),_=o(""),x=o(!1),k=o(null),C=o([]),h=o(!1),$=p(()=>{var a,e,s;return((a=n.value)==null?void 0:a.user_id)===((s=(e=i.auth)==null?void 0:e.user)==null?void 0:s.id)}),S=p(()=>{var a,e;return(e=(a=n.value)==null?void 0:a.users)==null?void 0:e.some(s=>{var t,c,u;return s.id===((c=(t=i.auth)==null?void 0:t.user)==null?void 0:c.id)&&((u=s.pivot)==null?void 0:u.role)==="manager"})}),I=p(()=>$.value||S.value),N=p(()=>{var a,e;return(e=(a=i.auth)==null?void 0:a.roles)==null?void 0:e.includes("admin")}),b=async()=>{f.value=!0;try{const{data:a}=await v.get(`/api/companies/${m}`);n.value=a}catch(a){console.error(a)}finally{f.value=!1}},E=async()=>{const{data:a}=await v.get(`/api/users/managers?company_id=${m}`);j.value=a},F=async a=>{var s;const e=n.value.projects.find(t=>t.name===a);if(e){k.value=e,h.value=!0;try{const{data:t}=await v.get(`/api/projects/${e.id}/task-stats`);C.value=t}finally{h.value=!1}(s=document.getElementById("task-stats-section"))==null||s.scrollIntoView({behavior:"smooth"})}},O=async()=>{_.value="",await E(),d.value=!0},A=async a=>{var e,s;y.value=!0;try{await v.post("/api/projects",{...a,company_id:m}),d.value=!1,await b()}catch(t){_.value=((s=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:s.message)||"Ошибка создания"}finally{y.value=!1}};return H(()=>{b(),x.value=window.innerWidth<768}),(a,e)=>{var s;return V(),B(Q,null,[l(w(T),{title:((s=n.value)==null?void 0:s.name)||"Компания"},null,8,["title"]),l(Z,null,{default:L(()=>{var t,c,u,M;return[r("div",U,[l(q,{company:n.value,"is-owner":$.value,"is-admin":N.value,"can-create":I.value,onCreate:O,onOpenMembers:e[0]||(e[0]=P=>g.value=!0)},null,8,["company","is-owner","is-admin","can-create"]),l(z,{projects:(t=n.value)==null?void 0:t.projects,loading:f.value},null,8,["projects","loading"]),!x.value&&((u=(c=n.value)==null?void 0:c.projects)!=null&&u.length)?(V(),B("div",X,[e[3]||(e[3]=r("div",{class:"flex items-center gap-4"},[r("div",{class:"h-px flex-1 bg-slate-200 dark:bg-slate-700"}),r("h2",{class:"text-xl font-bold text-slate-400 uppercase tracking-widest"},"Аналитика"),r("div",{class:"h-px flex-1 bg-slate-200 dark:bg-slate-700"})],-1)),r("div",Y,[l(D,{projects:n.value.projects,onProjectClick:F},null,8,["projects"]),r("div",ee,[l(J,{stats:C.value,loading:h.value,"project-name":(M=k.value)==null?void 0:M.name},null,8,["stats","loading","project-name"])])])])):W("",!0)]),l(K,{show:d.value,managers:j.value,loading:y.value,error:_.value,"current-user-id":w(i).auth.user.id,onClose:e[1]||(e[1]=P=>d.value=!1),onSubmit:A},null,8,["show","managers","loading","error","current-user-id"]),l(R,{show:g.value,"company-id":w(m),onClose:e[2]||(e[2]=P=>g.value=!1)},null,8,["show","company-id"])]}),_:1})],64)}}};export{ve as default};
