import{h as b,c as E,o as a,a as o,b as e,g as v,F as S,d as V,t as p,w as M,v as T,H as z,f as D,G as W,j as L,P as A}from"./app-5e745d3f.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";const P={class:"mt-4 bg-white dark:bg-slate-800 p-4 rounded-xl shadow relative"},q={key:0,class:"text-gray-500 text-sm"},G={key:1,class:"space-y-4 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar"},J={class:"flex justify-between items-start mb-1"},K={class:"flex items-center gap-2"},O={class:"text-sm text-gray-900 dark:text-gray-100"},Q={class:"text-xs text-gray-500"},X={class:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity"},Y=["onClick"],Z={key:0,class:"mb-2 pl-2 border-l-2 border-indigo-300 dark:border-indigo-600"},ee={class:"text-xs text-indigo-600 dark:text-indigo-400 font-medium"},te={class:"text-xs text-gray-500 dark:text-gray-400 truncate italic"},se={key:1},ae={class:"mt-2 flex gap-2"},oe=["onClick"],le={key:2},ne=["innerHTML"],re={key:2,class:"mt-4 relative"},de={key:0,class:"flex items-center justify-between bg-indigo-50 dark:bg-slate-700/50 border border-indigo-100 dark:border-slate-600 rounded-t-lg px-3 py-2 text-xs mb-[-1px] z-10 relative"},ie={class:"flex flex-col overflow-hidden mr-2"},ue={class:"font-semibold text-indigo-700 dark:text-indigo-300"},ce={class:"truncate text-gray-500 dark:text-gray-400 max-w-xs italic"},pe=["placeholder"],ge={key:1,class:"absolute bottom-full left-0 mb-1 bg-white dark:bg-slate-700 border dark:border-slate-600 rounded-lg shadow-xl p-0 max-h-40 overflow-auto z-50 w-64"},me=["onClick"],be={class:"mt-2 flex justify-end"},ve=["disabled"],xe={__name:"SubtaskComments",props:{subtaskId:Number,comments:Array,canWrite:Boolean,members:{type:Array,default:()=>[]}},emits:["updated"],setup(d,{emit:U}){const k=d,$=U,c=b(""),y=b(null),x=b(""),h=b(!1),u=b(""),j=b(0),g=b(null),_=b(null),R=i=>{g.value=i,W(()=>{var n;(n=_.value)==null||n.focus()})},N=()=>{g.value=null},B=i=>{const n=i.target.value;c.value=n;const m=i.target.selectionStart;j.value=m;const f=n.slice(0,m).match(/@([\p{L}\d_]*)$/u);f?(u.value=f[1].toLowerCase(),h.value=!0):h.value=!1},r=E(()=>u.value?k.members.filter(i=>i.name.toLowerCase().includes(u.value)):k.members),s=i=>{const n=j.value,m=c.value,f=`@${i.name.replace(/\s+/g,"_")}`,C=m.slice(0,n).replace(/@([\p{L}\d_]*)$/u,f+" "),w=m.slice(n);c.value=C+w,h.value=!1,u.value="",W(()=>{_.value&&(_.value.focus(),_.value.selectionStart=_.value.selectionEnd=C.length)})},t=i=>i?i.replace(/@([\p{L}\d_]+)/gu,(n,m)=>`<span class="mention text-indigo-600 bg-indigo-50 px-1 rounded font-semibold">@${m.replace(/_/g," ")}</span>`):"",I=async()=>{if(!c.value.trim())return;const n=(c.value.match(/@([\p{L}\d_]+)/gu)||[]).map(l=>{const C=l.substring(1).replace(/_/g," ");return k.members.find(w=>w.name===C)}).filter(Boolean).map(l=>l.id),m={comment:c.value,mentions:n,parent_id:g.value?g.value.id:null};try{const{data:l}=await L.post(`/api/subtasks/${k.subtaskId}/comments`,m);$("updated",{type:"add",comment:l}),c.value="",N()}catch(l){console.error(l),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ")}},H=async i=>{if(!x.value.trim())return;const{data:n}=await L.patch(`/api/subtask-comments/${i}`,{comment:x.value});$("updated",{type:"update",comment:n}),y.value=null,x.value=""};return(i,n)=>{var m;return a(),o("div",P,[n[5]||(n[5]=e("h3",{class:"text-lg font-semibold mb-3 dark:text-white"},"üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏",-1)),!d.comments||d.comments.length===0?(a(),o("p",q," –ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. ")):v("",!0),d.comments&&d.comments.length?(a(),o("div",G,[(a(!0),o(S,null,V(d.comments,l=>{var f,C;return a(),o("div",{key:l.id,class:"group p-3 border dark:border-slate-700 rounded-lg bg-gray-50/50 dark:bg-slate-700/30"},[e("div",J,[e("div",K,[e("strong",O,p(((f=l.user)==null?void 0:f.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"),1),e("span",Q,p(new Date(l.created_at).toLocaleString("ru-RU")),1)]),e("div",X,[d.canWrite?(a(),o("button",{key:0,onClick:w=>R(l),class:"text-xs text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 flex items-center gap-1",title:"–û—Ç–≤–µ—Ç–∏—Ç—å"},n[3]||(n[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"9 17 4 12 9 7"}),e("path",{d:"M20 18v-2a4 4 0 0 0-4-4H4"})],-1)]),8,Y)):v("",!0)])]),l.parent?(a(),o("div",Z,[e("div",ee,p((C=l.parent.user)==null?void 0:C.name)+": ",1),e("div",te,p(l.parent.comment),1)])):v("",!0),y.value===l.id?(a(),o("div",se,[M(e("textarea",{"onUpdate:modelValue":n[0]||(n[0]=w=>x.value=w),class:"w-full border rounded-lg px-2 py-1 mt-2 dark:bg-slate-700 dark:text-white dark:border-slate-600",rows:"2"},null,512),[[T,x.value]]),e("div",ae,[e("button",{onClick:w=>H(l.id),class:"px-3 py-1 bg-green-600 text-white rounded-lg text-xs"},"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",8,oe),e("button",{onClick:n[1]||(n[1]=w=>y.value=null),class:"px-3 py-1 bg-gray-400 text-white rounded-lg text-xs"},"–û—Ç–º–µ–Ω–∞")])])):(a(),o("div",le,[e("p",{class:"text-sm text-gray-800 dark:text-gray-200 whitespace-pre-line leading-relaxed",innerHTML:t(l.comment)},null,8,ne)]))])}),128))])):v("",!0),d.canWrite?(a(),o("div",re,[g.value?(a(),o("div",de,[e("div",ie,[e("span",ue," –í –æ—Ç–≤–µ—Ç "+p((m=g.value.user)==null?void 0:m.name),1),e("span",ce,p(g.value.comment),1)]),e("button",{onClick:N,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"}," ‚úï ")])):v("",!0),M(e("textarea",{id:"subtask-comment-input",ref_key:"textareaRef",ref:_,"onUpdate:modelValue":n[2]||(n[2]=l=>c.value=l),onInput:B,onClick:B,placeholder:g.value?"–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç...":"–ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (@ –¥–ª—è —É–ø–æ–º–∏–Ω–∞–Ω–∏—è)...",class:z(["w-full border px-3 py-2 dark:bg-slate-700 dark:text-white dark:border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all",g.value?"rounded-b-lg border-t-0":"rounded-lg"]),rows:"3"},null,42,pe),[[T,c.value]]),h.value&&r.value.length?(a(),o("div",ge,[(a(!0),o(S,null,V(r.value,l=>(a(),o("div",{key:l.id,class:"px-3 py-2 cursor-pointer hover:bg-indigo-50 dark:hover:bg-slate-600 text-sm border-b dark:border-slate-600 last:border-0 flex items-center gap-2 text-gray-800 dark:text-gray-200",onClick:f=>s(l)},[n[4]||(n[4]=e("span",{class:"font-bold text-indigo-500"},"@",-1)),D(" "+p(l.name),1)],8,me))),128))])):v("",!0),e("div",be,[e("button",{onClick:I,disabled:!c.value.trim(),class:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-50 text-sm font-medium transition-colors"},p(g.value?"‚û§ –û—Ç–≤–µ—Ç–∏—Ç—å":"‚û§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å"),9,ve)])])):v("",!0)])}}},Ee=F(xe,[["__scopeId","data-v-34d1812f"]]),ke={class:"mt-6 p-4 bg-white dark:bg-slate-800 rounded-xl shadow"},ye={key:0,class:"text-gray-500 text-sm"},he={key:1,class:"space-y-3"},fe={class:"flex items-start gap-3 w-full"},_e=["checked","onChange"],we={class:"flex-1"},$e={class:"flex gap-2 items-center mt-1"},Ce={key:0,class:"text-xs text-gray-500 bg-gray-100 dark:bg-slate-600 px-1.5 py-0.5 rounded"},Ie={key:1,class:"text-[10px] text-gray-400"},Me={key:0,class:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity ml-2"},Le=["onClick"],Se=["onClick"],Ve={key:2,class:"mt-4 border-t pt-4 dark:border-slate-700"},je={class:"flex gap-2 mt-2"},Ne=["value"],Be={key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Te={class:"bg-white dark:bg-slate-800 p-6 rounded-lg w-96 shadow-xl"},Ue=["value"],Re={class:"flex justify-end gap-2"},ze={__name:"SubtaskChecklist",props:{subtaskId:Number,checklist:{type:Array,default:()=>[]},executors:{type:Array,default:()=>[]},responsibles:{type:Array,default:()=>[]},canWrite:Boolean,userId:{type:Number,required:!0}},emits:["updated"],setup(d,{emit:U}){const k=d,$=U,c=E(()=>k.checklist??[]),y=b(""),x=b(null),h=b(!1),u=b({id:null,title:"",responsible_id:null}),j=r=>{u.value={id:r.id,title:r.title,responsible_id:r.responsible_id},h.value=!0},g=async()=>{var r,s;if(u.value.title.trim())try{const{data:t}=await L.put(`/api/subtask-checklist/${u.value.id}`,{title:u.value.title,responsible_id:u.value.responsible_id});$("updated",{type:"update",item:t}),h.value=!1}catch(t){alert(((s=(r=t.response)==null?void 0:r.data)==null?void 0:s.message)||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è")}},_=async r=>{var s,t;if(confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç?"))try{await L.delete(`/api/subtask-checklist/${r}`),$("updated",{type:"delete",id:r})}catch(I){alert(((t=(s=I.response)==null?void 0:s.data)==null?void 0:t.message)||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è")}},R=async()=>{if(y.value.trim())try{const{data:r}=await L.post(`/api/subtasks/${k.subtaskId}/checklist`,{title:y.value,responsible_id:x.value});$("updated",{type:"add",item:r}),y.value="",x.value=null}catch(r){console.error(r)}},N=async r=>{try{const{data:s}=await L.patch(`/api/subtask-checklist/${r.id}/toggle`);$("updated",{type:"toggle",id:r.id,completed:s.completed})}catch(s){console.error(s)}},B=r=>k.canWrite?r.creator_id?r.creator_id===k.userId:!0:!1;return(r,s)=>(a(),o("div",ke,[s[9]||(s[9]=e("h3",{class:"text-lg font-semibold mb-3 text-gray-800 dark:text-gray-100"},"üìù –ß–µ–∫-–ª–∏—Å—Ç",-1)),c.value.length===0?(a(),o("p",ye," –ü—É—Å—Ç–æ. ")):(a(),o("div",he,[(a(!0),o(S,null,V(c.value,t=>(a(),o("div",{key:t.id,class:"group p-3 border rounded-lg dark:border-slate-700 flex justify-between items-start bg-gray-50 dark:bg-slate-700/50 hover:bg-white dark:hover:bg-slate-700 transition"},[e("div",fe,[e("input",{type:"checkbox",checked:t.completed,onChange:I=>N(t),class:"mt-1 w-5 h-5 cursor-pointer text-indigo-600 rounded focus:ring-indigo-500"},null,40,_e),e("div",we,[e("p",{class:z(t.completed?"line-through text-gray-400":"text-gray-800 dark:text-gray-200")},p(t.title),3),e("div",$e,[t.responsible?(a(),o("span",Ce," üë§ "+p(t.responsible.name),1)):v("",!0),t.creator?(a(),o("span",Ie," (–°–æ–∑–¥: "+p(t.creator.name)+") ",1)):v("",!0)])])]),B(t)?(a(),o("div",Me,[e("button",{onClick:I=>j(t),class:"text-blue-500 hover:text-blue-700",title:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"}," ‚úèÔ∏è ",8,Le),e("button",{onClick:I=>_(t.id),class:"text-red-500 hover:text-red-700",title:"–£–¥–∞–ª–∏—Ç—å"}," üóëÔ∏è ",8,Se)])):v("",!0)]))),128))])),d.canWrite?(a(),o("div",Ve,[M(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>y.value=t),class:"w-full border rounded-lg px-3 py-2 dark:bg-slate-700 dark:text-white dark:border-slate-600 focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç..."},null,512),[[T,y.value]]),e("div",je,[M(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>x.value=t),class:"flex-1 border rounded-lg px-3 py-2 dark:bg-slate-700 dark:text-white dark:border-slate-600"},[s[5]||(s[5]=e("option",{value:null},"–ë–µ–∑ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ",-1)),(a(!0),o(S,null,V([...d.executors,...d.responsibles],t=>(a(),o("option",{key:t.id,value:t.id},p(t.name),9,Ne))),128))],512),[[A,x.value]]),e("button",{onClick:R,class:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition"}," ‚ûï –î–æ–±–∞–≤–∏—Ç—å ")])])):v("",!0),h.value?(a(),o("div",Be,[e("div",Te,[s[7]||(s[7]=e("h4",{class:"text-lg font-bold mb-4 text-gray-800 dark:text-white"},"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–Ω–∫—Ç",-1)),M(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>u.value.title=t),class:"w-full border rounded mb-3 p-2 dark:bg-slate-700 dark:text-white dark:border-slate-600",placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ"},null,512),[[T,u.value.title]]),s[8]||(s[8]=e("label",{class:"block text-sm text-gray-500 mb-1"},"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π",-1)),M(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>u.value.responsible_id=t),class:"w-full border rounded mb-4 p-2 dark:bg-slate-700 dark:text-white dark:border-slate-600"},[s[6]||(s[6]=e("option",{value:null},"–ë–µ–∑ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ",-1)),(a(!0),o(S,null,V([...d.executors,...d.responsibles],t=>(a(),o("option",{key:t.id,value:t.id},p(t.name),9,Ue))),128))],512),[[A,u.value.responsible_id]]),e("div",Re,[e("button",{onClick:s[4]||(s[4]=t=>h.value=!1),class:"px-3 py-1 text-gray-500 hover:bg-gray-100 dark:hover:bg-slate-700 rounded"}," –û—Ç–º–µ–Ω–∞ "),e("button",{onClick:g,class:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"}," –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ")])])])):v("",!0)]))}};export{Ee as S,ze as _};
