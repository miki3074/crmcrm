import{R as S,h as R,z as $,o as c,a as m,m as u,u as i,M as h,F as C,j as _,Z as B,I,g as N,b as p,f as x}from"./app-5e745d3f.js";import{_ as U}from"./AuthenticatedLayout-8f695d33.js";import V from"./SubtaskHeader-911f685f.js";import j from"./SubtaskMembers-fcaf6de8.js";import F from"./SubtaskProgress-3037c5d0.js";import M from"./SubtaskDescription-1a862bc5.js";import W from"./SubtaskFiles-50fb495a.js";import z from"./SubtaskChildren-8eadad17.js";import{_ as E,S as Q}from"./SubtaskChecklist-cb2ccdf6.js";import"./ApplicationLogo-004ba231.js";import"./_plugin-vue_export-helper-c27b6911.js";const T={class:"max-w-4xl mx-auto py-8 px-4"},Z={key:0,class:"grid gap-6"},q={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},A={key:1,class:"text-gray-600 dark:text-gray-300 text-center py-10"},te={__name:"Show",setup(D){var b;const{props:f}=S(),k=f.id,r=(b=f.auth)==null?void 0:b.user,e=R(null),d=async()=>{try{const{data:s}=await _.get(`/api/subtasks/${k}`);e.value=s}catch(s){console.error("Ошибка загрузки подзадачи",s)}},l=async()=>{await d()},g=({type:s,comment:t,id:o})=>{if(e.value.comments||(e.value.comments=[]),s==="add"&&e.value.comments.push(t),s==="update"){const a=e.value.comments.findIndex(n=>n.id===t.id);a!==-1&&(e.value.comments[a]=t)}s==="delete"&&(e.value.comments=e.value.comments.filter(a=>a.id!==o))},y=s=>{if(e.value.checklist||(e.value.checklist=[]),s.type==="add"&&e.value.checklist.push(s.item),s.type==="toggle"){const t=e.value.checklist.find(o=>o.id===s.id);t&&(t.completed=s.completed)}s.type==="delete"&&(e.value.checklist=e.value.checklist.filter(t=>t.id!==s.id))},v=()=>{var t,o;if(!e.value||!r)return!1;const s=((t=e.value.task)==null?void 0:t.project)||{};return e.value.creator_id===r.id||(s.managers||[]).some(a=>a.id===r.id)||(s.executors||[]).some(a=>a.id===r.id)||((o=s.company)==null?void 0:o.user_id)===r.id||(e.value.executors||[]).some(a=>a.id===r.id)||(e.value.responsibles||[]).some(a=>a.id===r.id)},w=async s=>{var o,a;const t=s||k;if(t)try{const{data:n}=await _.post(`/api/subtasks/${t}/start`);alert("Вы взяли подзадачу в работу!"),await d()}catch(n){console.error(n),alert(((a=(o=n.response)==null?void 0:o.data)==null?void 0:a.message)||"Ошибка")}};return $(d),(s,t)=>(c(),m(C,null,[u(i(B),{title:"Подзадача"}),u(U,null,{header:h(()=>[e.value?(c(),I(V,{key:0,subtask:e.value,user:i(r),onRefresh:l,onStartWork:w},null,8,["subtask","user"])):N("",!0)]),default:h(()=>[p("div",T,[e.value?(c(),m("div",Z,[u(j,{subtask:e.value,user:i(r),onRefresh:l},null,8,["subtask","user"]),u(M,{subtask:e.value,user:i(r),onRefresh:l},null,8,["subtask","user"]),u(F,{subtask:e.value,user:i(r),onRefresh:l},null,8,["subtask","user"]),u(W,{subtask:e.value,user:i(r),onRefresh:l},null,8,["subtask","user"]),u(z,{subtask:e.value,user:i(r),onRefresh:l},null,8,["subtask","user"]),p("div",q,[u(E,{"subtask-id":e.value.id,checklist:e.value.checklist,"user-id":s.$page.props.auth.user.id,executors:e.value.executors,responsibles:e.value.responsibles,"can-write":v(),onUpdated:y},null,8,["subtask-id","checklist","user-id","executors","responsibles","can-write"]),u(Q,{"subtask-id":e.value.id,comments:e.value.comments,"can-write":v(),members:[...e.value.executors??[],...e.value.responsibles??[]],onUpdated:g},null,8,["subtask-id","comments","can-write","members"])])])):(c(),m("div",A,t[0]||(t[0]=[x("Загрузка... ",-1),p("br",null,null,-1),x(" нет доступа к этой задаче ",-1)])))])]),_:1})],64))}};export{te as default};
