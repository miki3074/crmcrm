import{r as g,o as r,f as l,a as C,u as B,w as j,F as x,Z as F,b as t,g as _,x as v,n as h,t as o,j as N,s as L,v as O,i as f}from"./app-b180998f.js";import{_ as J}from"./AuthenticatedLayout-8518e191.js";import"./ApplicationLogo-138a66be.js";import"./_plugin-vue_export-helper-c27b6911.js";const R={class:"flex h-[80vh] mx-auto bg-white dark:bg-slate-900 rounded-2xl shadow-md overflow-hidden border border-slate-200 dark:border-slate-700"},T={class:"w-1/3 border-r border-slate-200 dark:border-slate-700 overflow-y-auto"},W={key:0,class:"text-slate-500 text-center py-10"},z=["onClick"],A={class:"flex justify-between items-center"},E={class:"font-medium text-slate-800 dark:text-slate-100 truncate"},I={class:"text-xs text-slate-400"},Z={class:"text-sm text-slate-600 dark:text-slate-300 truncate mt-1"},q={class:"text-xs text-slate-400 mt-1 block"},G={class:"flex-1 flex flex-col"},H={key:0,class:"flex-1 flex items-center justify-center text-slate-500"},K={key:1,class:"flex flex-col h-full"},P={class:"p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center"},Q={class:"font-semibold text-slate-800 dark:text-slate-100"},X={class:"text-xs text-slate-500"},Y={class:"flex items-center gap-2"},ee=["value"],te={class:"p-4 border-b border-slate-200 dark:border-slate-700"},se={style:{"overflow-wrap":"break-word",width:"58%"},class:"text-sm text-slate-700 dark:text-slate-300"},ae={key:0,class:"mt-2"},re=["href"],le={key:1,class:"mt-3 space-y-2"},oe=["src"],de={key:1,controls:"",class:"rounded-lg max-w-xs border"},ne=["src"],ie=["href"],ue={class:"flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50 dark:bg-slate-800"},ce={class:"text-xs opacity-70 mb-1"},pe={class:"text-sm leading-relaxed"},xe={class:"text-[10px] opacity-70 mt-1 text-right"},me={class:"p-4 border-t border-slate-200 dark:border-slate-700 flex gap-2 bg-white dark:bg-slate-900"},he={__name:"Index",props:{messages:Object,supportUsers:Array},setup(V){const y=V,c=g(JSON.parse(JSON.stringify(y.messages))),a=g(null),m=g({}),D=async d=>{var n;const s=m.value[d];if(!(!s||s.trim()===""))try{const{data:e}=await f.post(`/support/messages/${d}/reply`,{reply:s}),i=e.reply,u=c.value.data.find(b=>b.id===d);u&&u.replies.push(i),((n=a.value)==null?void 0:n.id)===d&&a.value.replies.push(i),m.value[d]=""}catch(e){console.error(e),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞")}},M=async d=>{const s=a.value.newSupport;if(!s)return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞");try{await f.post(`/support/messages/${d}/transfer`,{new_support_id:s}),alert("–û–±—Ä–∞—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω–æ!");const n=c.value.data.find(e=>e.id===d);n&&(n.assigned_support_id=s)}catch(n){console.error(n),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –æ–±—Ä–∞—â–µ–Ω–∏—è")}},U=async d=>{if(!confirm("–ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ?"))return;await f.post(`/support/messages/${d}/close`);const s=c.value.data.find(n=>n.id===d);s&&(s.status="closed")};return(d,s)=>(r(),l(x,null,[C(B(F),{title:"–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞"}),C(J,null,{header:j(()=>s[5]||(s[5]=[t("h2",{class:"font-semibold text-2xl text-slate-800 dark:text-slate-200 flex items-center gap-2"}," üõ† –ü–∞–Ω–µ–ª—å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏ ",-1)])),default:j(()=>{var n;return[t("div",R,[t("div",T,[s[6]||(s[6]=t("div",{class:"p-4 border-b border-slate-200 dark:border-slate-700 font-semibold text-slate-700 dark:text-slate-300"}," –û–±—Ä–∞—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ",-1)),c.value.data.length===0?(r(),l("div",W," –ù–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π. ")):_("",!0),(r(!0),l(x,null,v(c.value.data,e=>{var i;return r(),l("div",{key:e.id,class:h(["p-4 cursor-pointer border-b border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800 transition",((i=a.value)==null?void 0:i.id)===e.id?"bg-blue-50 dark:bg-blue-900/40":""]),onClick:u=>a.value=e},[t("div",A,[t("h3",E,o(e.user.name),1),t("span",I," #"+o(e.id),1)]),t("p",Z,o(e.message),1),t("span",q,o(new Date(e.created_at).toLocaleString()),1)],10,z)}),128))]),t("div",G,[a.value?(r(),l("div",K,[t("div",P,[t("div",null,[t("h3",Q,o(a.value.user.name),1),t("p",X,o(a.value.user.email),1)]),t("div",Y,[N(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>a.value.newSupport=e),class:"border rounded-lg px-2 py-1 text-sm dark:bg-slate-800 dark:text-white"},[s[7]||(s[7]=t("option",{disabled:"",value:""},"–ü–µ—Ä–µ–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ...",-1)),(r(!0),l(x,null,v(y.supportUsers,e=>(r(),l("option",{key:e.id,value:e.id},o(e.name),9,ee))),128))],512),[[L,a.value.newSupport]]),t("button",{onClick:s[1]||(s[1]=e=>M(a.value.id)),class:"px-3 py-1 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700"}," –ü–µ—Ä–µ–¥–∞—Ç—å "),t("button",{onClick:s[2]||(s[2]=e=>U(a.value.id)),class:"px-3 py-1 bg-emerald-600 text-white text-sm rounded-lg hover:bg-emerald-700"}," –ó–∞–≤–µ—Ä—à–∏—Ç—å ")])]),t("div",te,[t("p",se,o(a.value.message),1),a.value.page_url?(r(),l("div",ae,[t("p",{href:a.value.page_url,target:"_blank",class:"text-sm break-all"}," üîó –°—Ç—Ä–∞–Ω–∏—Ü–∞: "+o(a.value.page_url),9,re)])):_("",!0),(n=a.value.attachments)!=null&&n.length?(r(),l("div",le,[(r(!0),l(x,null,v(a.value.attachments,e=>(r(),l("div",{key:e.id,class:"flex items-start gap-3"},[e.mime_type.startsWith("image")?(r(),l("img",{key:0,src:`/storage/${e.path}`,class:"rounded-lg max-w-xs border"},null,8,oe)):e.mime_type.startsWith("video")?(r(),l("video",de,[t("source",{src:`/storage/${e.path}`},null,8,ne)])):(r(),l("a",{key:2,href:`/storage/${e.path}`,target:"_blank",class:"text-blue-600 underline"}," üìé "+o(e.original_name),9,ie))]))),128))])):_("",!0)]),t("div",ue,[(r(!0),l(x,null,v(a.value.replies,e=>{var i,u,b,k,w,$,S;return r(),l("div",{key:e.id,class:h(["flex",(u=(i=e.user)==null?void 0:i.roles)!=null&&u.some(p=>p.name==="support")?"justify-end":"justify-start"])},[t("div",{class:h(["max-w-[70%] px-4 py-3 rounded-2xl shadow-sm transition",(k=(b=e.user)==null?void 0:b.roles)!=null&&k.some(p=>p.name==="support")?"bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-br-none":"bg-slate-200 dark:bg-slate-700 text-slate-900 dark:text-slate-100 rounded-bl-none"]),style:{"overflow-wrap":"break-word"}},[t("p",ce,o(($=(w=e.user)==null?void 0:w.roles)!=null&&$.some(p=>p.name==="support")?"üõ† –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞":(S=e.user)==null?void 0:S.name),1),t("p",pe,o(e.reply),1),t("p",xe,o(new Date(e.created_at).toLocaleTimeString().slice(0,5)),1)],2)],2)}),128))]),t("div",me,[N(t("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>m.value[a.value.id]=e),type:"text",placeholder:"–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç...",class:"flex-1 border rounded-lg px-3 py-2 text-sm dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-blue-500"},null,512),[[O,m.value[a.value.id]]]),t("button",{onClick:s[4]||(s[4]=e=>D(a.value.id)),class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm"}," ‚û§ ")])])):(r(),l("div",H," –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ "))])])]}),_:1})],64))}};export{he as default};
