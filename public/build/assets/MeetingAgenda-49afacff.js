import{K as b,h as w,o as e,a as t,b as s,w as v,v as y,u as m,t as c,F as _,d as j,g as r,f,N as C}from"./app-2ace687b.js";const A={class:"bg-white shadow sm:rounded-lg p-6"},F={key:0,class:"mb-4"},P={key:1,class:"prose bg-gray-50 p-4 rounded mb-4 whitespace-pre-line border"},S={key:2,class:"mt-6 border-t pt-4"},M={key:0,class:"space-y-3"},N={key:0,class:"bg-red-50 p-3 rounded border border-red-100 flex justify-between items-start"},V={class:"flex items-center gap-2 font-bold text-red-700"},B={class:"text-gray-700 mt-1 italic"},$=["onClick"],T={key:1,class:"bg-yellow-50 p-3 rounded text-gray-600"},D={class:"font-bold text-yellow-700"},O={key:2,class:"text-green-700 px-2"},U={key:1,class:"text-sm text-gray-400 italic"},E={key:3,class:"mt-6 border-t pt-4"},I={key:0},K={key:0,class:"mb-3 bg-blue-50 text-blue-800 p-2 rounded text-sm"},L={key:1,class:"flex gap-3"},R={key:2,class:"mt-2 bg-gray-50 p-3 rounded"},q={class:"flex gap-2"},z={key:1,class:"flex items-center justify-between bg-gray-50 p-3 rounded"},G={key:0,class:"text-green-700 font-bold text-sm"},H={key:1,class:"text-red-700 font-bold text-sm"},W={__name:"MeetingAgenda",props:{meeting:Object,canManage:Boolean,myParticipation:Object},setup(d){const u=d,g=b({agenda:u.meeting.agenda||""}),k=()=>{g.put(route("meetings.update",u.meeting.id),{preserveScroll:!0,onSuccess:()=>alert("Повестка сохранена")})},o=b({status:"",comment:""}),i=w(!1),x=()=>{o.status="rejected",i.value=!0},p=l=>{if(o.status=l,l==="approved"&&(o.comment=null),l==="rejected"&&!o.comment){alert("Пожалуйста, напишите, что именно нужно исправить в повестке.");return}o.post(route("meetings.agenda.feedback",u.meeting.id),{preserveScroll:!0,onSuccess:()=>{i.value=!1}})},h=l=>{C.post(route("meetings.agenda.fixed",[u.meeting.id,l]),{},{preserveScroll:!0})};return(l,n)=>(e(),t("div",A,[n[8]||(n[8]=s("h3",{class:"text-lg font-medium leading-6 text-gray-900 mb-4"},"Повестка",-1)),d.canManage&&["scheduled","in_progress","completed"].includes(d.meeting.status)?(e(),t("div",F,[v(s("textarea",{"onUpdate:modelValue":n[0]||(n[0]=a=>m(g).agenda=a),class:"w-full border-gray-300 rounded-md shadow-sm h-32"},null,512),[[y,m(g).agenda]]),s("button",{onClick:k,class:"mt-2 bg-gray-600 text-white px-3 py-1 rounded text-sm"},"Сохранить повестку")])):(e(),t("div",P,c(d.meeting.agenda||"Повестка не заполнена"),1)),d.canManage?(e(),t("div",S,[n[6]||(n[6]=s("h4",{class:"text-sm font-bold text-gray-700 mb-2"},"Отзывы участников:",-1)),d.meeting.participants.some(a=>a.pivot.agenda_status!=="pending")?(e(),t("div",M,[(e(!0),t(_,null,j(d.meeting.participants,a=>(e(),t("div",{key:a.id,class:"text-sm"},[a.pivot.agenda_status==="rejected"?(e(),t("div",N,[s("div",null,[s("div",V,[s("span",null,"✕ "+c(a.name)+":",1)]),s("p",B,'"'+c(a.pivot.agenda_comment)+'"',1)]),s("button",{onClick:J=>h(a.id),class:"ml-4 bg-blue-600 text-white text-xs px-3 py-1 rounded"},"Исправлено",8,$)])):a.pivot.agenda_status==="fixed"?(e(),t("div",T,[s("span",D,"⏳ "+c(a.name),1),n[5]||(n[5]=f(" - ждем подтверждения ",-1))])):a.pivot.agenda_status==="approved"?(e(),t("div",O," ✓ "+c(a.name)+" согласовал ",1)):r("",!0)]))),128))])):(e(),t("div",U,"Пока отзывов нет."))])):r("",!0),d.myParticipation&&d.meeting.status==="scheduled"&&d.meeting.agenda?(e(),t("div",E,[["pending","fixed"].includes(d.myParticipation.pivot.agenda_status)||i.value?(e(),t("div",I,[d.myParticipation.pivot.agenda_status==="fixed"&&!i.value?(e(),t("div",K,n[7]||(n[7]=[s("strong",null,"Изменения внесены!",-1),f(" Проверьте и согласуйте. ",-1)]))):r("",!0),i.value?(e(),t("div",R,[v(s("textarea",{"onUpdate:modelValue":n[2]||(n[2]=a=>m(o).comment=a),class:"w-full border-gray-300 rounded text-sm p-2 mb-2",rows:"2",placeholder:"Опишите замечания..."},null,512),[[y,m(o).comment]]),s("div",q,[s("button",{onClick:n[3]||(n[3]=a=>p("rejected")),class:"bg-red-600 text-white px-3 py-1 rounded text-sm"},"Отправить"),s("button",{onClick:n[4]||(n[4]=a=>i.value=!1),class:"text-gray-500 text-sm px-2"},"Отмена")])])):(e(),t("div",L,[s("button",{onClick:n[1]||(n[1]=a=>p("approved")),class:"bg-green-100 text-green-800 px-4 py-2 rounded text-sm font-medium"},"✓ Согласовать"),s("button",{onClick:x,class:"bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium"},"? Есть замечания")]))])):(e(),t("div",z,[s("div",null,[d.myParticipation.pivot.agenda_status==="approved"?(e(),t("span",G,"✓ Вы согласовали")):r("",!0),d.myParticipation.pivot.agenda_status==="rejected"?(e(),t("span",H,"✕ Вы запросили изменения")):r("",!0)]),s("button",{onClick:x,class:"text-xs text-blue-600 underline"},"Изменить решение")]))])):r("",!0)]))}};export{W as default};
