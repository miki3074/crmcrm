import{Q as R,r,A as W,p as I,s as X,o as a,f as o,a as L,u as Y,w as O,F as u,i as y,Z as ee,b as l,x as v,n as V,t as m,e as te,j as i,v as p,g as U,l as Q,y as f}from"./app-d0026b74.js";import{_ as le}from"./AuthenticatedLayout-f7082f20.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";import"./ApplicationLogo-cc6ca031.js";const ae={class:"max-w-7xl mx-auto p-6 space-y-6"},oe={class:"mt-8"},ne={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},ie=["onClick"],ue={class:"flex items-center gap-3 mb-2"},de={class:"font-bold text-lg text-slate-700 dark:text-slate-100"},re={key:1,class:"text-slate-400 text-sm"},pe={class:"mt-12"},ve={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},me=["onClick"],xe={class:"flex items-center gap-3 mb-2"},be={class:"font-bold text-lg text-slate-700 dark:text-slate-100"},ce={key:1,class:"text-slate-400 text-sm"},ye={key:0,class:"fixed inset-0 bg-black/50 flex justify-center items-center z-50 px-4"},fe={class:"bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-xl w-full max-w-lg relative"},ge={class:"flex mb-4 border-b border-slate-300 dark:border-slate-700"},ke={class:"flex gap-2"},_e={key:0,class:"text-xs text-gray-400"},we={class:"flex items-center gap-2"},he={key:1,class:"space-y-2"},je=["label"],Ve=["value"],Ue=["value"],Ce={key:0,class:"text-xs text-slate-400 mt-1"},$e={key:2},ze=["value"],Ie={class:"flex items-center gap-2"},Me={key:0,class:"space-y-2"},Ee=["label"],qe=["value"],Be=["value"],Se={key:0,class:"text-xs text-slate-400 mt-1"},Ne={key:1},Pe=["value"],De={class:"flex justify-end gap-2 pt-3 border-t border-slate-200 dark:border-slate-700 mt-4"},Fe={__name:"Index",setup(Te){const{props:C}=R(),$=r([]),_=r(!1),b=r("jur"),x=r(!1),w=r([]),s=r({type:"jur",name:"",organization_name:"",description:"",city:"",address:"",phone:"",email:"",project_id:null,responsible_id:null,company_id:null});r([]);const g=r([]),k=r([]),h=r(!1),M=async()=>{const{data:n}=await y.get("/api/clients");$.value=n},Z=async()=>{const{data:n}=await y.get("api/projects/grouped");w.value=n},G=async()=>{const{data:n}=await y.get("/api/employeesqw");g.value=n,k.value=n};W(()=>s.value.project_id,async n=>{if(s.value.responsible_id=null,!x.value||!n){k.value=g.value;return}const t=w.value.flatMap(e=>e.projects).find(e=>e.id===n);if(!(t!=null&&t.company_id)){k.value=[];return}h.value=!0;try{const{data:e}=await y.get(`/api/companies/${t.company_id}/employees`);k.value=e}catch(e){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð² ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸:",e)}finally{h.value=!1}});const H=async()=>{const n={...s.value,type:b.value};await y.post("/api/clients",n),_.value=!1,s.value={type:b.value,name:"",organization_name:"",description:"",city:"",address:"",phone:"",email:"",project_id:null,responsible_id:null,company_id:null},x.value=!1,await M()},E=I(()=>$.value.filter(n=>n.created_by===C.auth.user.id)),q=I(()=>$.value.filter(n=>n.responsible_id===C.auth.user.id&&n.created_by!==C.auth.user.id)),J=I(()=>{const n=new Set;return g.value.filter(t=>n.has(t.id)?!1:(n.add(t.id),!0))}),z=r(!1),K=async()=>{var n,t,e,d,B,S,N,P,D,F,T,A;if(!s.value.inn)return alert("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð˜ÐÐ");z.value=!0;try{const{data:j}=await y.post("/api/dadata/inn",{inn:s.value.inn});if(!((n=j.suggestions)!=null&&n.length)){alert("ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾");return}const c=j.suggestions[0].data;s.value.organization_name=((t=c.name)==null?void 0:t.full_with_opf)||"",s.value.name=((e=c.management)==null?void 0:e.name)||"",s.value.city=((B=(d=c.address)==null?void 0:d.data)==null?void 0:B.city)||"",s.value.address=((S=c.address)==null?void 0:S.unrestricted_value)||"",s.value.phone=((D=(P=(N=c.phones)==null?void 0:N[0])==null?void 0:P.data)==null?void 0:D.source)||"",s.value.email=((A=(T=(F=c.emails)==null?void 0:F[0])==null?void 0:T.data)==null?void 0:A.source)||""}catch(j){console.error(j),alert("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°")}finally{z.value=!1}};return X(async()=>{await Promise.all([M(),Z(),G()])}),(n,t)=>(a(),o(u,null,[L(Y(ee),{title:"ÐšÐ»Ð¸ÐµÐ½Ñ‚Ñ‹"}),L(le,null,{header:O(()=>t[23]||(t[23]=[l("h2",{class:"font-semibold text-xl text-slate-700 dark:text-slate-200"},"ÐšÐ»Ð¸ÐµÐ½Ñ‚Ñ‹",-1)])),default:O(()=>[l("div",ae,[l("button",{onClick:t[0]||(t[0]=e=>_.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl font-semibold shadow"}," âž• ÐÐ¾Ð²Ñ‹Ð¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚ "),l("div",oe,[t[24]||(t[24]=l("h2",{class:"text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4"}," ðŸ‘¤ ÐšÐ»Ð¸ÐµÐ½Ñ‚Ñ‹ ",-1)),E.value.length?(a(),o("div",ne,[(a(!0),o(u,null,v(E.value,e=>(a(),o("div",{key:e.id,class:"p-4 bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md cursor-pointer transition",onClick:d=>n.$inertia.visit(`/clients/${e.id}`)},[l("div",ue,[l("span",{class:V(["px-3 py-1 text-xs rounded-full",e.type==="jur"?"bg-blue-100 text-blue-700":"bg-emerald-100 text-emerald-700"])},m(e.type==="jur"?"Ð®Ñ€Ð¸Ð´Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð»Ð¸Ñ†Ð¾":"Ð¤Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð»Ð¸Ñ†Ð¾"),3)]),l("h3",de,m(e.name),1)],8,ie))),128))])):(a(),o("p",re,"ÐÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð², ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð²Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð»Ð¸."))]),l("div",pe,[t[25]||(t[25]=l("h2",{class:"text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4"}," ðŸ’¼ ÐšÐ»Ð¸ÐµÐ½Ñ‚Ñ‹, Ð³Ð´Ðµ Ñ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ ",-1)),q.value.length?(a(),o("div",ve,[(a(!0),o(u,null,v(q.value,e=>(a(),o("div",{key:e.id,class:"p-4 bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md cursor-pointer transition",onClick:d=>n.$inertia.visit(`/clients/${e.id}`)},[l("div",xe,[l("span",{class:V(["px-3 py-1 text-xs rounded-full",e.type==="jur"?"bg-blue-100 text-blue-700":"bg-emerald-100 text-emerald-700"])},m(e.type==="jur"?"Ð®Ñ€Ð¸Ð´Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð»Ð¸Ñ†Ð¾":"Ð¤Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð»Ð¸Ñ†Ð¾"),3)]),l("h3",be,m(e.name),1)],8,me))),128))])):(a(),o("p",ce,"ÐÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð², Ð³Ð´Ðµ Ð²Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹."))])]),_.value?(a(),o("div",ye,[l("div",fe,[t[35]||(t[35]=l("h2",{class:"text-xl font-bold mb-4 text-slate-800 dark:text-white"},"âž• ÐÐ¾Ð²Ñ‹Ð¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚",-1)),l("div",ge,[l("button",{onClick:t[1]||(t[1]=e=>b.value="jur"),class:V(["flex-1 py-2 font-medium",b.value==="jur"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-slate-500 hover:text-slate-700"])}," Ð®Ñ€. Ð»Ð¸Ñ†Ð¾ ",2),l("button",{onClick:t[2]||(t[2]=e=>b.value="fiz"),class:V(["flex-1 py-2 font-medium",b.value==="fiz"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-slate-500 hover:text-slate-700"])}," Ð¤Ð¸Ð·. Ð»Ð¸Ñ†Ð¾ ",2)]),l("form",{onSubmit:te(H,["prevent"]),class:"space-y-3 max-h-[70vh] overflow-y-auto pr-2"},[b.value==="jur"?(a(),o(u,{key:0},[l("div",ke,[i(l("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.value.inn=e),placeholder:"Ð˜ÐÐ",class:"input flex-1"},null,512),[[p,s.value.inn]]),l("button",{onClick:K,class:"px-4 py-2 bg-blue-600 text-white rounded-lg"}," ÐŸÐ¾Ð¸ÑÐº ")]),z.value?(a(),o("div",_e,"ÐŸÐ¾Ð¸ÑÐº Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸â€¦")):U("",!0),i(l("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>s.value.organization_name=e),placeholder:"ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ *",class:"input",required:""},null,512),[[p,s.value.organization_name]]),i(l("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>s.value.name=e),placeholder:"Ð¤Ð˜Ðž ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð½Ð¾Ð³Ð¾ Ð»Ð¸Ñ†Ð° *",class:"input",required:""},null,512),[[p,s.value.name]]),i(l("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>s.value.description=e),placeholder:"ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ",class:"input"},null,512),[[p,s.value.description]]),l("div",we,[t[26]||(t[26]=l("label",{class:"text-sm text-slate-600 dark:text-slate-400"},"ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ?",-1)),i(l("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>x.value=e)},null,512),[[Q,x.value]])]),x.value?(a(),o("div",he,[i(l("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>s.value.project_id=e),class:"input"},[t[27]||(t[27]=l("option",{value:""},"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚",-1)),(a(!0),o(u,null,v(w.value,e=>(a(),o("optgroup",{key:e.id,label:e.name},[(a(!0),o(u,null,v(e.projects,d=>(a(),o("option",{key:d.id,value:d.id},m(d.name),9,Ve))),128))],8,je))),128))],512),[[f,s.value.project_id]]),i(l("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>s.value.responsible_id=e),class:"input"},[t[28]||(t[28]=l("option",{value:""},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹",-1)),(a(!0),o(u,null,v(J.value,e=>(a(),o("option",{key:e.id,value:e.id},m(e.name),9,Ue))),128))],512),[[f,s.value.responsible_id]]),h.value?(a(),o("div",Ce,"Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²â€¦")):U("",!0)])):(a(),o("div",$e,[i(l("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>s.value.responsible_id=e),class:"input"},[t[29]||(t[29]=l("option",{value:""},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹",-1)),(a(!0),o(u,null,v(g.value,e=>(a(),o("option",{key:e.id,value:e.id},m(e.name),9,ze))),128))],512),[[f,s.value.responsible_id]])])),i(l("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>s.value.city=e),placeholder:"Ð“Ð¾Ñ€Ð¾Ð´",class:"input"},null,512),[[p,s.value.city]]),i(l("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>s.value.address=e),placeholder:"ÐÐ´Ñ€ÐµÑ",class:"input"},null,512),[[p,s.value.address]]),i(l("input",{"onUpdate:modelValue":t[13]||(t[13]=e=>s.value.email=e),placeholder:"Email",type:"email",class:"input"},null,512),[[p,s.value.email]]),i(l("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>s.value.phone=e),placeholder:"Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½",class:"input"},null,512),[[p,s.value.phone]])],64)):(a(),o(u,{key:1},[i(l("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>s.value.name=e),placeholder:"Ð¤Ð˜Ðž *",class:"input",required:""},null,512),[[p,s.value.name]]),i(l("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>s.value.phone=e),placeholder:"Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½",class:"input"},null,512),[[p,s.value.phone]]),i(l("input",{"onUpdate:modelValue":t[17]||(t[17]=e=>s.value.email=e),placeholder:"Email",type:"email",class:"input"},null,512),[[p,s.value.email]]),l("div",Ie,[t[30]||(t[30]=l("label",{class:"text-sm text-slate-600 dark:text-slate-400"},"ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ?",-1)),i(l("input",{type:"checkbox","onUpdate:modelValue":t[18]||(t[18]=e=>x.value=e)},null,512),[[Q,x.value]])]),x.value?(a(),o("div",Me,[i(l("select",{"onUpdate:modelValue":t[19]||(t[19]=e=>s.value.project_id=e),class:"input"},[t[31]||(t[31]=l("option",{value:""},"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚",-1)),(a(!0),o(u,null,v(w.value,e=>(a(),o("optgroup",{key:e.id,label:e.name},[(a(!0),o(u,null,v(e.projects,d=>(a(),o("option",{key:d.id,value:d.id},m(d.name),9,qe))),128))],8,Ee))),128))],512),[[f,s.value.project_id]]),i(l("select",{"onUpdate:modelValue":t[20]||(t[20]=e=>s.value.responsible_id=e),class:"input"},[t[32]||(t[32]=l("option",{value:""},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹",-1)),(a(!0),o(u,null,v(k.value,e=>(a(),o("option",{key:e.id,value:e.id},m(e.name),9,Be))),128))],512),[[f,s.value.responsible_id]]),h.value?(a(),o("div",Se,"Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²â€¦")):U("",!0)])):(a(),o("div",Ne,[i(l("select",{"onUpdate:modelValue":t[21]||(t[21]=e=>s.value.responsible_id=e),class:"input"},[t[33]||(t[33]=l("option",{value:""},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹",-1)),(a(!0),o(u,null,v(g.value,e=>(a(),o("option",{key:e.id,value:e.id},m(e.name),9,Pe))),128))],512),[[f,s.value.responsible_id]])]))],64)),l("div",De,[l("button",{type:"button",onClick:t[22]||(t[22]=e=>_.value=!1),class:"btn-gray"}," ÐžÑ‚Ð¼ÐµÐ½Ð° "),t[34]||(t[34]=l("button",{type:"submit",class:"btn-green"}," ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ ",-1))])],32)])])):U("",!0)]),_:1})],64))}},Ze=se(Fe,[["__scopeId","data-v-fed8138a"]]);export{Ze as default};
