import{r as p,j as b,o as a,c as o,a as r,h as j,i as L,d as l,F as q,e as z,v as N,f,E as S,t as i,g as P}from"./app-f33d6ccc.js";const G={class:"space-y-6"},H={class:"bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border border-dashed border-gray-300 dark:border-gray-600"},I={class:"flex flex-col sm:flex-row items-center justify-between gap-4"},J={class:"flex-1"},K={class:"cursor-pointer flex items-center gap-2 text-emerald-600 font-medium hover:underline"},Q=["disabled"],W={class:"flex items-center gap-2"},X={key:0,class:"text-xs text-center mt-2 text-gray-500"},Y={key:0},Z={class:"space-y-3"},ee={class:"flex items-center gap-3"},te=["href"],se={class:"text-xs opacity-75 mt-0.5"},re={key:0,class:"mt-1"},ae={class:"text-xs font-bold text-red-800 bg-red-50 border border-red-100 p-2 rounded inline-block max-w-full break-words"},oe={key:0},ne={key:1},le=["onClick"],de={class:"mt-2 md:mt-0 flex items-center gap-2 self-end md:self-center"},ie={class:"px-2 py-1 rounded text-xs font-bold border bg-white/60"},ce={key:0,class:"flex gap-1"},ue=["onClick"],pe=["onClick"],xe={key:1,class:"relative"},ve=["id","onChange"],fe=["for"],ge=["onClick"],me={key:1,class:"text-center text-gray-400 text-sm py-4"},he={key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},be={class:"bg-white dark:bg-gray-800 p-6 rounded-lg w-full max-w-md shadow-2xl"},_e={class:"flex justify-end gap-2 mt-4"},ke={__name:"TaskDocumentApproval",props:{task:Object,currentUser:Object},emits:["refresh"],setup(C,{emit:$}){const d=C,x=$,g=p(!1),m=p(!1),h=p(!1),y=p(null),v=p(""),k=b(()=>{var e;return(e=d.task.executors)==null?void 0:e.some(t=>t.id===d.currentUser.id)}),F=b(()=>{var e;return(e=d.task.responsibles)==null?void 0:e.some(t=>t.id===d.currentUser.id)}),_=b(()=>{var e;return((e=d.task.files)==null?void 0:e.filter(t=>t.status!=="none"))||[]}),D=b(()=>{var e;return((e=d.task.files)==null?void 0:e.filter(t=>t.status==="none"))||[]}),T=async e=>{const t=e.target.files;if(!t.length)return;g.value=!0;const s=new FormData;for(let n=0;n<t.length;n++)s.append("files[]",t[n]);s.append("requires_approval",m.value?"1":"0");try{await f.post(`/api/tasks/${d.task.id}/files`,s,{headers:{"Content-Type":"multipart/form-data"}}),x("refresh"),e.target.value=null,m.value=!1}catch{alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏")}finally{g.value=!1}},M=async e=>{if(confirm("–°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç?"))try{await f.put(`/api/files/${e.id}/approve`),x("refresh")}catch{}},R=e=>{y.value=e,v.value="",h.value=!0},U=async()=>{if(v.value)try{await f.put(`/api/files/${y.value.id}/reject`,{reason:v.value}),h.value=!1,x("refresh")}catch{}},A=async e=>{if(confirm("–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª?"))try{await f.delete(`/api/tasks/files/${e}`),x("refresh")}catch{}},B=e=>e==="approved"?"bg-green-100 text-green-700 border-green-200":e==="rejected"?"bg-red-100 text-red-700 border-red-200":"bg-amber-100 text-amber-700 border-amber-200",O=e=>e==="approved"?"‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ":e==="rejected"?"‚ùå –ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–µ":"‚è≥ –ñ–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏",c=p([]),V=e=>{c.value.includes(e)?c.value=c.value.filter(t=>t!==e):c.value.push(e)},w=e=>e&&e.length>60,E=async(e,t)=>{const s=e.target.files[0];if(!s)return;if(!confirm(`–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ "${s.name}" –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É?`)){e.target.value=null;return}const n=new FormData;n.append("file",s);try{await f.post(`/api/files/${t}/replace`,n,{headers:{"Content-Type":"multipart/form-data"}}),x("refresh")}catch{alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–º–µ–Ω–µ —Ñ–∞–π–ª–∞")}};return(e,t)=>(a(),o("div",G,[r("div",H,[r("div",I,[r("div",J,[r("label",K,[t[3]||(t[3]=r("span",null,"üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã",-1)),r("input",{type:"file",multiple:"",class:"hidden",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:T,disabled:g.value},null,40,Q)]),t[4]||(t[4]=r("p",{class:"text-xs text-gray-500 mt-1"},"PDF, Office (max 20MB)",-1))]),r("div",W,[j(r("input",{type:"checkbox",id:"chkApprove","onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),class:"w-4 h-4 rounded text-emerald-600 focus:ring-emerald-500"},null,512),[[L,m.value]]),t[5]||(t[5]=r("label",{for:"chkApprove",class:"text-sm text-gray-700 dark:text-gray-300 select-none cursor-pointer"}," –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ ",-1))])]),g.value?(a(),o("div",X,"–ó–∞–≥—Ä—É–∑–∫–∞...")):l("",!0)]),_.value.length>0?(a(),o("div",Y,[t[8]||(t[8]=r("h4",{class:"font-bold text-sm uppercase text-gray-500 mb-2 tracking-wider"},"üìú –î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ –ø–æ–¥–ø–∏—Å—å",-1)),r("div",Z,[(a(!0),o(q,null,z(_.value,s=>{var n;return a(),o("div",{key:s.id,class:S(["flex flex-col md:flex-row justify-between items-start md:items-center p-3 border rounded-lg bg-white dark:bg-gray-800 transition",B(s.status)])},[r("div",ee,[t[7]||(t[7]=r("div",{class:"text-2xl"},"üìÑ",-1)),r("div",null,[r("a",{href:`/storage/${s.file_path}`,target:"_blank",class:"font-semibold hover:underline break-all"},i(s.file_name),9,te),r("div",se,i((n=s.user)==null?void 0:n.name)+" ‚Ä¢ "+i(new Date(s.created_at).toLocaleDateString()),1),s.status==="rejected"&&s.rejection_reason?(a(),o("div",re,[r("div",ae,[t[6]||(t[6]=r("span",{class:"mr-1"},"‚ùó",-1)),!w(s.rejection_reason)||c.value.includes(s.id)?(a(),o("span",oe,i(s.rejection_reason),1)):(a(),o("span",ne,i(s.rejection_reason.slice(0,60))+"... ",1)),w(s.rejection_reason)?(a(),o("button",{key:2,onClick:P(u=>V(s.id),["stop"]),class:"ml-1 text-blue-600 hover:text-blue-800 hover:underline focus:outline-none cursor-pointer"},i(c.value.includes(s.id)?"–°–∫—Ä—ã—Ç—å":"–ï—â—ë"),9,le)):l("",!0)])])):l("",!0)])]),r("div",de,[r("span",ie,i(O(s.status)),1),F.value&&s.status==="pending"?(a(),o("div",ce,[r("button",{onClick:u=>M(s),title:"–û–¥–æ–±—Ä–∏—Ç—å",class:"p-1.5 bg-green-600 text-white rounded hover:bg-green-700 text-xs flex items-center gap-1"}," ‚úî –ü—Ä–∏–Ω—è—Ç—å ",8,ue),r("button",{onClick:u=>R(s),title:"–í–µ—Ä–Ω—É—Ç—å",class:"p-1.5 bg-red-500 text-white rounded hover:bg-red-600 text-xs flex items-center gap-1"}," ‚úñ –í–µ—Ä–Ω—É—Ç—å ",8,pe)])):l("",!0),k.value&&s.status==="rejected"?(a(),o("div",xe,[r("input",{type:"file",id:"replace-"+s.id,class:"hidden",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:u=>E(u,s.id)},null,40,ve),r("label",{for:"replace-"+s.id,class:"cursor-pointer bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded text-xs shadow flex items-center gap-1 transition"}," üîÑ –ò—Å–ø—Ä–∞–≤–∏—Ç—å ",8,fe)])):l("",!0),k.value&&s.status!=="approved"?(a(),o("button",{key:2,onClick:u=>A(s.id),class:"text-gray-400 hover:text-red-500 px-2",title:"–£–¥–∞–ª–∏—Ç—å"}," üóë ",8,ge)):l("",!0)])],2)}),128))])])):l("",!0),!D.value.length&&!_.value.length?(a(),o("div",me," –ù–µ—Ç —Ñ–∞–π–ª–æ–≤ ")):l("",!0),h.value?(a(),o("div",he,[r("div",be,[t[9]||(t[9]=r("h3",{class:"font-bold mb-2 dark:text-white"},"–ü—Ä–∏—á–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞",-1)),j(r("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s),class:"w-full border p-2 rounded h-24 dark:bg-gray-700 dark:text-white",placeholder:"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."},null,512),[[N,v.value]]),r("div",_e,[r("button",{onClick:t[2]||(t[2]=s=>h.value=!1),class:"px-3 py-1 border rounded dark:text-gray-300"},"–û—Ç–º–µ–Ω–∞"),r("button",{onClick:U,class:"px-3 py-1 bg-red-600 text-white rounded"},"–í–µ—Ä–Ω—É—Ç—å")])])])):l("",!0)]))}};export{ke as default};
