import{r as c,x as K,o,G as U,J as O,f as b,k as P,u as W,Z as G,a as e,c as r,e as m,E as x,t as n,F as h,h as $,v as A,d as f,b as _,O as J,g as R,D as Z}from"./app-0c17e5ad.js";import{_ as q}from"./AuthenticatedLayout-e4f4bca7.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import"./ApplicationLogo-792ed34e.js";const X={class:"h-[calc(100vh-65px)] flex bg-gray-50 dark:bg-slate-900 overflow-hidden"},Y={class:"w-80 border-r border-gray-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex flex-col z-10"},ee={class:"p-4 border-b border-gray-100 dark:border-slate-800 space-y-3"},te={class:"flex bg-gray-100 dark:bg-slate-800 p-1 rounded-lg"},se=["onClick"],ae={class:"relative"},oe={class:"flex-1 overflow-y-auto custom-scrollbar"},re={key:0,class:"flex justify-center p-4"},le={key:1,class:"text-center p-6 text-gray-400 text-sm"},ne=["onClick"],ie={class:"flex justify-between items-start mb-1"},de={class:"font-semibold text-sm text-slate-800 dark:text-gray-200 truncate max-w-[70%]"},ce={class:"text-[10px] text-gray-400"},ue={class:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1 truncate"},pe={class:"flex items-center gap-2"},xe={class:"text-[10px] text-gray-400"},he={class:"flex-1 flex flex-col bg-slate-50 dark:bg-black/20"},ge={key:0,class:"flex-1 flex flex-col items-center justify-center text-gray-400"},ve={class:"h-16 border-b border-gray-200 dark:border-slate-800 bg-white dark:bg-slate-900 px-6 flex justify-between items-center shadow-sm"},be={class:"flex items-center gap-2"},me={class:"font-bold text-lg text-slate-800 dark:text-white"},fe={class:"text-gray-400 text-sm"},ye={class:"text-xs text-slate-500"},ke={class:"font-medium text-blue-600"},we={key:0,class:"flex justify-center py-4"},_e={key:0,class:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-xs font-bold text-slate-500 mr-2 shrink-0"},Ce={class:"whitespace-pre-wrap break-words"},Me={key:0,class:"mt-3 flex flex-wrap gap-2"},je=["href"],Te=["src"],Be={key:1,class:"flex items-center gap-2 px-2 py-1.5 bg-black/20 rounded"},ze={class:"text-xs truncate max-w-[120px]"},Ve={class:"p-4 bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-slate-800"},$e={key:0,class:"flex flex-wrap gap-2 mb-2 p-2 bg-gray-50 dark:bg-slate-800 rounded-lg"},Ae={class:"truncate max-w-[150px]"},De=["onClick"],He={class:"flex items-end gap-3"},Fe={class:"cursor-pointer p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors"},Le={class:"flex-1 relative"},Se=["onKeydown"],Ee=["disabled"],Ne={key:0,class:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24"},Ie={key:1,class:"w-5 h-5 translate-x-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ke={__name:"Admin",setup(Ue){const g=c([]),l=c(null),y=c([]),k=c(null),v=c({status:"all",search:""}),p=c(""),w=c(!1),C=c(!1),M=c(!1),u=c([]),D=a=>new Date(a).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),j=async()=>{C.value=!0;try{const{data:a}=await b.get("/api/support/admin/threads",{params:v.value});g.value=a}catch(a){console.error(a)}C.value=!1};let B;const H=()=>{clearTimeout(B),B=setTimeout(j,300)},z=async()=>{await Z(),k.value&&(k.value.scrollTop=k.value.scrollHeight)},F=async a=>{l.value=a,y.value=[],M.value=!0;try{const{data:t}=await b.get(`/api/support/admin/threads/${a.id}`);y.value=t.messages,z()}catch(t){console.error(t)}M.value=!1},V=async()=>{if(!p.value.trim()&&!u.value.length)return;const a=new FormData;a.append("message",p.value),u.value.forEach((t,s)=>a.append(`files[${s}]`,t)),w.value=!0;try{const{data:t}=await b.post(`/api/support/admin/threads/${l.value.id}/messages`,a,{headers:{"Content-Type":"multipart/form-data"}});y.value.push(t),p.value="",u.value=[],z()}catch(t){console.error(t),alert("Ошибка отправки")}w.value=!1},L=a=>{u.value.push(...Array.from(a.target.files)),a.target.value=""},S=a=>{var s;const t=((s=a.clipboardData)==null?void 0:s.items)||[];for(const d of t)if(d.kind==="file"){const i=d.getAsFile();i&&i.type.startsWith("image/")&&(u.value.push(i),a.preventDefault())}},E=a=>{u.value.splice(a,1)},N=async()=>{if(!confirm("Закрыть этот тикет?"))return;await b.post(`/api/support/admin/threads/${l.value.id}/close`),l.value.status="closed";const a=g.value.find(t=>t.id===l.value.id);a&&(a.status="closed")},I=async()=>{await b.post(`/api/support/admin/threads/${l.value.id}/reopen`),l.value.status="open";const a=g.value.find(t=>t.id===l.value.id);a&&(a.status="open")};return K(j),(a,t)=>(o(),U(q,null,{default:O(()=>[P(W(G),{title:"Admin Support"}),e("div",X,[e("div",Y,[e("div",ee,[t[4]||(t[4]=e("h2",{class:"font-bold text-lg text-slate-800 dark:text-white"},"Входящие",-1)),e("div",te,[(o(),r(h,null,m(["all","open","closed"],s=>e("button",{key:s,onClick:d=>{v.value.status=s,j()},class:x(["flex-1 text-xs font-medium py-1.5 rounded-md transition-colors capitalize",v.value.status===s?"bg-white dark:bg-slate-700 shadow text-slate-900 dark:text-white":"text-slate-500 hover:text-slate-700 dark:text-slate-400"])},n(s==="all"?"Все":s==="open"?"Открытые":"Архив"),11,se)),64))]),e("div",ae,[t[3]||(t[3]=e("span",{class:"absolute left-2.5 top-2 text-gray-400"},[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),$(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>v.value.search=s),onInput:H,type:"text",placeholder:"Поиск по теме или имени...",class:"w-full pl-9 pr-3 py-1.5 text-sm bg-gray-50 dark:bg-slate-800 border-gray-200 dark:border-slate-700 rounded-lg focus:ring-blue-500 focus:border-blue-500"},null,544),[[A,v.value.search]])])]),e("div",oe,[C.value?(o(),r("div",re,t[5]||(t[5]=[e("svg",{class:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):g.value.length?f("",!0):(o(),r("div",le," Тикетов не найдено ")),(o(!0),r(h,null,m(g.value,s=>{var d,i;return o(),r("div",{key:s.id,onClick:T=>F(s),class:x(["p-3 border-b border-gray-50 dark:border-slate-800/50 cursor-pointer hover:bg-blue-50 dark:hover:bg-slate-800/50 transition-colors",((d=l.value)==null?void 0:d.id)===s.id?"bg-blue-50 border-l-4 border-l-blue-500 dark:bg-slate-800":"border-l-4 border-l-transparent"])},[e("div",ie,[e("span",de,n(((i=s.user)==null?void 0:i.name)||"Неизвестный"),1),e("span",ce,n(new Date(s.updated_at).toLocaleDateString()),1)]),e("div",ue,n(s.subject||"Без темы"),1),e("div",pe,[e("span",{class:x(["px-1.5 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider",s.status==="open"?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"])},n(s.status==="open"?"Open":"Closed"),3),e("span",xe,"#"+n(s.id),1)])],10,ne)}),128))])]),e("div",he,[l.value?(o(),r(h,{key:1},[e("div",ve,[e("div",null,[e("div",be,[e("h3",me,n(l.value.subject||"Обращение"),1),e("span",fe,"#"+n(l.value.id),1)]),e("div",ye,[t[7]||(t[7]=_(" Клиент: ",-1)),e("span",ke,n(l.value.user.name),1),t[8]||(t[8]=e("span",{class:"mx-1"},"•",-1)),_(" "+n(l.value.user.email),1)])]),e("div",null,[l.value.status==="open"?(o(),r("button",{key:0,onClick:N,class:"flex items-center gap-1 px-3 py-1.5 bg-white border border-red-200 text-red-600 rounded-md text-sm hover:bg-red-50 transition-colors shadow-sm"},t[9]||(t[9]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),_(" Завершить ",-1)]))):(o(),r("button",{key:1,onClick:I,class:"flex items-center gap-1 px-3 py-1.5 bg-white border border-green-200 text-green-600 rounded-md text-sm hover:bg-green-50 transition-colors shadow-sm"},t[10]||(t[10]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),_(" Переоткрыть ",-1)])))])]),e("div",{ref_key:"messagesContainer",ref:k,class:"flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar"},[M.value?(o(),r("div",we,t[11]||(t[11]=[e("svg",{class:"animate-spin h-6 w-6 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):f("",!0),(o(!0),r(h,null,m(y.value,s=>{var d;return o(),r("div",{key:s.id,class:x(["flex group",s.is_support?"justify-end":"justify-start"])},[s.is_support?f("",!0):(o(),r("div",_e,n(l.value.user.name[0]),1)),e("div",{class:x(["max-w-[70%] rounded-2xl px-4 py-3 text-sm shadow-sm border",s.is_support?"bg-blue-600 text-white border-blue-600 rounded-br-none":"bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-100 border-gray-100 dark:border-slate-700 rounded-bl-none"])},[e("div",Ce,n(s.body),1),(d=s.attachments)!=null&&d.length?(o(),r("div",Me,[(o(!0),r(h,null,m(s.attachments,i=>{var T;return o(),r("div",{key:i.id,class:"relative"},[e("a",{href:`/storage/${i.path}`,target:"_blank",class:"block overflow-hidden rounded border border-white/20 hover:opacity-90"},[(T=i.mime_type)!=null&&T.startsWith("image")?(o(),r("img",{key:0,src:`/storage/${i.path}`,class:"max-w-[150px] max-h-[120px] object-cover"},null,8,Te)):(o(),r("div",Be,[e("span",ze,n(i.original_name),1)]))],8,je)])}),128))])):f("",!0),e("div",{class:x(["text-[10px] mt-1 text-right opacity-70",s.is_support?"text-blue-100":"text-slate-400"])},n(D(s.created_at)),3)],2)],2)}),128))],512),e("div",Ve,[u.value.length?(o(),r("div",$e,[(o(!0),r(h,null,m(u.value,(s,d)=>(o(),r("div",{key:d,class:"flex items-center gap-1 bg-white dark:bg-slate-900 px-2 py-1 rounded border shadow-sm text-xs"},[e("span",Ae,n(s.name),1),e("button",{onClick:i=>E(d),class:"text-red-500 hover:text-red-700 font-bold"},"×",8,De)]))),128))])):f("",!0),e("div",He,[e("label",Fe,[e("input",{type:"file",multiple:"",class:"hidden",onChange:L},null,32),t[12]||(t[12]=e("svg",{class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1))]),e("div",Le,[$(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>p.value=s),rows:"1",placeholder:"Напишите ответ... (Ctrl+Enter для отправки)",class:"w-full max-h-40 py-2.5 px-4 bg-gray-100 dark:bg-slate-800 border-0 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:bg-white dark:focus:bg-slate-900 resize-none overflow-hidden text-sm transition-all",onInput:t[2]||(t[2]=s=>{s.target.style.height="auto",s.target.style.height=s.target.scrollHeight+"px"}),onKeydown:J(R(V,["ctrl","prevent"]),["enter"]),onPaste:S},null,40,Se),[[A,p.value]])]),e("button",{onClick:V,disabled:w.value||!p.value.trim()&&!u.value.length,class:"bg-blue-600 hover:bg-blue-700 text-white rounded-full p-2.5 shadow-lg disabled:opacity-50 disabled:shadow-none transition-all"},[w.value?(o(),r("svg",Ne,t[13]||(t[13]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(o(),r("svg",Ie,t[14]||(t[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])))],8,Ee)]),t[15]||(t[15]=e("div",{class:"text-[10px] text-gray-400 mt-1 pl-12"}," Поддерживается вставка изображений (Ctrl+V) ",-1))])],64)):(o(),r("div",ge,t[6]||(t[6]=[e("svg",{class:"w-16 h-16 mb-4 text-gray-300 dark:text-slate-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})],-1),e("p",null,"Выберите тикет из списка слева",-1)])))])])]),_:1}))}},Je=Q(Ke,[["__scopeId","data-v-98c31dd0"]]);export{Je as default};
