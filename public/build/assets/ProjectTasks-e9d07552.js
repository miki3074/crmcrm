import{r as w,j as I,o as r,c as a,a as t,b as g,t as i,d as m,F as v,e as k,k as L,J as S,K as N,G as P,E as _,H as O,g as $,u as q,M as A,h as f,v as j,L as G,i as T,f as J}from"./app-b1eea67c.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";const R={class:"space-y-6"},Q={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-4"},W={class:"text-2xl font-bold text-slate-800 dark:text-white flex items-center gap-2"},X={class:"text-sm font-medium text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full ml-2"},Y={key:0,class:"bg-white dark:bg-slate-800 rounded-3xl p-10 text-center border-2 border-dashed border-slate-200 dark:border-slate-700"},Z={key:1,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5"},ee={class:"flex justify-between items-start mb-3"},te=["title"],se={class:"text-xs font-bold text-slate-500"},le={class:"w-16 h-1.5 bg-slate-100 rounded-full overflow-hidden"},oe={class:"font-bold text-slate-800 dark:text-white text-lg leading-snug mb-2 group-hover:text-indigo-600 transition-colors line-clamp-2"},re={class:"flex items-center gap-3 text-xs text-slate-500 mb-4 font-medium"},ae={class:"flex items-center gap-1"},ie={class:"mt-4 pt-4 border-t border-slate-100 dark:border-slate-700"},de={key:0,class:"mb-3 flex flex-wrap gap-2"},ne=["onClick"],ue={key:0,class:"text-[10px] text-slate-400 py-1"},pe={class:"flex items-center justify-between"},ce={class:"flex -space-x-2 overflow-hidden"},xe=["title"],be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},me={class:"relative bg-white dark:bg-slate-800 rounded-2xl w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh]"},ve={class:"px-6 py-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800 rounded-t-2xl"},fe={class:"p-6 overflow-y-auto custom-scrollbar"},ge={key:0,class:"p-3 bg-rose-50 text-rose-600 text-sm rounded-lg border border-rose-100"},ke={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},he={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ye={class:"bg-slate-50 dark:bg-slate-700/50 p-3 rounded-xl border border-slate-100 dark:border-slate-600"},we={class:"max-h-40 overflow-y-auto pr-1 custom-scrollbar space-y-1"},_e=["value"],je={class:"text-sm text-slate-700 dark:text-slate-200"},Ce={class:"bg-slate-50 dark:bg-slate-700/50 p-3 rounded-xl border border-slate-100 dark:border-slate-600"},Me={class:"max-h-40 overflow-y-auto pr-1 custom-scrollbar space-y-1"},Ve=["value"],Be={class:"text-sm text-slate-700 dark:text-slate-200"},De={class:"px-6 py-4 border-t border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 rounded-b-2xl flex justify-end gap-3"},Se=["disabled"],$e={__name:"ProjectTasks",props:["project","user","employees"],emits:["refresh"],setup(c,{emit:U}){const n=c,z=U,u=w(!1),h=w(!1),y=w(""),o=w({title:"",priority:"low",start_date:new Date().toISOString().slice(0,10),due_date:"",executor_ids:[],responsible_ids:[],files:null}),C=I(()=>{var l,e,d;return((l=n.project.company)==null?void 0:l.user_id)===n.user.id||((e=n.project.managers)==null?void 0:e.some(x=>x.id===n.user.id))||((d=n.project.executors)==null?void 0:d.some(x=>x.id===n.user.id))}),M=l=>l==="high"?{text:"–í—ã—Å–æ–∫–∏–π",class:"bg-rose-50 text-rose-600 border-rose-100"}:l==="medium"?{text:"–°—Ä–µ–¥–Ω–∏–π",class:"bg-amber-50 text-amber-600 border-amber-100"}:{text:"–ù–∏–∑–∫–∏–π",class:"bg-emerald-50 text-emerald-600 border-emerald-100"},V=l=>l?new Date(l).toLocaleDateString("ru-RU",{day:"numeric",month:"short"}):"‚Äî",E=l=>(l==null?void 0:l.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase())||"?",F=l=>{o.value.files=l.target.files},H=(l,e)=>{const d=document.createElement("a");d.href=l,d.setAttribute("download",e),document.body.appendChild(d),d.click(),document.body.removeChild(d)},B=async()=>{h.value=!0,y.value="";const l=new FormData;if(l.append("title",o.value.title),l.append("priority",o.value.priority),l.append("start_date",o.value.start_date),l.append("due_date",o.value.due_date),l.append("project_id",n.project.id),l.append("company_id",n.project.company.id),o.value.executor_ids.forEach(e=>l.append("executor_ids[]",e)),o.value.responsible_ids.forEach(e=>l.append("responsible_ids[]",e)),o.value.files)for(let e=0;e<o.value.files.length;e++)l.append("files[]",o.value.files[e]);try{await J.post("/api/tasks",l),z("refresh"),u.value=!1,o.value={title:"",priority:"low",start_date:new Date().toISOString().slice(0,10),due_date:"",executor_ids:[],responsible_ids:[],files:null}}catch{y.value="–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏"}finally{h.value=!1}};return(l,e)=>{var d,x;return r(),a(v,null,[t("div",R,[t("div",Q,[t("h2",W,[e[11]||(e[11]=t("span",{class:"bg-indigo-100 text-indigo-600 p-1.5 rounded-lg"},[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})])],-1)),e[12]||(e[12]=g(" –ó–∞–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞ ",-1)),t("span",X,i(((d=c.project.tasks)==null?void 0:d.length)||0),1)]),C.value?(r(),a("button",{key:0,onClick:e[0]||(e[0]=s=>u.value=!0),class:"btn-primary group"},e[13]||(e[13]=[t("svg",{class:"w-4 h-4 mr-2 group-hover:rotate-90 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),g(" –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ ",-1)]))):m("",!0)]),(x=c.project.tasks)!=null&&x.length?(r(),a("div",Z,[(r(!0),a(v,null,k(c.project.tasks,s=>(r(),P(q(A),{key:s.id,href:`/tasks/${s.id}`,class:_(["group bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-5 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 flex flex-col justify-between",{"border-emerald-400 ring-1 ring-emerald-400 bg-emerald-50/30":s.progress===100}])},{default:S(()=>{var b,D;return[t("div",null,[t("div",ee,[t("span",{class:_(["px-2.5 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wide border",M(s.priority).class])},i(M(s.priority).text),3),t("div",{class:"flex items-center gap-1.5",title:`–ü—Ä–æ–≥—Ä–µ—Å—Å: ${s.progress}%`},[t("span",se,i(s.progress)+"%",1),t("div",le,[t("div",{class:"h-full bg-indigo-500 rounded-full transition-all duration-500",style:O(`width: ${s.progress}%`)},null,4)])],8,te)]),t("h3",oe,i(s.title),1),t("div",re,[t("div",ae,[e[17]||(e[17]=t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),g(" "+i(V(s.start_date)),1)]),e[19]||(e[19]=t("span",{class:"text-slate-300"},"‚Ä¢",-1)),t("div",{class:_(["flex items-center gap-1",{"text-rose-500":new Date(s.due_date)<new Date}])},[e[18]||(e[18]=t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),g(" "+i(V(s.due_date)),1)],2)])]),t("div",ie,[(b=s.files)!=null&&b.length?(r(),a("div",de,[(r(!0),a(v,null,k(s.files.slice(0,3),p=>(r(),a("div",{key:p.id,onClick:$(Te=>H(p.file_path,p.file_path.split("/").pop()),["prevent","stop"]),class:"flex items-center gap-1.5 px-2 py-1 bg-slate-50 hover:bg-indigo-50 border border-slate-200 hover:border-indigo-200 rounded text-[10px] text-slate-600 hover:text-indigo-700 transition cursor-pointer",title:"–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª"},e[20]||(e[20]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1),t("span",{class:"truncate max-w-[80px]"},"—Ñ–∞–π–ª",-1),t("svg",{class:"w-3 h-3 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)]),8,ne))),128)),s.files.length>3?(r(),a("span",ue,"+"+i(s.files.length-3),1)):m("",!0)])):m("",!0),t("div",pe,[t("div",ce,[(r(!0),a(v,null,k((D=s.responsibles)==null?void 0:D.slice(0,3),p=>(r(),a("div",{key:p.id,class:"w-7 h-7 rounded-full bg-white dark:bg-slate-800 border-2 border-white dark:border-slate-700 flex items-center justify-center text-[9px] font-bold text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700",title:p.name},i(E(p.name)),9,xe))),128))]),e[21]||(e[21]=t("span",{class:"text-xs text-slate-400 font-medium"},"–ü–µ—Ä–µ–π—Ç–∏ ‚Üí",-1))])])]}),_:2},1032,["href","class"]))),128))])):(r(),a("div",Y,[e[14]||(e[14]=t("div",{class:"w-16 h-16 bg-slate-50 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl"},"üì≠",-1)),e[15]||(e[15]=t("h3",{class:"text-lg font-bold text-slate-700 dark:text-white mb-1"},"–ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç",-1)),e[16]||(e[16]=t("p",{class:"text-slate-500 text-sm mb-4"},"–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º",-1)),C.value?(r(),a("button",{key:0,onClick:e[1]||(e[1]=s=>u.value=!0),class:"text-indigo-600 font-semibold hover:underline"},"–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É")):m("",!0)]))]),L(N,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:S(()=>[u.value?(r(),a("div",be,[t("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:e[2]||(e[2]=s=>u.value=!1)}),t("div",me,[t("div",ve,[e[22]||(e[22]=t("h3",{class:"text-lg font-bold text-slate-800 dark:text-white"},"–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞",-1)),t("button",{onClick:e[3]||(e[3]=s=>u.value=!1),class:"text-slate-400 hover:text-slate-600 transition"},"‚úï")]),t("div",fe,[t("form",{onSubmit:$(B,["prevent"]),class:"space-y-5"},[y.value?(r(),a("div",ge,i(y.value),1)):m("",!0),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1"},[g("–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ "),t("span",{class:"text-rose-500"},"*")],-1)),f(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.title=s),class:"input-primary",placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–∞–∫–µ—Ç–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã",required:""},null,512),[[j,o.value.title]])]),t("div",ke,[t("div",null,[e[25]||(e[25]=t("label",{class:"block text-xs font-bold text-slate-500 uppercase mb-1"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",-1)),f(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.priority=s),class:"input-primary"},e[24]||(e[24]=[t("option",{value:"low"},"üü¢ –ù–∏–∑–∫–∏–π",-1),t("option",{value:"medium"},"üü° –°—Ä–µ–¥–Ω–∏–π",-1),t("option",{value:"high"},"üî¥ –í—ã—Å–æ–∫–∏–π",-1)]),512),[[G,o.value.priority]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-xs font-bold text-slate-500 uppercase mb-1"},"–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞",-1)),f(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=s=>o.value.start_date=s),class:"input-primary"},null,512),[[j,o.value.start_date]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-xs font-bold text-slate-500 uppercase mb-1"},"–î–µ–¥–ª–∞–π–Ω",-1)),f(t("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=s=>o.value.due_date=s),class:"input-primary"},null,512),[[j,o.value.due_date]])])]),t("div",he,[t("div",ye,[e[28]||(e[28]=t("label",{class:"block text-xs font-bold text-slate-500 uppercase mb-2"},"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏",-1)),t("div",we,[(r(!0),a(v,null,k(c.employees,s=>(r(),a("label",{key:s.id,class:"flex items-center gap-2 p-1.5 hover:bg-white dark:hover:bg-slate-600 rounded cursor-pointer transition"},[f(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=b=>o.value.executor_ids=b),value:s.id,class:"rounded text-indigo-600 focus:ring-indigo-500"},null,8,_e),[[T,o.value.executor_ids]]),t("span",je,i(s.name),1)]))),128))])]),t("div",Ce,[e[29]||(e[29]=t("label",{class:"block text-xs font-bold text-slate-500 uppercase mb-2"},"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ",-1)),t("div",Me,[(r(!0),a(v,null,k(c.employees,s=>(r(),a("label",{key:s.id,class:"flex items-center gap-2 p-1.5 hover:bg-white dark:hover:bg-slate-600 rounded cursor-pointer transition"},[f(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=b=>o.value.responsible_ids=b),value:s.id,class:"rounded text-indigo-600 focus:ring-indigo-500"},null,8,Ve),[[T,o.value.responsible_ids]]),t("span",Be,i(s.name),1)]))),128))])])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1"},"–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã",-1)),t("input",{type:"file",multiple:"",onChange:F,class:"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition cursor-pointer"},null,32)])],32)]),t("div",De,[t("button",{type:"button",onClick:e[10]||(e[10]=s=>u.value=!1),class:"px-5 py-2.5 rounded-xl border border-slate-300 text-slate-600 font-medium hover:bg-slate-100 transition"},"–û—Ç–º–µ–Ω–∞"),t("button",{type:"button",onClick:B,disabled:h.value,class:"px-5 py-2.5 rounded-xl bg-indigo-600 text-white font-medium hover:bg-indigo-700 shadow-lg shadow-indigo-500/30 transition disabled:opacity-70 disabled:cursor-wait"},i(h.value?"–°–æ–∑–¥–∞–Ω–∏–µ...":"–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É"),9,Se)])])])):m("",!0)]),_:1})],64)}}},Ee=K($e,[["__scopeId","data-v-57787387"]]);export{Ee as default};
