import{h as m,c as R,o as a,a as o,b as e,g,F as C,d as $,t as u,w as L,v as I,H as A,f as D,G as j,j as M,P as E}from"./app-9ce34a01.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";const P={class:"mt-4 bg-white dark:bg-slate-800 p-4 rounded-xl shadow relative"},G={key:0,class:"text-gray-500 text-sm"},q={key:1,class:"space-y-4 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar"},J={class:"flex justify-between items-start mb-1"},K={class:"flex items-center gap-2"},O={class:"text-sm text-gray-900 dark:text-gray-100"},Q={class:"text-xs text-gray-500"},X={class:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity"},Y=["onClick"],Z={key:0,class:"mb-2 pl-2 border-l-2 border-indigo-300 dark:border-indigo-600"},ee={class:"text-xs text-indigo-600 dark:text-indigo-400 font-medium"},te={class:"text-xs text-gray-500 dark:text-gray-400 truncate italic"},se={key:1},ae={class:"mt-2 flex gap-2"},oe=["onClick"],ne={key:2},le=["innerHTML"],re={key:2,class:"mt-4 relative"},de={key:0,class:"flex items-center justify-between bg-indigo-50 dark:bg-slate-700/50 border border-indigo-100 dark:border-slate-600 rounded-t-lg px-3 py-2 text-xs mb-[-1px] z-10 relative"},ie={class:"flex flex-col overflow-hidden mr-2"},ce={class:"font-semibold text-indigo-700 dark:text-indigo-300"},ue={class:"truncate text-gray-500 dark:text-gray-400 max-w-xs italic"},me=["placeholder"],pe={key:1,class:"absolute bottom-full left-0 mb-1 bg-white dark:bg-slate-700 border dark:border-slate-600 rounded-lg shadow-xl p-0 max-h-40 overflow-auto z-50 w-64"},ge=["onClick"],ve={class:"mt-2 flex justify-end"},xe=["disabled"],be={__name:"SubtaskComments",props:{subtaskId:Number,comments:Array,canWrite:Boolean,members:{type:Array,default:()=>[]}},emits:["updated"],setup(i,{emit:S}){const h=i,w=S,r=m(""),v=m(null),x=m(""),f=m(!1),_=m(""),b=m(0),l=m(null),n=m(null),B=d=>{l.value=d,j(()=>{var s;(s=n.value)==null||s.focus()})},N=()=>{l.value=null},T=d=>{const s=d.target.value;r.value=s;const c=d.target.selectionStart;b.value=c;const p=s.slice(0,c).match(/@([\p{L}\d_]*)$/u);p?(_.value=p[1].toLowerCase(),f.value=!0):f.value=!1},V=R(()=>_.value?h.members.filter(d=>d.name.toLowerCase().includes(_.value)):h.members),U=d=>{const s=b.value,c=r.value,p=`@${d.name.replace(/\s+/g,"_")}`,y=c.slice(0,s).replace(/@([\p{L}\d_]*)$/u,p+" "),k=c.slice(s);r.value=y+k,f.value=!1,_.value="",j(()=>{n.value&&(n.value.focus(),n.value.selectionStart=n.value.selectionEnd=y.length)})},W=d=>d?d.replace(/@([\p{L}\d_]+)/gu,(s,c)=>`<span class="mention text-indigo-600 bg-indigo-50 px-1 rounded font-semibold">@${c.replace(/_/g," ")}</span>`):"",H=async()=>{if(!r.value.trim())return;const s=(r.value.match(/@([\p{L}\d_]+)/gu)||[]).map(t=>{const y=t.substring(1).replace(/_/g," ");return h.members.find(k=>k.name===y)}).filter(Boolean).map(t=>t.id),c={comment:r.value,mentions:s,parent_id:l.value?l.value.id:null};try{const{data:t}=await M.post(`/api/subtasks/${h.subtaskId}/comments`,c);w("updated",{type:"add",comment:t}),r.value="",N()}catch(t){console.error(t),alert("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐµ")}},z=async d=>{if(!x.value.trim())return;const{data:s}=await M.patch(`/api/subtask-comments/${d}`,{comment:x.value});w("updated",{type:"update",comment:s}),v.value=null,x.value=""};return(d,s)=>{var c;return a(),o("div",P,[s[5]||(s[5]=e("h3",{class:"text-lg font-semibold mb-3 dark:text-white"},"ðŸ’¬ ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸",-1)),!i.comments||i.comments.length===0?(a(),o("p",G," ÐŸÐ¾ÐºÐ° Ð½ÐµÑ‚ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÐµÐ². ")):g("",!0),i.comments&&i.comments.length?(a(),o("div",q,[(a(!0),o(C,null,$(i.comments,t=>{var p,y;return a(),o("div",{key:t.id,class:"group p-3 border dark:border-slate-700 rounded-lg bg-gray-50/50 dark:bg-slate-700/30"},[e("div",J,[e("div",K,[e("strong",O,u(((p=t.user)==null?void 0:p.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹"),1),e("span",Q,u(new Date(t.created_at).toLocaleString("ru-RU")),1)]),e("div",X,[i.canWrite?(a(),o("button",{key:0,onClick:k=>B(t),class:"text-xs text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 flex items-center gap-1",title:"ÐžÑ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ"},s[3]||(s[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"9 17 4 12 9 7"}),e("path",{d:"M20 18v-2a4 4 0 0 0-4-4H4"})],-1)]),8,Y)):g("",!0)])]),t.parent?(a(),o("div",Z,[e("div",ee,u((y=t.parent.user)==null?void 0:y.name)+": ",1),e("div",te,u(t.parent.comment),1)])):g("",!0),v.value===t.id?(a(),o("div",se,[L(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=k=>x.value=k),class:"w-full border rounded-lg px-2 py-1 mt-2 dark:bg-slate-700 dark:text-white dark:border-slate-600",rows:"2"},null,512),[[I,x.value]]),e("div",ae,[e("button",{onClick:k=>z(t.id),class:"px-3 py-1 bg-green-600 text-white rounded-lg text-xs"},"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ",8,oe),e("button",{onClick:s[1]||(s[1]=k=>v.value=null),class:"px-3 py-1 bg-gray-400 text-white rounded-lg text-xs"},"ÐžÑ‚Ð¼ÐµÐ½Ð°")])])):(a(),o("div",ne,[e("p",{class:"text-sm text-gray-800 dark:text-gray-200 whitespace-pre-line leading-relaxed",innerHTML:W(t.comment)},null,8,le)]))])}),128))])):g("",!0),i.canWrite?(a(),o("div",re,[l.value?(a(),o("div",de,[e("div",ie,[e("span",ce," Ð’ Ð¾Ñ‚Ð²ÐµÑ‚ "+u((c=l.value.user)==null?void 0:c.name),1),e("span",ue,u(l.value.comment),1)]),e("button",{onClick:N,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"}," âœ• ")])):g("",!0),L(e("textarea",{id:"subtask-comment-input",ref_key:"textareaRef",ref:n,"onUpdate:modelValue":s[2]||(s[2]=t=>r.value=t),onInput:T,onClick:T,placeholder:l.value?"ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð¾Ñ‚Ð²ÐµÑ‚...":"ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹ (@ Ð´Ð»Ñ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ)...",class:A(["w-full border px-3 py-2 dark:bg-slate-700 dark:text-white dark:border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all",l.value?"rounded-b-lg border-t-0":"rounded-lg"]),rows:"3"},null,42,me),[[I,r.value]]),f.value&&V.value.length?(a(),o("div",pe,[(a(!0),o(C,null,$(V.value,t=>(a(),o("div",{key:t.id,class:"px-3 py-2 cursor-pointer hover:bg-indigo-50 dark:hover:bg-slate-600 text-sm border-b dark:border-slate-600 last:border-0 flex items-center gap-2 text-gray-800 dark:text-gray-200",onClick:p=>U(t)},[s[4]||(s[4]=e("span",{class:"font-bold text-indigo-500"},"@",-1)),D(" "+u(t.name),1)],8,ge))),128))])):g("",!0),e("div",ve,[e("button",{onClick:H,disabled:!r.value.trim(),class:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-50 text-sm font-medium transition-colors"},u(l.value?"âž¤ ÐžÑ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ":"âž¤ ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ"),9,xe)])])):g("",!0)])}}},Se=F(be,[["__scopeId","data-v-34d1812f"]]),ke={class:"mt-6 p-4 bg-white dark:bg-slate-800 rounded-xl shadow"},he={key:0,class:"text-gray-500 text-sm"},ye={key:1,class:"space-y-3"},fe={class:"flex items-center gap-3"},_e=["checked","onChange"],we={key:0,class:"text-xs text-gray-500"},Ce={key:2,class:"mt-4"},$e=["value"],Ie={__name:"SubtaskChecklist",props:{subtaskId:Number,checklist:{type:Array,default:()=>[]},executors:{type:Array,default:()=>[]},responsibles:{type:Array,default:()=>[]},canWrite:Boolean},emits:["updated"],setup(i,{emit:S}){const h=i,w=R(()=>h.checklist??[]),r=m(""),v=m(null),x=S,f=async()=>{if(!r.value.trim())return;const{data:b}=await M.post(`/api/subtasks/${h.subtaskId}/checklist`,{title:r.value,responsible_id:v.value});x("updated",{type:"add",item:b}),r.value="",v.value=null},_=async b=>{const{data:l}=await M.patch(`/api/subtask-checklist/${b.id}/toggle`);x("updated",{type:"toggle",id:b.id,completed:l.completed})};return(b,l)=>(a(),o("div",ke,[l[3]||(l[3]=e("h3",{class:"text-lg font-semibold mb-3"},"ðŸ“ Ð§ÐµÐº-Ð»Ð¸ÑÑ‚",-1)),w.value.length===0?(a(),o("p",he," ÐŸÑƒÑÑ‚Ð¾. ")):(a(),o("div",ye,[(a(!0),o(C,null,$(w.value,n=>(a(),o("div",{key:n.id,class:"p-3 border rounded-lg dark:border-slate-700 flex justify-between items-center"},[e("div",fe,[e("input",{type:"checkbox",checked:n.completed,onChange:B=>_(n),class:"w-5 h-5"},null,40,_e),e("div",null,[e("p",{class:A(n.completed?"line-through text-gray-400":"")},u(n.title),3),n.responsible?(a(),o("p",we," ðŸ‘¤ "+u(n.responsible.name),1)):g("",!0)])])]))),128))])),i.canWrite?(a(),o("div",Ce,[L(e("input",{"onUpdate:modelValue":l[0]||(l[0]=n=>r.value=n),class:"w-full border rounded-lg px-3 py-2 dark:bg-slate-700 dark:text-white",placeholder:"ÐÐ¾Ð²Ñ‹Ð¹ Ð¿ÑƒÐ½ÐºÑ‚..."},null,512),[[I,r.value]]),L(e("select",{"onUpdate:modelValue":l[1]||(l[1]=n=>v.value=n),class:"w-full border rounded-lg px-3 py-2 mt-2 dark:bg-slate-700 dark:text-white"},[l[2]||(l[2]=e("option",{value:null},"Ð‘ÐµÐ· Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð³Ð¾",-1)),(a(!0),o(C,null,$([...i.executors,...i.responsibles],n=>(a(),o("option",{key:n.id,value:n.id},u(n.name),9,$e))),128))],512),[[E,v.value]]),e("button",{onClick:f,class:"mt-2 bg-indigo-600 text-white px-4 py-2 rounded-lg"}," âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ")])):g("",!0)]))}};export{Se as S,Ie as _};
