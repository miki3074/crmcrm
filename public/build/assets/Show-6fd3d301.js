import{Q as G,r as m,m as H,q as J,z as L,o as r,f as d,a as u,u as K,w as c,F as P,i as w,Z as R,b as t,t as x,d as T,g as y,n as F,j as g,v,x as W,e as q,s as X}from"./app-7cd1036b.js";import{_ as Y}from"./AuthenticatedLayout-24892a92.js";import"./ApplicationLogo-0e02a6b0.js";import"./_plugin-vue_export-helper-c27b6911.js";const tt={class:"flex items-center justify-between"},et={class:"text-xl font-bold text-gray-800 dark:text-gray-100"},at={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},st={class:"font-medium"},lt={class:"max-w-7xl mx-auto p-6 space-y-6"},ot={class:"flex gap-2 border-b dark:border-gray-700"},nt={key:0,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},it={class:"lg:col-span-2 bg-white dark:bg-gray-800 rounded-2xl shadow p-6"},rt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},dt={class:"md:col-span-2"},ut={class:"space-y-4"},xt={class:"bg-white dark:bg-gray-800 rounded-2xl shadow p-5"},gt={class:"text-2xl font-bold text-gray-900 dark:text-white"},pt={class:"bg-white dark:bg-gray-800 rounded-2xl shadow p-5"},mt={class:"text-2xl font-bold text-gray-900 dark:text-white"},vt={key:1},yt={class:"flex justify-between items-center mb-4"},bt={class:"bg-white dark:bg-gray-800 rounded-2xl shadow divide-y dark:divide-gray-700"},ct={class:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700"},wt={class:"text-xs uppercase"},kt={class:"flex-1"},ft={class:"flex justify-between"},ht={class:"font-medium text-gray-900 dark:text-white"},_t={class:"ml-2 text-xs px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-700"},Ct={class:"text-xs text-gray-500"},$t={class:"text-sm text-gray-700 dark:text-gray-300 mt-1 whitespace-pre-line"},jt={key:0,class:"p-6 text-sm text-gray-500 dark:text-gray-400"},Mt={key:2},St={class:"flex justify-between items-center mb-4"},Vt={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Dt={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Ut={class:"bg-white dark:bg-gray-800 rounded-xl shadow p-6 w-full max-w-lg"},Ft={class:"flex justify-end gap-2"},It={key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Nt={class:"bg-white dark:bg-gray-800 rounded-xl shadow p-6 w-full max-w-md"},zt={class:"flex justify-end gap-2"},Ot={components:{PipelineCol:{props:{title:String,items:Array,color:String},template:`
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow p-4 border-t-4" :class="color">
          <div class="flex items-center justify-between mb-3">
            <h4 class="font-semibold text-gray-900 dark:text-white">{{ title }}</h4>
            <span class="text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded">{{ items.length }}</span>
          </div>
          <div class="space-y-3">
            <slot v-for="i in items" name="item" :item="i" :key="i.id"></slot>
          </div>
        </div>
      `},DealCard:{emits:["move"],props:{deal:Object},template:`
        <div class="p-3 rounded-lg bg-gray-50 dark:bg-gray-700/40 border dark:border-gray-700">
          <div class="flex justify-between items-start">
            <div class="font-medium text-gray-900 dark:text-white">{{ deal.title }}</div>
            <div class="text-xs text-gray-500">#{{ deal.id }}</div>
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-300 mt-1" v-if="deal.amount">≈ {{ Number(deal.amount).toLocaleString() }} ₽</div>
          <div class="mt-3 flex flex-wrap gap-1">
            <button class="text-xs px-2 py-1 bg-sky-600 text-white rounded" @click="$emit('move','new')">Новый</button>
            <button class="text-xs px-2 py-1 bg-amber-600 text-white rounded" @click="$emit('move','in_progress')">В работе</button>
            <button class="text-xs px-2 py-1 bg-emerald-600 text-white rounded" @click="$emit('move','won')">Успешно</button>
            <button class="text-xs px-2 py-1 bg-rose-600 text-white rounded" @click="$emit('move','lost')">Провал</button>
          </div>
        </div>
      `}}},Et=Object.assign(Ot,{__name:"Show",setup(Bt){const{props:E}=G(),k=E.id,o=m(null),l=m("profile"),n=m({name:"",phone:"",email:"",notes:""}),p=m({type:"call",content:"",interaction_date:new Date().toISOString().slice(0,16)}),C=m(!1),$=m(!1),b=m({title:"",amount:""}),f=m([]),D=async()=>{const{data:s}=await w.get(`/api/clients/${k}`);o.value=s,n.value={name:s.name||"",phone:s.phone||"",email:s.email||"",notes:s.notes||""}},U=async()=>{const{data:s}=await w.get(`/api/clients/${k}/deals`);f.value=s},A=async()=>{await w.put(`/api/clients/${k}`,n.value),await D()},Q=async()=>{await w.post(`/api/clients/${k}/interactions`,p.value),C.value=!1,p.value={type:"call",content:"",interaction_date:new Date().toISOString().slice(0,16)},await D(),l.value="interactions"},Z=async()=>{await w.post(`/api/clients/${k}/deals`,b.value),$.value=!1,b.value={title:"",amount:""},await U(),l.value="deals"},j=H(()=>({new:f.value.filter(s=>s.status==="new"),in_progress:f.value.filter(s=>s.status==="in_progress"),won:f.value.filter(s=>s.status==="won"),lost:f.value.filter(s=>s.status==="lost")})),M=async(s,e)=>{s.status!==e&&(await w.patch(`/api/deals/${s.id}/status`,{status:e}),await U())};return J(async()=>{await D(),await U()}),(s,e)=>{var I;const S=L("DealCard"),V=L("PipelineCol");return r(),d(P,null,[u(K(R),{title:(I=o.value)!=null&&I.name?`Клиент — ${o.value.name}`:"Клиент"},null,8,["title"]),u(Y,null,{header:c(()=>{var h,_;return[t("div",tt,[t("h2",et," Клиент: "+x(((h=o.value)==null?void 0:h.name)??"..."),1),(_=o.value)!=null&&_.company?(r(),d("div",at,[e[16]||(e[16]=T(" Компания: ",-1)),t("span",st,x(o.value.company.name),1)])):y("",!0)])]}),default:c(()=>{var h,_,N,z,O,B;return[t("div",lt,[t("div",ot,[t("button",{class:F(["px-4 py-2 -mb-px",l.value==="profile"?"border-b-2 border-indigo-600 text-indigo-600":"text-gray-600 dark:text-gray-400"]),onClick:e[0]||(e[0]=a=>l.value="profile")},"Профиль",2),t("button",{class:F(["px-4 py-2 -mb-px",l.value==="interactions"?"border-b-2 border-indigo-600 text-indigo-600":"text-gray-600 dark:text-gray-400"]),onClick:e[1]||(e[1]=a=>l.value="interactions")},"Взаимодействия",2),t("button",{class:F(["px-4 py-2 -mb-px",l.value==="deals"?"border-b-2 border-indigo-600 text-indigo-600":"text-gray-600 dark:text-gray-400"]),onClick:e[2]||(e[2]=a=>l.value="deals")},"Сделки",2)]),l.value==="profile"?(r(),d("div",nt,[t("div",it,[e[21]||(e[21]=t("h3",{class:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-100"},"Карточка клиента",-1)),t("div",rt,[t("div",null,[e[17]||(e[17]=t("label",{class:"text-sm text-gray-500 dark:text-gray-400"},"Имя",-1)),g(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.name=a),class:"mt-1 w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},null,512),[[v,n.value.name]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"text-sm text-gray-500 dark:text-gray-400"},"Телефон",-1)),g(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.phone=a),class:"mt-1 w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},null,512),[[v,n.value.phone]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"text-sm text-gray-500 dark:text-gray-400"},"Email",-1)),g(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.email=a),type:"email",class:"mt-1 w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},null,512),[[v,n.value.email]])]),t("div",dt,[e[20]||(e[20]=t("label",{class:"text-sm text-gray-500 dark:text-gray-400"},"Заметки",-1)),g(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.notes=a),rows:"5",class:"mt-1 w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},null,512),[[v,n.value.notes]])])]),t("div",{class:"mt-4 flex justify-end"},[t("button",{onClick:A,class:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700"}," Сохранить ")])]),t("div",ut,[t("div",xt,[e[22]||(e[22]=t("div",{class:"text-sm text-gray-500 dark:text-gray-400"},"Взаимодействий",-1)),t("div",gt,x(((_=(h=o.value)==null?void 0:h.interactions)==null?void 0:_.length)??0),1)]),t("div",pt,[e[23]||(e[23]=t("div",{class:"text-sm text-gray-500 dark:text-gray-400"},"Сделок",-1)),t("div",mt,x(((z=(N=o.value)==null?void 0:N.deals)==null?void 0:z.length)??0),1)])])])):y("",!0),l.value==="interactions"?(r(),d("div",vt,[t("div",yt,[e[24]||(e[24]=t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100"},"История взаимодействий",-1)),t("button",{onClick:e[7]||(e[7]=a=>C.value=!0),class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"}," + Добавить ")]),t("div",bt,[(r(!0),d(P,null,W(((O=o.value)==null?void 0:O.interactions)||[],a=>{var i;return r(),d("div",{key:a.id,class:"p-4 flex items-start gap-3"},[t("span",ct,[t("span",wt,x(a.type[0]),1)]),t("div",kt,[t("div",ft,[t("div",ht,[T(x(((i=a.user)==null?void 0:i.name)||"—")+" ",1),t("span",_t,x(a.type),1)]),t("div",Ct,x(new Date(a.interaction_date).toLocaleString()),1)]),t("div",$t,x(a.content),1)])])}),128)),(((B=o.value)==null?void 0:B.interactions)||[]).length===0?(r(),d("div",jt," Пока нет взаимодействий. ")):y("",!0)])])):y("",!0),l.value==="deals"?(r(),d("div",Mt,[t("div",St,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100"},"Сделки",-1)),t("button",{onClick:e[8]||(e[8]=a=>$.value=!0),class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"}," + Новая сделка ")]),t("div",Vt,[u(V,{title:"Новые",items:j.value.new,color:"border-sky-500"},{item:c(({item:a})=>[u(S,{deal:a,onMove:i=>M(a,i)},null,8,["deal","onMove"])]),_:1},8,["items"]),u(V,{title:"В работе",items:j.value.in_progress,color:"border-amber-500"},{item:c(({item:a})=>[u(S,{deal:a,onMove:i=>M(a,i)},null,8,["deal","onMove"])]),_:1},8,["items"]),u(V,{title:"Успешные",items:j.value.won,color:"border-emerald-500"},{item:c(({item:a})=>[u(S,{deal:a,onMove:i=>M(a,i)},null,8,["deal","onMove"])]),_:1},8,["items"]),u(V,{title:"Проваленные",items:j.value.lost,color:"border-rose-500"},{item:c(({item:a})=>[u(S,{deal:a,onMove:i=>M(a,i)},null,8,["deal","onMove"])]),_:1},8,["items"])])])):y("",!0)]),C.value?(r(),d("div",Dt,[t("div",Ut,[e[31]||(e[31]=t("h3",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-white"},"Новое взаимодействие",-1)),t("form",{onSubmit:q(Q,["prevent"]),class:"space-y-3"},[t("div",null,[e[27]||(e[27]=t("label",{class:"text-sm text-gray-500 dark:text-gray-400"},"Тип",-1)),g(t("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>p.value.type=a),class:"mt-1 w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},e[26]||(e[26]=[t("option",{value:"call"},"Звонок",-1),t("option",{value:"meeting"},"Встреча",-1),t("option",{value:"email"},"Письмо",-1),t("option",{value:"comment"},"Комментарий",-1)]),512),[[X,p.value.type]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"text-sm text-gray-500 dark:text-gray-400"},"Дата/время",-1)),g(t("input",{type:"datetime-local","onUpdate:modelValue":e[10]||(e[10]=a=>p.value.interaction_date=a),class:"mt-1 w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},null,512),[[v,p.value.interaction_date]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"text-sm text-gray-500 dark:text-gray-400"},"Содержание",-1)),g(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=a=>p.value.content=a),rows:"5",class:"mt-1 w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},null,512),[[v,p.value.content]])]),t("div",Ft,[t("button",{type:"button",onClick:e[12]||(e[12]=a=>C.value=!1),class:"px-3 py-2 bg-gray-500 text-white rounded"},"Отмена"),e[30]||(e[30]=t("button",{type:"submit",class:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"},"Сохранить",-1))])],32)])])):y("",!0),$.value?(r(),d("div",It,[t("div",Nt,[e[35]||(e[35]=t("h3",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-white"},"Новая сделка",-1)),t("form",{onSubmit:q(Z,["prevent"]),class:"space-y-3"},[t("div",null,[e[32]||(e[32]=t("label",{class:"text-sm text-gray-500 dark:text-gray-400"},"Название",-1)),g(t("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>b.value.title=a),class:"mt-1 w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white",required:""},null,512),[[v,b.value.title]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"text-sm text-gray-500 dark:text-gray-400"},"Сумма (₽)",-1)),g(t("input",{type:"number",min:"0",step:"0.01","onUpdate:modelValue":e[14]||(e[14]=a=>b.value.amount=a),class:"mt-1 w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},null,512),[[v,b.value.amount]])]),t("div",zt,[t("button",{type:"button",onClick:e[15]||(e[15]=a=>$.value=!1),class:"px-3 py-2 bg-gray-500 text-white rounded"},"Отмена"),e[34]||(e[34]=t("button",{type:"submit",class:"px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700"},"Создать",-1))])],32)])])):y("",!0)]}),_:1})],64)}}});export{Et as default};
