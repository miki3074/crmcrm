import{r as n,x as U,o as r,G as V,J as $,f as y,a,c as o,t as i,d as x,F as f,e as h,h as p,v,L as B}from"./app-79ce4b65.js";import{_ as E}from"./AuthenticatedLayout-be7f21bd.js";import"./ApplicationLogo-c4e9f3e7.js";import"./_plugin-vue_export-helper-c27b6911.js";const D={class:"p-6"},F={key:0,class:"text-red-600 mb-3"},M={key:1,class:"text-gray-500"},j={key:2,class:"w-full border-collapse border border-gray-200 dark:border-gray-700"},I={class:"border px-3 py-2"},L={class:"border px-3 py-2"},N={class:"border px-3 py-2"},S={class:"border px-3 py-2 flex gap-2"},T=["onClick"],z=["onClick"],G={key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},J={class:"bg-white dark:bg-gray-800 rounded-xl p-6 w-96"},q=["value"],A={class:"flex justify-end gap-2"},R={__name:"Index",setup(H){const g=n([]),c=n(!0),u=n(""),d=n(null),l=n({name:"",email:"",password:""}),k=["admin","manager","employee","support"],m=async()=>{var s,t;c.value=!0,u.value="";try{const{data:e}=await y.get("/api/users",{withCredentials:!0});g.value=e}catch(e){u.value=((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.message)||"Ошибка загрузки пользователей"}finally{c.value=!1}},w=s=>{var t;d.value=s,l.value={name:s.name,email:s.email,password:"",roles:((t=s.roles)==null?void 0:t.map(e=>e.name))||[]}},_=async()=>{var s,t;if(d.value)try{await y.put(`/api/users/${d.value.id}`,l.value,{withCredentials:!0}),await m(),d.value=null,alert("Пользователь обновлён")}catch(e){alert(((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.message)||"Ошибка при обновлении")}},C=async s=>{var t,e;if(confirm("Удалить пользователя?"))try{await y.delete(`/api/users/${s}`,{withCredentials:!0}),await m(),alert("Пользователь удалён")}catch(b){alert(((e=(t=b.response)==null?void 0:t.data)==null?void 0:e.message)||"Ошибка при удалении")}};return n(!1),U(m),(s,t)=>(r(),V(E,null,{default:$(()=>[a("div",D,[t[7]||(t[7]=a("h1",{class:"text-2xl font-semibold text-gray-700 dark:text-gray-100 mb-4"}," Управление пользователями ",-1)),u.value?(r(),o("p",F,i(u.value),1)):x("",!0),c.value?(r(),o("p",M,"Загрузка...")):(r(),o("table",j,[t[5]||(t[5]=a("thead",{class:"bg-gray-100 dark:bg-gray-800"},[a("tr",null,[a("th",{class:"border px-3 py-2 text-left"},"ID"),a("th",{class:"border px-3 py-2 text-left"},"Имя"),a("th",{class:"border px-3 py-2 text-left"},"Email"),a("th",{class:"border px-3 py-2 text-left"},"Действия")])],-1)),a("tbody",null,[(r(!0),o(f,null,h(g.value,e=>(r(),o("tr",{key:e.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[a("td",I,i(e.id),1),a("td",L,i(e.name),1),a("td",N,i(e.email),1),a("td",S,[a("button",{onClick:b=>w(e),class:"text-indigo-600 hover:underline"},"Редактировать",8,T),a("button",{onClick:b=>C(e.id),class:"text-rose-600 hover:underline"},"Удалить",8,z)])]))),128))])])),d.value?(r(),o("div",G,[a("div",J,[t[6]||(t[6]=a("h3",{class:"text-lg font-semibold mb-4"},"Редактировать пользователя",-1)),p(a("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.name=e),type:"text",placeholder:"Имя",class:"w-full border rounded p-2 mb-2 dark:bg-gray-700 dark:text-white"},null,512),[[v,l.value.name]]),p(a("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.email=e),type:"email",placeholder:"Email",class:"w-full border rounded p-2 mb-2 dark:bg-gray-700 dark:text-white"},null,512),[[v,l.value.email]]),p(a("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.password=e),type:"password",placeholder:"Новый пароль (если нужно)",autocomplete:"new-password",class:"w-full border rounded p-2 mb-4 dark:bg-gray-700 dark:text-white"},null,512),[[v,l.value.password]]),p(a("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.roles=e),multiple:"",class:"w-full border rounded p-2 mb-4 dark:bg-gray-700 dark:text-white"},[(r(),o(f,null,h(k,e=>a("option",{key:e,value:e},i(e),9,q)),64))],512),[[B,l.value.roles]]),a("div",A,[a("button",{onClick:t[4]||(t[4]=e=>d.value=null),class:"px-4 py-2 border rounded-lg"},"Отмена"),a("button",{onClick:_,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg"},"Сохранить")])])])):x("",!0)])]),_:1}))}};export{R as default};
