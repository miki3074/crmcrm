import{Q,m as u,k as C,p as R,o as l,f as r,a as U,u as P,w as Z,F as p,l as b,Z as G,b as t,g,t as d,d as c,s as M,e as J,h,v as V,q as K,n as W}from"./app-5838d16e.js";import{_ as X}from"./AuthenticatedLayout-f128b6cc.js";import"./ApplicationLogo-835d2202.js";import"./_plugin-vue_export-helper-c27b6911.js";const Y={class:"relative overflow-hidden"},tt={class:"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 text-white"},et={class:"flex items-center gap-4"},st=["src"],at={class:"text-2xl sm:text-3xl font-semibold"},lt={class:"text-white/80 text-sm mt-1"},rt={key:0,class:"ml-2 px-2 py-0.5 text-xs rounded-full bg-white/20"},it={key:1,class:"ml-2 px-2 py-0.5 text-xs rounded-full bg-white/20"},ot={key:1,class:"ml-auto"},nt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-6"},dt={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},ut={key:1,class:"rounded-2xl border bg-white dark:bg-gray-800 p-10 text-center"},gt={key:0,class:"mt-6"},xt={key:2,class:"mt-6"},vt={class:"flex items-center justify-between mb-3"},mt={class:"text-sm text-gray-500 dark:text-gray-400"},ct={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},yt=["onClick"],pt={class:"flex items-start justify-between gap-3"},bt={class:"text-base font-semibold text-gray-900 dark:text-white leading-snug"},ht={class:"mt-3 space-y-1.5 text-sm text-gray-600 dark:text-gray-300"},wt={class:"flex items-center gap-2"},ft={class:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 text-xs font-medium"},kt={class:"truncate"},_t={class:"text-gray-800 dark:text-white"},Ct={class:"flex items-center gap-2"},Mt={class:"text-gray-800 dark:text-white"},Vt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},zt={class:"relative w-full max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6"},$t={class:"flex items-center justify-between"},jt={key:0,class:"mt-3 text-sm text-rose-600"},Dt=["value"],Bt={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},St={class:"flex justify-end gap-2 pt-2"},qt=["disabled"],Ht={key:0},It={key:1},Tt={__name:"Show",setup(Lt){const{props:w}=Q(),f=w.id,k=u(!0),o=u(null),z=u([]),x=u(!1),y=u(!1),v=u(""),n=u({name:"",manager_id:"",start_date:new Date().toISOString().slice(0,10),duration_days:""}),$=C(()=>{var a;return(((a=w.auth)==null?void 0:a.roles)||[]).includes("admin")}),j=C(()=>{var a,e,i;return((a=o.value)==null?void 0:a.user_id)===((i=(e=w.auth)==null?void 0:e.user)==null?void 0:i.id)}),D=C(()=>$.value||j.value),F=new Date,B=(a,e)=>{if(!a||!e)return"—";const i=new Date(a),m=new Date(i);return m.setDate(i.getDate()+Number(e)),Math.ceil((m-F)/(1e3*60*60*24))},O=a=>a>7?"bg-emerald-100 text-emerald-700 ring-1 ring-emerald-200":a>=0?"bg-amber-100 text-amber-700 ring-1 ring-amber-200":"bg-rose-100 text-rose-700 ring-1 ring-rose-200",T=a=>(a||"").split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase(),S=async()=>{k.value=!0;try{const{data:a}=await b.get(`/api/companies/${f}`);o.value=a}finally{k.value=!1}},A=async()=>{const{data:a}=await b.get("/api/users/managers");z.value=a},q=async()=>{v.value="",await A(),x.value=!0},E=async()=>{var a,e;v.value="",y.value=!0;try{await b.get("/sanctum/csrf-cookie"),await b.post("/api/projects",{...n.value,company_id:f}),x.value=!1,n.value={name:"",manager_id:"",start_date:new Date().toISOString().slice(0,10),duration_days:""},await S()}catch(i){v.value=((e=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:e.message)||"Не удалось создать проект"}finally{y.value=!1}};return R(S),(a,e)=>{var i;return l(),r(p,null,[U(P(G),{title:(i=o.value)!=null&&i.name?`Компания — ${o.value.name}`:"Компания"},null,8,["title"]),U(X,null,{default:Z(()=>{var m,_,H,I;return[t("div",Y,[e[8]||(e[8]=t("div",{class:"absolute inset-0 bg-gradient-to-r from-indigo-600 via-purple-600 to-fuchsia-600 opacity-90"},null,-1)),t("div",tt,[t("div",et,[(m=o.value)!=null&&m.logo?(l(),r("img",{key:0,src:`/storage/${o.value.logo}`,alt:"Logo",class:"w-16 h-16 rounded-xl object-cover ring-2 ring-white/30"},null,8,st)):g("",!0),t("div",null,[t("h1",at,d(((_=o.value)==null?void 0:_.name)??"Компания"),1),t("p",lt,[c(" ID: "+d(P(f))+" ",1),j.value?(l(),r("span",rt,"Владелец")):$.value?(l(),r("span",it,"Администратор")):g("",!0)])]),D.value?(l(),r("div",ot,[t("button",{onClick:q,class:"inline-flex items-center gap-2 rounded-xl bg-white text-gray-900 px-4 py-2.5 shadow/50 hover:shadow transition"},e[7]||(e[7]=[t("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2h5z"})],-1),c(" Создать проект ",-1)]))])):g("",!0)])])]),t("div",nt,[k.value?(l(),r("div",dt,[(l(),r(p,null,M(6,s=>t("div",{key:s,class:"rounded-2xl border bg-white dark:bg-gray-800 p-4 animate-pulse"},e[9]||(e[9]=[t("div",{class:"h-5 w-1/2 bg-gray-200 dark:bg-gray-700 rounded mb-4"},null,-1),t("div",{class:"space-y-2"},[t("div",{class:"h-3 w-3/4 bg-gray-200 dark:bg-gray-700 rounded"}),t("div",{class:"h-3 w-2/3 bg-gray-200 dark:bg-gray-700 rounded"}),t("div",{class:"h-3 w-1/2 bg-gray-200 dark:bg-gray-700 rounded"})],-1)]))),64))])):(I=(H=o.value)==null?void 0:H.projects)!=null&&I.length?(l(),r("div",xt,[t("div",vt,[e[13]||(e[13]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Проекты компании",-1)),t("div",mt," Всего: "+d(o.value.projects.length),1)]),t("div",ct,[(l(!0),r(p,null,M(o.value.projects,s=>{var L,N;return l(),r("div",{key:s.id,class:"group rounded-2xl border bg-white dark:bg-gray-800 p-5 hover:shadow-lg transition cursor-pointer",onClick:Nt=>a.$inertia.visit(`/projects/${s.id}`)},[t("div",pt,[t("h3",bt,d(s.name),1),s.duration_days?(l(),r("span",{key:0,class:W([["px-2 py-1 text-xs rounded-full ring-1",O(B(s.start_date,s.duration_days))],"shrink-0"])},d(B(s.start_date,s.duration_days))+" дн. ",3)):g("",!0)]),t("div",ht,[t("div",wt,[t("span",ft,d(T((L=s.manager)==null?void 0:L.name)||"PM"),1),t("span",kt,[e[14]||(e[14]=c(" Руководитель: ",-1)),t("b",_t,d(((N=s.manager)==null?void 0:N.name)??"—"),1)])]),t("div",Ct,[e[16]||(e[16]=t("svg",{class:"w-4 h-4 text-gray-400",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M7 11h5V6H7v5zm0 7h5v-5H7v5zm7 0h5v-5h-5v5zM14 6v5h5V6h-5z"})],-1)),t("span",null,[e[15]||(e[15]=c("Старт: ",-1)),t("b",Mt,d(s.start_date),1)])])]),e[17]||(e[17]=t("div",{class:"mt-4 flex items-center justify-end"},[t("span",{class:"text-indigo-600 group-hover:translate-x-0.5 transition inline-flex items-center gap-1 text-sm"},[c(" Открыть "),t("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M13 5l7 7-7 7v-4H4v-6h9V5z"})])])],-1))],8,yt)}),128))])])):(l(),r("div",ut,[e[10]||(e[10]=t("div",{class:"mx-auto w-16 h-16 rounded-2xl bg-indigo-100 text-indigo-600 flex items-center justify-center"},[t("svg",{class:"w-7 h-7",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 3l4 4H8l4-4zm0 18l-4-4h8l-4 4zM3 12l4-4v8l-4-4zm18 0l-4 4V8l4 4z"})])],-1)),e[11]||(e[11]=t("h3",{class:"mt-4 text-lg font-semibold text-gray-900 dark:text-white"},"Проектов пока нет",-1)),e[12]||(e[12]=t("p",{class:"text-gray-600 dark:text-gray-300 mt-1"},"Создайте первый проект для этой компании.",-1)),D.value?(l(),r("div",gt,[t("button",{onClick:q,class:"rounded-xl bg-indigo-600 text-white px-5 py-2.5 hover:bg-indigo-700 transition"}," Новый проект ")])):g("",!0)]))]),x.value?(l(),r("div",Vt,[t("div",{class:"absolute inset-0 bg-black/50",onClick:e[0]||(e[0]=s=>x.value=!1)}),t("div",zt,[t("div",$t,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Создать проект",-1)),t("button",{onClick:e[1]||(e[1]=s=>x.value=!1),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"}," ✕ ")]),v.value?(l(),r("p",jt,d(v.value),1)):g("",!0),t("form",{class:"mt-4 space-y-4",onSubmit:J(E,["prevent"])},[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Название проекта",-1)),h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.name=s),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:"",placeholder:"Например, CRM v2"},null,512),[[V,n.value.name]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Руководитель",-1)),h(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.manager_id=s),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:""},[e[20]||(e[20]=t("option",{disabled:"",value:""},"Выберите менеджера",-1)),(l(!0),r(p,null,M(z.value,s=>(l(),r("option",{key:s.id,value:s.id},d(s.name),9,Dt))),128))],512),[[K,n.value.manager_id]])]),t("div",Bt,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Дата начала",-1)),h(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=s=>n.value.start_date=s),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:""},null,512),[[V,n.value.start_date]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Длительность (дней)",-1)),h(t("input",{type:"number",min:"1","onUpdate:modelValue":e[5]||(e[5]=s=>n.value.duration_days=s),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:"",placeholder:"Напр., 30"},null,512),[[V,n.value.duration_days]])])]),t("div",St,[t("button",{type:"button",onClick:e[6]||(e[6]=s=>x.value=!1),class:"px-4 py-2 rounded-xl border bg-white dark:bg-gray-700 dark:text-white"}," Отмена "),t("button",{type:"submit",disabled:y.value,class:"px-4 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60"},[y.value?(l(),r("span",It,"Сохраняю…")):(l(),r("span",Ht,"Создать"))],8,qt)])],32)])])):g("",!0)]}),_:1})],64)}}};export{Tt as default};
