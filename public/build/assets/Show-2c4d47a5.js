import{Q as w,r as S,x as C,o as n,c as m,k as u,u as i,J as b,F as R,f as h,Z as $,G as B,d as U,a as _}from"./app-0c17e5ad.js";import{_ as F}from"./AuthenticatedLayout-e4f4bca7.js";import I from"./SubtaskHeader-2c4b3658.js";import N from"./SubtaskMembers-874dac4e.js";import V from"./SubtaskProgress-e2be0e05.js";import W from"./SubtaskDescription-d10b7786.js";import j from"./SubtaskFiles-76eb22f1.js";import M from"./SubtaskChildren-c29bd15e.js";import{_ as E,S as G}from"./SubtaskChecklist-8f4bf31b.js";import"./ApplicationLogo-792ed34e.js";import"./_plugin-vue_export-helper-c27b6911.js";const J={class:"max-w-4xl mx-auto py-8 px-4"},Q={key:0,class:"grid gap-6"},Z={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},q={key:1,class:"text-gray-600 dark:text-gray-300 text-center py-10"},se={__name:"Show",setup(z){var v;const{props:k}=w(),f=k.id,o=(v=k.auth)==null?void 0:v.user,e=S(null),d=async()=>{try{const{data:s}=await h.get(`/api/subtasks/${f}`);e.value=s}catch(s){console.error("Ошибка загрузки подзадачи",s)}},c=async()=>{await d()},x=({type:s,comment:t,id:r})=>{if(e.value.comments||(e.value.comments=[]),s==="add"&&e.value.comments.push(t),s==="update"){const a=e.value.comments.findIndex(l=>l.id===t.id);a!==-1&&(e.value.comments[a]=t)}s==="delete"&&(e.value.comments=e.value.comments.filter(a=>a.id!==r))},g=s=>{if(e.value.checklist||(e.value.checklist=[]),s.type==="add"&&e.value.checklist.push(s.item),s.type==="toggle"){const t=e.value.checklist.find(r=>r.id===s.id);t&&(t.completed=s.completed)}s.type==="delete"&&(e.value.checklist=e.value.checklist.filter(t=>t.id!==s.id))},p=()=>{var t,r;if(!e.value||!o)return!1;const s=((t=e.value.task)==null?void 0:t.project)||{};return e.value.creator_id===o.id||(s.managers||[]).some(a=>a.id===o.id)||(s.executors||[]).some(a=>a.id===o.id)||((r=s.company)==null?void 0:r.user_id)===o.id||(e.value.executors||[]).some(a=>a.id===o.id)||(e.value.responsibles||[]).some(a=>a.id===o.id)},y=async s=>{var r,a;const t=s||f;if(t)try{const{data:l}=await h.post(`/api/subtasks/${t}/start`);alert("Вы взяли подзадачу в работу!"),await d()}catch(l){console.error(l),alert(((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"Ошибка")}};return C(d),(s,t)=>(n(),m(R,null,[u(i($),{title:"Подзадача"}),u(F,null,{header:b(()=>[e.value?(n(),B(I,{key:0,subtask:e.value,user:i(o),onRefresh:c,onStartWork:y},null,8,["subtask","user"])):U("",!0)]),default:b(()=>[_("div",J,[e.value?(n(),m("div",Q,[u(N,{subtask:e.value,user:i(o),onRefresh:c},null,8,["subtask","user"]),u(W,{subtask:e.value,user:i(o),onRefresh:c},null,8,["subtask","user"]),u(V,{subtask:e.value,user:i(o),onRefresh:c},null,8,["subtask","user"]),u(j,{subtask:e.value,user:i(o),onRefresh:c},null,8,["subtask","user"]),u(M,{subtask:e.value,user:i(o),onRefresh:c},null,8,["subtask","user"]),_("div",Z,[u(E,{"subtask-id":e.value.id,checklist:e.value.checklist,executors:e.value.executors,responsibles:e.value.responsibles,"can-write":p(),onUpdated:g},null,8,["subtask-id","checklist","executors","responsibles","can-write"]),u(G,{"subtask-id":e.value.id,comments:e.value.comments,"can-write":p(),members:[...e.value.executors??[],...e.value.responsibles??[]],onUpdated:x},null,8,["subtask-id","comments","can-write","members"])])])):(n(),m("div",q,"Загрузка..."))])]),_:1})],64))}};export{se as default};
