import{r as i,j as I,o as l,c as a,a as t,t as o,d as g,F as b,e as m,h as y,K as U,f as V,i as F,b as K}from"./app-34d1bdb8.js";import{_ as W}from"./_plugin-vue_export-helper-c27b6911.js";const X={class:"bg-white dark:bg-gray-800 rounded-2xl shadow p-6"},Y={class:"grid sm:grid-cols-2 gap-4 text-sm"},Z={class:"font-medium text-gray-900 dark:text-white"},ee={class:"font-medium text-gray-900 dark:text-white"},te={class:"font-medium text-gray-900 dark:text-white"},se={key:0,class:"flex flex-wrap gap-2 mt-4 content-start"},le={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},ae={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-md"},ne={class:"max-h-60 overflow-y-auto border p-2 mb-4 dark:text-white"},oe=["value"],ue={class:"flex justify-end gap-2"},re={key:1,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},de={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-md"},ie={class:"max-h-60 overflow-y-auto border p-2 mb-4 dark:text-white"},be=["value"],ce={class:"flex justify-end gap-2"},ve={key:2,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},me={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-md"},pe=["value"],xe=["value"],ke={class:"text-red-500 text-sm"},fe={class:"flex justify-end gap-2 mt-4"},ge={key:3,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},ye={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-md"},we=["value"],he=["value"],Ce={class:"text-red-500 text-sm"},je={class:"flex justify-end gap-2 mt-4"},_e={key:4,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},$e={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-3xl"},Me={class:"grid sm:grid-cols-2 gap-6"},Ue={class:"mt-2 space-y-2"},Ve=["onClick"],Ee={class:"mt-2 space-y-2"},Se=["onClick"],ze={class:"flex justify-end mt-4"},Ie={__name:"SubtaskMembers",props:["subtask","user"],emits:["refresh"],setup(d,{emit:L}){const c=d,E=L,C=i(!1),j=i(!1),_=i(!1),$=i(!1),S=i(!1),f=i([]),p=i([]),x=i(null),k=i(null),w=i(""),T=I(()=>{var u,r,h,s,v,N,D;const n=c.user,e=c.subtask;return!e||!n?!1:n.id===((h=(r=(u=e.task)==null?void 0:u.project)==null?void 0:r.company)==null?void 0:h.user_id)||(((v=(s=e.task)==null?void 0:s.project)==null?void 0:v.managers)||[]).some(z=>z.id===n.id)||(((D=(N=e.task)==null?void 0:N.project)==null?void 0:D.executors)||[]).some(z=>z.id===n.id)}),q=I(()=>{const n=(c.subtask.executors||[]).map(e=>e.id);return f.value.filter(e=>!n.includes(e.id))}),G=I(()=>{const n=(c.subtask.responsibles||[]).map(e=>e.id);return f.value.filter(e=>!n.includes(e.id))}),H=async()=>{if(f.value.length)return;const{data:n}=await V.get(`/api/projects/${c.subtask.task.project.id}/employees`);f.value=n},M=async()=>{await H(),x.value=null,k.value=null,p.value=[],w.value=""},J=async()=>{await M(),C.value=!0},O=async()=>{await M(),j.value=!0},P=async()=>{await M(),_.value=!0},Q=async()=>{await M(),$.value=!0},R=async n=>{if(p.value.length)try{const e=n==="executor"?"executors/add":"responsibles/add";await V.post(`/api/subtasks/${c.subtask.id}/${e}`,{user_ids:p.value}),E("refresh"),_.value=!1,$.value=!1}catch{alert("ÐžÑˆÐ¸Ð±ÐºÐ°")}},A=async n=>{var e,u;if(!x.value||!k.value){w.value="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð±Ð¾Ð¸Ñ… ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²";return}try{const r=n==="executor"?"executor/change":"responsible/change";await V.patch(`/api/subtasks/${c.subtask.id}/${r}`,{replace_user_id:x.value,user_id:k.value}),E("refresh"),C.value=!1,j.value=!1}catch(r){w.value=(u=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:u.message}},B=async(n,e)=>{try{const u=n==="executor"?"executors":"responsibles";await V.delete(`/api/subtasks/${c.subtask.id}/${u}`,{data:{user_id:e}}),E("refresh")}catch{alert("ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ")}};return(n,e)=>{var u,r,h;return l(),a(b,null,[t("div",X,[t("div",Y,[t("div",null,[e[16]||(e[16]=t("p",{class:"text-gray-500 dark:text-gray-400"},"ÐÐ²Ñ‚Ð¾Ñ€",-1)),t("p",Z,o((u=d.subtask.creator)==null?void 0:u.name),1),e[17]||(e[17]=t("p",{class:"text-gray-500 dark:text-gray-400 mt-4"},"Ð˜ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒ",-1)),t("p",ee,o((r=d.subtask.executors)!=null&&r.length?d.subtask.executors.map(s=>s.name).join(", "):"â€”"),1),e[18]||(e[18]=t("p",{class:"text-gray-500 dark:text-gray-400 mt-4"},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹",-1)),t("p",te,o((h=d.subtask.responsibles)!=null&&h.length?d.subtask.responsibles.map(s=>s.name).join(", "):"â€”"),1)]),T.value?(l(),a("div",se,[t("button",{onClick:J,class:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded-md"}," âœï¸ Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¸ÑÐ¿. "),t("button",{onClick:O,class:"px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded-md"}," âœï¸ Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð². "),t("button",{onClick:P,class:"px-3 py-1 bg-emerald-500 hover:bg-emerald-600 text-white rounded-md"}," âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¸ÑÐ¿. "),t("button",{onClick:Q,class:"px-3 py-1 bg-amber-500 hover:bg-amber-600 text-white rounded-md"}," âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð². "),t("button",{onClick:e[0]||(e[0]=s=>S.value=!0),class:"px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg w-full sm:w-auto"}," ðŸ‘¥ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ")])):g("",!0)])]),_.value?(l(),a("div",le,[t("div",ae,[e[19]||(e[19]=t("h3",{class:"font-bold mb-3 dark:text-white"},"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÐµÐ¹",-1)),t("div",ne,[(l(!0),a(b,null,m(f.value,s=>(l(),a("label",{key:s.id,class:"flex gap-2"},[y(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=v=>p.value=v),value:s.id},null,8,oe),[[F,p.value]]),K(o(s.name),1)]))),128))]),t("div",ue,[t("button",{onClick:e[2]||(e[2]=s=>_.value=!1),class:"btn-cancel"},"ÐžÑ‚Ð¼ÐµÐ½Ð°"),t("button",{onClick:e[3]||(e[3]=s=>R("executor")),class:"btn-ok"},"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ")])])])):g("",!0),$.value?(l(),a("div",re,[t("div",de,[e[20]||(e[20]=t("h3",{class:"font-bold mb-3 dark:text-white"},"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ñ…",-1)),t("div",ie,[(l(!0),a(b,null,m(f.value,s=>(l(),a("label",{key:s.id,class:"flex gap-2"},[y(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=v=>p.value=v),value:s.id},null,8,be),[[F,p.value]]),K(o(s.name),1)]))),128))]),t("div",ce,[t("button",{onClick:e[5]||(e[5]=s=>$.value=!1),class:"btn-cancel"},"ÐžÑ‚Ð¼ÐµÐ½Ð°"),t("button",{onClick:e[6]||(e[6]=s=>R("responsible")),class:"btn-ok"},"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ")])])])):g("",!0),C.value?(l(),a("div",ve,[t("div",me,[e[23]||(e[23]=t("h3",{class:"font-bold mb-3 dark:text-white"},"Ð—Ð°Ð¼ÐµÐ½Ð° Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ñ",-1)),y(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>x.value=s),class:"w-full border p-2 mb-2"},[e[21]||(e[21]=t("option",{value:null},"ÐšÐ¾Ð³Ð¾ Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ",-1)),(l(!0),a(b,null,m(d.subtask.executors,s=>(l(),a("option",{value:s.id,key:s.id},o(s.name),9,pe))),128))],512),[[U,x.value]]),y(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>k.value=s),class:"w-full border p-2 mb-2"},[e[22]||(e[22]=t("option",{value:null},"ÐÐ° ÐºÐ¾Ð³Ð¾",-1)),(l(!0),a(b,null,m(q.value,s=>(l(),a("option",{value:s.id,key:s.id},o(s.name),9,xe))),128))],512),[[U,k.value]]),t("p",ke,o(w.value),1),t("div",fe,[t("button",{onClick:e[9]||(e[9]=s=>C.value=!1),class:"btn-cancel"},"ÐžÑ‚Ð¼ÐµÐ½Ð°"),t("button",{onClick:e[10]||(e[10]=s=>A("executor")),class:"btn-ok"},"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ")])])])):g("",!0),j.value?(l(),a("div",ge,[t("div",ye,[e[26]||(e[26]=t("h3",{class:"font-bold mb-3 dark:text-white"},"Ð—Ð°Ð¼ÐµÐ½Ð° Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð³Ð¾",-1)),y(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>x.value=s),class:"w-full border p-2 mb-2"},[e[24]||(e[24]=t("option",{value:null},"ÐšÐ¾Ð³Ð¾ Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ",-1)),(l(!0),a(b,null,m(d.subtask.responsibles,s=>(l(),a("option",{value:s.id,key:s.id},o(s.name),9,we))),128))],512),[[U,x.value]]),y(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>k.value=s),class:"w-full border p-2 mb-2"},[e[25]||(e[25]=t("option",{value:null},"ÐÐ° ÐºÐ¾Ð³Ð¾",-1)),(l(!0),a(b,null,m(G.value,s=>(l(),a("option",{value:s.id,key:s.id},o(s.name),9,he))),128))],512),[[U,k.value]]),t("p",Ce,o(w.value),1),t("div",je,[t("button",{onClick:e[13]||(e[13]=s=>j.value=!1),class:"btn-cancel"},"ÐžÑ‚Ð¼ÐµÐ½Ð°"),t("button",{onClick:e[14]||(e[14]=s=>A("responsible")),class:"btn-ok"},"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ")])])])):g("",!0),S.value?(l(),a("div",_e,[t("div",$e,[e[29]||(e[29]=t("h3",{class:"font-bold mb-4 dark:text-white"},"Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ°Ð¼Ð¸",-1)),t("div",Me,[t("div",null,[e[27]||(e[27]=t("h4",{class:"font-medium dark:text-white"},"Ð˜ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ð¸",-1)),t("ul",Ue,[(l(!0),a(b,null,m(d.subtask.executors,s=>(l(),a("li",{key:s.id,class:"flex justify-between bg-gray-100 p-2 rounded"},[t("span",null,o(s.name),1),t("button",{onClick:v=>B("executor",s.id),class:"text-red-500"},"âŒ",8,Ve)]))),128))])]),t("div",null,[e[28]||(e[28]=t("h4",{class:"font-medium dark:text-white"},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ",-1)),t("ul",Ee,[(l(!0),a(b,null,m(d.subtask.responsibles,s=>(l(),a("li",{key:s.id,class:"flex justify-between bg-gray-100 p-2 rounded"},[t("span",null,o(s.name),1),t("button",{onClick:v=>B("responsible",s.id),class:"text-red-500"},"âŒ",8,Se)]))),128))])])]),t("div",ze,[t("button",{onClick:e[15]||(e[15]=s=>S.value=!1),class:"btn-cancel"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])])):g("",!0)],64)}}},Be=W(Ie,[["__scopeId","data-v-a53b4016"]]);export{Be as default};
