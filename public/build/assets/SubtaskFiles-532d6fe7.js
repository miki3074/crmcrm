import{h as c,c as _,o as a,a as n,b as r,g as i,F as T,d as V,j as x,H as w,t as v,f as H,k as L,w as N,v as U}from"./app-e2bfa4e1.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";const A={class:"bg-white dark:bg-gray-800 rounded-2xl shadow p-6"},E={class:"flex items-center justify-between mb-4"},q={key:0},G={key:0,class:"space-y-3"},J={class:"flex justify-between items-start gap-4"},K={class:"flex flex-col overflow-hidden"},O=["href","title"],P={class:"text-[11px] text-gray-400 mt-1"},Q={key:0,class:"ml-1 text-gray-400/70"},W={class:"flex items-center gap-2 shrink-0"},X=["onClick"],Y=["onClick"],Z=["onClick"],ee={key:0,class:"max-w-4xl mx-auto py-8 px-4 mt-3 text-sm text-red-700 dark:text-red-300 bg-red-100 dark:bg-red-900/40 p-3 rounded-md border border-red-200 dark:border-red-800"},te={class:"whitespace-pre-wrap break-words text-sm"},se=["onClick"],re={key:1,class:"mt-3 animate-slideDown"},oe={class:"flex justify-end gap-2 mt-2"},ae=["onClick"],ne={key:1,class:"text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg"},le={__name:"SubtaskFiles",props:["subtask","user"],emits:["refresh"],setup(y,{emit:C}){const m=y,b=C,$=c(null),f=c(null),d=c(""),u=c(null),k=c(null),p=c(new Set),g=_(()=>{const{subtask:s,user:e}=m;return!s||!e?!1:s.creator_id===e.id||(s.executors||[]).some(o=>o.id===e.id)||(s.responsibles||[]).some(o=>o.id===e.id)}),F=_(()=>{const{subtask:s,user:e}=m;return!s||!e||!s.responsibles?!1:s.responsibles.some(o=>o.id===e.id)}),I=async s=>{var t,l;const e=s.target.files[0];if(!e)return;const o=new FormData;o.append("file",e);try{await x.post(`/api/subtasks/${m.subtask.id}/files`,o,{headers:{"Content-Type":"multipart/form-data"}}),b("refresh")}catch(h){alert(((l=(t=h.response)==null?void 0:t.data)==null?void 0:l.message)||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏")}finally{s.target.value=""}},j=async s=>{if(confirm("–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª?"))try{await x.delete(`/api/subtask-files/${s}`),b("refresh")}catch{alert("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è")}},D=s=>{k.value=s,f.value.click()},R=async s=>{var t,l;const e=s.target.files[0];if(!e||!k.value)return;const o=new FormData;o.append("file",e);try{await x.post(`/api/subtask-files/${k.value}/replace`,o,{headers:{"Content-Type":"multipart/form-data"}}),b("refresh")}catch(h){alert(((l=(t=h.response)==null?void 0:t.data)==null?void 0:l.message)||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞")}finally{s.target.value="",k.value=null}},S=s=>{if(u.value===s)u.value=null;else{u.value=s;const e=m.subtask.files.find(o=>o.id===s);d.value=e.revision_comment||""}},B=async s=>{var e,o;if(!d.value.trim()){alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –¥–æ—Ä–∞–±–æ—Ç–∫–∏");return}try{await x.post(`/api/subtask-files/${s}/revision`,{comment:d.value}),u.value=null,d.value="",b("refresh")}catch(t){alert(((o=(e=t.response)==null?void 0:e.data)==null?void 0:o.message)||"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏")}},M=s=>{p.value.has(s)?p.value.delete(s):p.value.add(s)};return(s,e)=>{var o;return a(),n("div",A,[r("div",E,[e[4]||(e[4]=r("h3",{class:"font-semibold text-lg text-gray-800 dark:text-gray-100"},"üìé –§–∞–π–ª—ã",-1)),r("input",{type:"file",ref_key:"replaceInput",ref:f,class:"hidden",onChange:R},null,544),g.value?(a(),n("div",q,[r("input",{type:"file",onChange:I,class:"hidden",ref_key:"fileInput",ref:$},null,544),r("button",{onClick:e[0]||(e[0]=t=>s.$refs.fileInput.click()),class:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition shadow"}," + –ó–∞–≥—Ä—É–∑–∏—Ç—å ")])):i("",!0)]),(o=y.subtask.files)!=null&&o.length?(a(),n("ul",G,[(a(!0),n(T,null,V(y.subtask.files,t=>(a(),n("li",{key:t.id,class:w(["relative bg-gray-50 dark:bg-gray-700 p-3 rounded-lg border transition-all",t.status==="revision"?"border-red-300 bg-red-50 dark:bg-red-900/10 dark:border-red-800":"border-gray-200 dark:border-gray-600"])},[r("div",J,[r("div",K,[r("a",{href:`/api/subtask-files/${t.id}/download`,class:"text-blue-600 dark:text-blue-400 hover:underline text-sm font-medium truncate",title:t.filename}," üìÑ "+v(t.filename),9,O),r("span",P,[H(v(new Date(t.updated_at).toLocaleString())+" ",1),t.created_at!==t.updated_at?(a(),n("span",Q,e[5]||(e[5]=[r("strong",{style:{color:"green"}},"(–æ–±–Ω–æ–≤–ª–µ–Ω)",-1)]))):i("",!0)])]),r("div",W,[g.value?(a(),n("button",{key:0,onClick:l=>D(t.id),class:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900 rounded transition",title:"–û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª (–ó–∞–º–µ–Ω–∏—Ç—å)"},e[6]||(e[6]=[r("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]),8,X)):i("",!0),F.value?(a(),n("button",{key:1,onClick:l=>S(t.id),class:w(["text-xs px-2 py-1.5 rounded font-medium transition",t.status==="revision"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-200 hover:bg-red-200":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-200 hover:bg-yellow-200"])},v(t.status==="revision"?"–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–º–µ—á–∞–Ω–∏–µ":"–ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É"),11,Y)):i("",!0),g.value?(a(),n("button",{key:2,onClick:l=>j(t.id),class:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-900 rounded transition",title:"–£–¥–∞–ª–∏—Ç—å"},e[7]||(e[7]=[r("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Z)):i("",!0)])]),t.status==="revision"?(a(),n("div",ee,[e[8]||(e[8]=r("div",{class:"font-bold text-xs uppercase tracking-wide mb-1 opacity-80"},"‚ö† –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞",-1)),r("div",te,v(p.value.has(t.id)||!t.revision_comment||t.revision_comment.length<=150?t.revision_comment:t.revision_comment.slice(0,150)+"..."),1),t.revision_comment&&t.revision_comment.length>150?(a(),n("button",{key:0,onClick:L(l=>M(t.id),["prevent"]),class:"mt-2 text-xs font-bold text-red-800 dark:text-red-200 hover:underline focus:outline-none flex items-center gap-1"},v(p.value.has(t.id)?"–°–≤–µ—Ä–Ω—É—Ç—å":"–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é ‚Üì"),9,se)):i("",!0)])):i("",!0),u.value===t.id?(a(),n("div",re,[N(r("textarea",{"onUpdate:modelValue":e[1]||(e[1]=l=>d.value=l),class:"w-full text-sm p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-yellow-400 outline-none dark:bg-gray-800 dark:text-white dark:border-gray-600",placeholder:"–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ...",rows:"3"},null,512),[[U,d.value]]),r("div",oe,[r("button",{onClick:e[2]||(e[2]=l=>u.value=null),class:"px-3 py-1 text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}," –û—Ç–º–µ–Ω–∞ "),r("button",{onClick:l=>B(t.id),class:"px-4 py-1.5 bg-yellow-500 hover:bg-yellow-600 text-white text-xs font-bold rounded shadow transition"}," –û—Ç–ø—Ä–∞–≤–∏—Ç—å ",8,ae)])])):i("",!0)],2))),128))])):(a(),n("div",ne,[e[9]||(e[9]=r("p",{class:"text-sm text-gray-500 mb-2"},"–§–∞–π–ª–æ–≤ –Ω–µ—Ç",-1)),g.value?(a(),n("button",{key:0,onClick:e[3]||(e[3]=t=>s.$refs.fileInput.click()),class:"text-blue-600 hover:underline text-sm"}," –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ñ–∞–π–ª ")):i("",!0)]))])}}},ue=z(le,[["__scopeId","data-v-bb45020c"]]);export{ue as default};
