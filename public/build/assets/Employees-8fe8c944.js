import{l as v,Q as K,m as r,k as B,p as R,o as s,f as o,a as N,u as W,w as D,F as g,Z as X,b as e,h as u,v as y,q as b,s as c,t as n,n as Y,g as x,e as ee}from"./app-958e970b.js";import{_ as te}from"./AuthenticatedLayout-3a94a8dd.js";import"./ApplicationLogo-45bf9c30.js";import"./_plugin-vue_export-helper-c27b6911.js";const le={class:"flex items-center justify-between"},ae={class:"max-w-6xl mx-auto py-8 px-4"},se={class:"grid gap-3 md:grid-cols-3 mb-4"},oe=["value"],re={class:"overflow-hidden rounded-2xl border dark:border-gray-700 bg-white dark:bg-gray-900"},de={class:"w-full text-sm"},ne={key:0},ie={key:1},ue={class:"px-4 py-3 font-medium text-gray-900 dark:text-gray-100"},pe={class:"px-4 py-3 text-gray-600 dark:text-gray-300"},me={class:"px-4 py-3 text-gray-600 dark:text-gray-300"},ve={class:"px-4 py-3"},ge={key:0},xe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50"},ye={class:"w-full max-w-xl rounded-2xl bg-white p-6 shadow-xl dark:bg-gray-900"},be={class:"flex items-center justify-between"},ce={key:0,class:"mt-1 text-xs text-rose-600"},fe={key:0,class:"mt-1 text-xs text-rose-600"},ke={class:"grid md:grid-cols-2 gap-3"},we={key:0,class:"mt-1 text-xs text-rose-600"},_e={class:"grid md:grid-cols-2 gap-3"},he=["value"],Ce={key:0,class:"mt-1 text-xs text-rose-600"},Ue={class:"flex justify-end gap-2 pt-2"},Ve=["disabled"],je={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4"},Se={class:"relative w-full max-w-3xl rounded-2xl shadow-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700"},Le={class:"flex items-center justify-between border-b border-slate-200 dark:border-slate-700 px-6 py-4"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-4 px-6 py-4"},Ee=["value"],Fe={class:"px-6 pb-4"},Me={class:"mb-3 max-h-64 overflow-auto border border-slate-200 dark:border-slate-700 rounded-xl divide-y divide-slate-100 dark:divide-slate-700"},qe={key:0,class:"p-4 text-sm text-slate-500"},Ae={class:"font-medium text-slate-800 dark:text-slate-100"},ze={class:"text-xs text-slate-500"},Be={class:"flex items-center gap-2"},Ne=["onClick"],De={class:"flex justify-end gap-2 px-6 py-4 border-t border-slate-200 dark:border-slate-700"},Pe=["disabled"],He={__name:"Employees",setup(Oe){v.defaults.withCredentials=!0,K();const S=r(!1),_=r(!1),F=r([]),L=r([]),h=r(""),C=r("all"),U=r("all"),f=r(!1),i=r({name:"",email:"",password:"",password_confirmation:"",role:"employee",company_id:""}),p=r({}),M=B(()=>{let a=[...F.value];if(h.value.trim()){const t=h.value.toLowerCase();a=a.filter(l=>{var m,w;return((m=l.name)==null?void 0:m.toLowerCase().includes(t))||((w=l.email)==null?void 0:w.toLowerCase().includes(t))})}return C.value!=="all"&&(a=a.filter(t=>{var l,m;return(((m=(l=t.roles)==null?void 0:l[0])==null?void 0:m.name)??"employee")===C.value})),U.value!=="all"&&(a=a.filter(t=>{var l;return String((l=t.company)==null?void 0:l.id)===String(U.value)})),a}),P=a=>a==="manager"?"bg-indigo-100 text-indigo-700 ring-1 ring-indigo-200":"bg-emerald-100 text-emerald-700 ring-1 ring-emerald-200",O=async()=>{const{data:a}=await v.get("/api/companies");L.value=a},q=async()=>{S.value=!0;try{const{data:a}=await v.get("/api/employees");F.value=a}finally{S.value=!1}},Q=()=>{i.value={name:"",email:"",password:"",password_confirmation:"",role:"employee",company_id:""},p.value={}},T=async()=>{var a;p.value={},_.value=!0;try{await v.get("/sanctum/csrf-cookie"),await v.post("/api/employees",i.value),f.value=!1,Q(),await q()}catch(t){((a=t.response)==null?void 0:a.status)===422?p.value=t.response.data.errors??{}:alert("Не удалось создать сотрудника")}finally{_.value=!1}},k=r(!1),$=r([]),A=r([]),d=r({user_id:"",role:"employee",company_id:""}),E=r(!1),V=r(!1),j=r(""),Z=async()=>{E.value=!0;try{const{data:a}=await v.get("/api/users/for-attach");$.value=a}finally{E.value=!1}},G=async()=>{const{data:a}=await v.get("/api/companies");A.value=a,a.length&&!d.value.company_id&&(d.value.company_id=String(a[0].id))},H=async()=>{k.value=!0,await Promise.all([Z(),G()])},I=B(()=>{if(!j.value)return $.value;const a=j.value.toLowerCase();return $.value.filter(t=>(t.name||"").toLowerCase().includes(a)||(t.email||"").toLowerCase().includes(a))}),J=async()=>{var a,t;if(!(!d.value.user_id||!d.value.company_id||!d.value.role)){V.value=!0;try{const{data:l}=await v.post("/api/employees/attach",{user_id:d.value.user_id,company_id:d.value.company_id,role:d.value.role});k.value=!1,d.value={user_id:"",role:"employee",company_id:d.value.company_id},alert("Пользователь добавлен")}catch(l){console.error(l),alert(((t=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:t.message)||"Ошибка")}finally{V.value=!1}}};return R(async()=>{await Promise.all([O(),q()])}),(a,t)=>(s(),o(g,null,[N(W(X),{title:"Сотрудники"}),N(te,null,{header:D(()=>[e("div",le,[t[17]||(t[17]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Сотрудники",-1)),e("button",{class:"rounded-xl bg-indigo-600 text-white px-4 py-2 hover:bg-indigo-700",onClick:t[0]||(t[0]=l=>f.value=!0)}," + Сотрудник "),e("button",{class:"ms-3 rounded-xl bg-green-600 text-white px-4 py-2 hover:bg-green-700",onClick:H}," Сотрудники 2 ")])]),default:D(()=>[e("div",ae,[e("div",se,[e("div",null,[u(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>h.value=l),placeholder:"Поиск по имени или email…",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[y,h.value]])]),e("div",null,[u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>C.value=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},t[18]||(t[18]=[e("option",{value:"all"},"Все роли",-1),e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[b,C.value]])]),e("div",null,[u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>U.value=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},[t[19]||(t[19]=e("option",{value:"all"},"Все компании",-1)),(s(!0),o(g,null,c(L.value,l=>(s(),o("option",{key:l.id,value:String(l.id)},n(l.name),9,oe))),128))],512),[[b,U.value]])])]),e("div",re,[e("table",de,[t[22]||(t[22]=e("thead",{class:"bg-gray-50 dark:bg-gray-800"},[e("tr",null,[e("th",{class:"text-left px-4 py-3"},"Имя"),e("th",{class:"text-left px-4 py-3"},"Email"),e("th",{class:"text-left px-4 py-3"},"Компания"),e("th",{class:"text-left px-4 py-3"},"Роль")])],-1)),S.value?(s(),o("tbody",ne,[(s(),o(g,null,c(5,l=>e("tr",{key:l,class:"animate-pulse"},t[20]||(t[20]=[e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-56 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-5 w-20 bg-gray-200 dark:bg-gray-700 rounded-full"})],-1)]))),64))])):(s(),o("tbody",ie,[(s(!0),o(g,null,c(M.value,l=>{var m,w,z;return s(),o("tr",{key:l.id,class:"border-t dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/60"},[e("td",ue,n(l.name),1),e("td",pe,n(l.email),1),e("td",me,n(((m=l.company)==null?void 0:m.name)??"—"),1),e("td",ve,[e("span",{class:Y(["inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ring-1",P(((z=(w=l.roles)==null?void 0:w[0])==null?void 0:z.name)??"employee")])},n(l.role==="manager"?"Менеджер":"Сотрудник"),3)])])}),128)),M.value.length?x("",!0):(s(),o("tr",ge,t[21]||(t[21]=[e("td",{colspan:"4",class:"px-4 py-6 text-center text-gray-500 dark:text-gray-400"}," Ничего не найдено ",-1)])))]))])])]),f.value?(s(),o("div",xe,[e("div",ye,[e("div",be,[t[23]||(t[23]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Новый сотрудник",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:t[4]||(t[4]=l=>f.value=!1)},"✕")]),e("form",{class:"mt-4 space-y-4",onSubmit:ee(T,["prevent"])},[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm mb-1"},"Имя",-1)),u(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>i.value.name=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[y,i.value.name]]),p.value.name?(s(),o("p",ce,n(p.value.name[0]),1)):x("",!0)]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm mb-1"},"Email",-1)),u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>i.value.email=l),type:"email",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[y,i.value.email]]),p.value.email?(s(),o("p",fe,n(p.value.email[0]),1)):x("",!0)]),e("div",ke,[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm mb-1"},"Пароль",-1)),u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>i.value.password=l),type:"password",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[y,i.value.password]]),p.value.password?(s(),o("p",we,n(p.value.password[0]),1)):x("",!0)]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm mb-1"},"Подтверждение",-1)),u(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>i.value.password_confirmation=l),type:"password",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[y,i.value.password_confirmation]])])]),e("div",_e,[e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm mb-1"},"Компания",-1)),u(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>i.value.company_id=l),required:"",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},[t[28]||(t[28]=e("option",{disabled:"",value:""},"Выберите компанию",-1)),(s(!0),o(g,null,c(L.value,l=>(s(),o("option",{key:l.id,value:l.id},n(l.name),9,he))),128))],512),[[b,i.value.company_id]]),p.value.company_id?(s(),o("p",Ce,n(p.value.company_id[0]),1)):x("",!0)]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm mb-1"},"Роль",-1)),u(e("select",{"onUpdate:modelValue":t[10]||(t[10]=l=>i.value.role=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},t[30]||(t[30]=[e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[b,i.value.role]])])]),e("div",Ue,[e("button",{type:"button",class:"rounded-lg bg-gray-500 px-4 py-2 text-white",onClick:t[11]||(t[11]=l=>f.value=!1)},"Отмена"),e("button",{type:"submit",class:"rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-50",disabled:_.value},n(_.value?"Создаю…":"Создать"),9,Ve)])],32)])])):x("",!0),k.value?(s(),o("div",je,[e("div",Se,[e("div",Le,[t[32]||(t[32]=e("h3",{class:"text-lg font-semibold text-slate-800 dark:text-slate-100"}," Добавить зарегистрированного пользователя ",-1)),e("button",{onClick:t[12]||(t[12]=l=>k.value=!1),class:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300"}," ✕ ")]),e("div",$e,[e("div",null,[t[33]||(t[33]=e("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1"},"Поиск",-1)),u(e("input",{"onUpdate:modelValue":t[13]||(t[13]=l=>j.value=l),class:"w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"Имя или email"},null,512),[[y,j.value]])]),e("div",null,[t[34]||(t[34]=e("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1"},"Компания",-1)),u(e("select",{"onUpdate:modelValue":t[14]||(t[14]=l=>d.value.company_id=l),class:"w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none"},[(s(!0),o(g,null,c(A.value,l=>(s(),o("option",{key:l.id,value:String(l.id)},n(l.name),9,Ee))),128))],512),[[b,d.value.company_id]])])]),e("div",Fe,[e("div",Me,[E.value?(s(),o("div",qe,"Загрузка пользователей...")):(s(!0),o(g,{key:1},c(I.value,l=>(s(),o("div",{key:l.id,class:"flex items-center justify-between gap-3 p-3 hover:bg-slate-50 dark:hover:bg-slate-800/40 transition rounded"},[e("div",null,[e("div",Ae,n(l.name),1),e("div",ze,n(l.email),1)]),e("div",Be,[t[36]||(t[36]=e("label",{class:"text-xs text-slate-500"},"Роль",-1)),u(e("select",{"onUpdate:modelValue":t[15]||(t[15]=m=>d.value.role=m),class:"rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm px-2 py-1"},t[35]||(t[35]=[e("option",{value:"employee"},"Сотрудник",-1),e("option",{value:"manager"},"Менеджер",-1)]),512),[[b,d.value.role]]),e("button",{onClick:m=>d.value.user_id=l.id,class:"px-3 py-1.5 rounded-lg bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700 transition"}," Выбрать ",8,Ne)])]))),128))])]),e("div",De,[e("button",{onClick:t[16]||(t[16]=l=>k.value=!1),class:"px-4 py-2 rounded-xl bg-slate-200 text-slate-700 dark:bg-slate-700 dark:text-slate-200 hover:opacity-80 transition"}," Отмена "),e("button",{onClick:J,disabled:V.value,class:"px-4 py-2 rounded-xl bg-emerald-600 text-white font-medium hover:bg-emerald-700 disabled:opacity-60 transition"},n(V.value?"Добавление...":"Добавить"),9,Pe)])])])):x("",!0)]),_:1})],64))}};export{He as default};
