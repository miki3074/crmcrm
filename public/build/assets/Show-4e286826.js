import{Q as E,r as g,m as $,q as Q,o as l,f as r,a as N,u as z,w as R,F as b,i as k,Z as W,b as t,g as x,t as d,d as _,x as C,n as Z,e as G,j as M,v as j,k as J}from"./app-aea83e3b.js";import{_ as K}from"./AuthenticatedLayout-916f63d2.js";import"./ApplicationLogo-9287d5fa.js";import"./_plugin-vue_export-helper-c27b6911.js";const X={class:"relative overflow-hidden"},Y={class:"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 text-white"},tt={class:"flex items-center gap-4"},et=["src"],st={class:"text-2xl sm:text-3xl font-semibold"},at={class:"text-white/80 text-sm mt-1"},lt={key:0,class:"ml-2 px-2 py-0.5 text-xs rounded-full bg-white/20"},rt={key:1,class:"ml-2 px-2 py-0.5 text-xs rounded-full bg-white/20"},it={key:1,class:"ml-auto"},ot={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-6"},nt={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},dt={key:1,class:"rounded-2xl border bg-white dark:bg-gray-800 p-10 text-center"},ut={key:0,class:"mt-6"},gt={key:2,class:"mt-6"},xt={class:"flex items-center justify-between mb-3"},ct={class:"text-sm text-gray-500 dark:text-gray-400"},vt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},mt=["onClick"],yt={class:"flex items-start justify-between gap-3"},pt={class:"text-base font-semibold text-gray-900 dark:text-white leading-snug"},bt={class:"mt-3 space-y-1.5 text-sm text-gray-600 dark:text-gray-300"},ht={class:"flex items-start gap-2"},ft={class:"flex flex-wrap gap-2"},wt={class:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 text-xs font-medium"},kt={class:"text-gray-800 dark:text-white text-sm"},_t={class:"flex items-center gap-2"},Ct={class:"text-gray-800 dark:text-white"},Mt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Vt={class:"relative w-full max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6"},$t={class:"flex items-center justify-between"},zt={key:0,class:"mt-3 text-sm text-rose-600"},jt={class:"space-y-2 max-h-40 overflow-y-auto p-2 border rounded-xl bg-white dark:bg-gray-700"},Dt=["id","value"],Bt=["for"],St={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},It={class:"flex justify-end gap-2 pt-2"},Ut=["disabled"],Ht={key:0},Lt={key:1},Tt={__name:"Show",setup(Nt){const{props:c}=E(),h=c.id,V=g(!0),o=g(null),f=g([]),v=g(!1),w=g(!1),y=g(""),n=g({name:"",manager_ids:[],start_date:new Date().toISOString().slice(0,10),duration_days:"",company_id:c.auth.user.company_id}),D=$(()=>{var a,e,i;return((a=o.value)==null?void 0:a.user_id)===((i=(e=c.auth)==null?void 0:e.user)==null?void 0:i.id)}),B=$(()=>D.value),q=new Date,S=(a,e)=>{if(!a||!e)return"—";const i=new Date(a),u=new Date(i);return u.setDate(i.getDate()+Number(e)),Math.ceil((u-q)/(1e3*60*60*24))},F=a=>a>7?"bg-emerald-100 text-emerald-700 ring-1 ring-emerald-200":a>=0?"bg-amber-100 text-amber-700 ring-1 ring-amber-200":"bg-rose-100 text-rose-700 ring-1 ring-rose-200",O=a=>(a||"").split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase(),I=async()=>{V.value=!0;try{const{data:a}=await k.get(`/api/companies/${h}`);o.value=a}finally{V.value=!1}},P=async()=>{const{data:a}=await k.get(`/api/users/managers?company_id=${h}`);f.value=a},U=async()=>{y.value="",await P(),v.value=!0},T=async()=>{var a,e;y.value="",w.value=!0;try{await k.get("/sanctum/csrf-cookie"),await k.post("/api/projects",{...n.value,company_id:h}),v.value=!1,n.value={name:"",manager_id:"",start_date:new Date().toISOString().slice(0,10),duration_days:""},await I()}catch(i){y.value=((e=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:e.message)||"Не удалось создать проект"}finally{w.value=!1}},A=$(()=>{var i;if(!f.value.length||!((i=c.auth)!=null&&i.user))return f.value;const a=c.auth.user.id;return[...f.value].sort((u,p)=>u.id===a?-1:p.id===a?1:0)});return Q(I),(a,e)=>{var i;return l(),r(b,null,[N(z(W),{title:(i=o.value)!=null&&i.name?`Компания — ${o.value.name}`:"Компания"},null,8,["title"]),N(K,null,{default:R(()=>{var u,p,H,L;return[t("div",X,[e[8]||(e[8]=t("div",{class:"absolute inset-0 bg-gradient-to-r from-indigo-600 via-purple-600 to-fuchsia-600 opacity-90"},null,-1)),t("div",Y,[t("div",tt,[(u=o.value)!=null&&u.logo?(l(),r("img",{key:0,src:`/storage/${o.value.logo}`,alt:"Logo",class:"w-16 h-16 rounded-xl object-cover ring-2 ring-white/30"},null,8,et)):x("",!0),t("div",null,[t("h1",st,d(((p=o.value)==null?void 0:p.name)??"Компания"),1),t("p",at,[_(" ID: "+d(z(h))+" ",1),D.value?(l(),r("span",lt,"Владелец")):a.isAdmin?(l(),r("span",rt,"Администратор")):x("",!0)])]),B.value?(l(),r("div",it,[t("button",{onClick:U,class:"inline-flex items-center gap-2 rounded-xl bg-white text-gray-900 px-4 py-2.5 shadow/50 hover:shadow transition"},e[7]||(e[7]=[t("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2h5z"})],-1),_(" Создать проект ",-1)]))])):x("",!0)])])]),t("div",ot,[V.value?(l(),r("div",nt,[(l(),r(b,null,C(6,s=>t("div",{key:s,class:"rounded-2xl border bg-white dark:bg-gray-800 p-4 animate-pulse"},e[9]||(e[9]=[t("div",{class:"h-5 w-1/2 bg-gray-200 dark:bg-gray-700 rounded mb-4"},null,-1),t("div",{class:"space-y-2"},[t("div",{class:"h-3 w-3/4 bg-gray-200 dark:bg-gray-700 rounded"}),t("div",{class:"h-3 w-2/3 bg-gray-200 dark:bg-gray-700 rounded"}),t("div",{class:"h-3 w-1/2 bg-gray-200 dark:bg-gray-700 rounded"})],-1)]))),64))])):(L=(H=o.value)==null?void 0:H.projects)!=null&&L.length?(l(),r("div",gt,[t("div",xt,[e[13]||(e[13]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Проекты компании",-1)),t("div",ct," Всего: "+d(o.value.projects.length),1)]),t("div",vt,[(l(!0),r(b,null,C(o.value.projects,s=>(l(),r("div",{key:s.id,class:"group rounded-2xl border bg-white dark:bg-gray-800 p-5 hover:shadow-lg transition cursor-pointer",onClick:m=>a.$inertia.visit(`/projects/${s.id}`)},[t("div",yt,[t("h3",pt,d(s.name),1),s.duration_days?(l(),r("span",{key:0,class:Z([["px-2 py-1 text-xs rounded-full ring-1",F(S(s.start_date,s.duration_days))],"shrink-0"])},d(S(s.start_date,s.duration_days))+" дн. ",3)):x("",!0)]),t("div",bt,[t("div",ht,[e[14]||(e[14]=t("span",{class:"truncate"},"Руководители:",-1)),t("div",ft,[(l(!0),r(b,null,C(s.managers,m=>(l(),r("div",{key:m.id,class:"flex items-center gap-1"},[t("span",wt,d(O(m.name)),1),t("span",kt,d(m.name),1)]))),128))])]),t("div",_t,[e[16]||(e[16]=t("svg",{class:"w-4 h-4 text-gray-400",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M7 11h5V6H7v5zm0 7h5v-5H7v5zm7 0h5v-5h-5v5zM14 6v5h5V6h-5z"})],-1)),t("span",null,[e[15]||(e[15]=_("Старт: ",-1)),t("b",Ct,d(s.start_date),1)])])]),e[17]||(e[17]=t("div",{class:"mt-4 flex items-center justify-end"},[t("span",{class:"text-indigo-600 group-hover:translate-x-0.5 transition inline-flex items-center gap-1 text-sm"},[_(" Открыть "),t("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M13 5l7 7-7 7v-4H4v-6h9V5z"})])])],-1))],8,mt))),128))])])):(l(),r("div",dt,[e[10]||(e[10]=t("div",{class:"mx-auto w-16 h-16 rounded-2xl bg-indigo-100 text-indigo-600 flex items-center justify-center"},[t("svg",{class:"w-7 h-7",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 3l4 4H8l4-4zm0 18l-4-4h8l-4 4zM3 12l4-4v8l-4-4zm18 0l-4 4V8l4 4z"})])],-1)),e[11]||(e[11]=t("h3",{class:"mt-4 text-lg font-semibold text-gray-900 dark:text-white"},"Проектов пока нет",-1)),e[12]||(e[12]=t("p",{class:"text-gray-600 dark:text-gray-300 mt-1"},"Создайте первый проект для этой компании.",-1)),B.value?(l(),r("div",ut,[t("button",{onClick:U,class:"rounded-xl bg-indigo-600 text-white px-5 py-2.5 hover:bg-indigo-700 transition"}," Новый проект ")])):x("",!0)]))]),v.value?(l(),r("div",Mt,[t("div",{class:"absolute inset-0 bg-black/50",onClick:e[0]||(e[0]=s=>v.value=!1)}),t("div",Vt,[t("div",$t,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Создать проект",-1)),t("button",{onClick:e[1]||(e[1]=s=>v.value=!1),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"}," ✕ ")]),y.value?(l(),r("p",zt,d(y.value),1)):x("",!0),t("form",{class:"mt-4 space-y-4",onSubmit:G(T,["prevent"])},[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Название проекта",-1)),M(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.name=s),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:"",placeholder:"Например, CRM v2"},null,512),[[j,n.value.name]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm mb-2 text-gray-700 dark:text-gray-300"},"Руководители",-1)),t("div",jt,[(l(!0),r(b,null,C(A.value,s=>(l(),r("div",{key:s.id,class:"flex items-center space-x-2"},[M(t("input",{type:"checkbox",id:`manager-${s.id}`,value:s.id,"onUpdate:modelValue":e[3]||(e[3]=m=>n.value.manager_ids=m),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,8,Dt),[[J,n.value.manager_ids]]),t("label",{for:`manager-${s.id}`,class:"text-sm text-gray-700 dark:text-gray-300"},d(s.id===z(c).auth.user.id?"Я":s.name),9,Bt)]))),128))])]),t("div",St,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Дата начала",-1)),M(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=s=>n.value.start_date=s),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:""},null,512),[[j,n.value.start_date]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Длительность (дней)",-1)),M(t("input",{type:"number",min:"1","onUpdate:modelValue":e[5]||(e[5]=s=>n.value.duration_days=s),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:"",placeholder:"Напр., 30"},null,512),[[j,n.value.duration_days]])])]),t("div",It,[t("button",{type:"button",onClick:e[6]||(e[6]=s=>v.value=!1),class:"px-4 py-2 rounded-xl border bg-white dark:bg-gray-700 dark:text-white"}," Отмена "),t("button",{type:"submit",disabled:w.value,class:"px-4 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60"},[w.value?(l(),r("span",Lt,"Сохраняю…")):(l(),r("span",Ht,"Создать"))],8,Ut)])],32)])])):x("",!0)]}),_:1})],64)}}};export{Tt as default};
