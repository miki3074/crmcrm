import{V as G,r as f,j as J,x as K,o as w,c as $,k as d,u as P,H as L,F as X,f as r,Z as Y,a as v}from"./app-34d1bdb8.js";import{_ as ee}from"./AuthenticatedLayout-ac28c3bb.js";import ae from"./TaskHero-24b226aa.js";import se from"./TaskStats-83c269b4.js";import te from"./TaskSubtasks-ef9c6eac.js";import oe from"./TaskSidebar-78a15c62.js";import{_ as ne}from"./TaskChat-705a6a76.js";import re from"./TaskActionModals-d180f583.js";import le from"./TaskPersonnelModals-1079832c.js";import ie from"./TaskDocumentApproval-1b69a1e7.js";import"./ApplicationLogo-3143801a.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./TaskChecklists-6fd584a1.js";const de={key:0},ue={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-10 -mt-4"},ce={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},pe={class:"lg:col-span-2 space-y-6"},me={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700"},ve={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700"},ke={class:"lg:col-span-1"},fe={key:1,class:"text-center py-20 text-gray-500"},Se={__name:"Show",setup(ge){var x;const{props:y}=G(),l=y.id,m=(x=y.auth)==null?void 0:x.user,s=f(null),g=f([]),k=f(!0),o=f({edit:!1,description:!1,delete:!1,subtask:!1,executor:!1,responsible:!1,addExecutor:!1,addResponsible:!1,addWatcher:!1,manage:!1}),b=J(()=>{var _,h,C,j,D,E,F,R,S,M;if(!s.value)return{};const a=m.id===((h=(_=s.value.project)==null?void 0:_.company)==null?void 0:h.user_id),e=m.id===((C=s.value.creator)==null?void 0:C.id),n=(j=s.value.executors)==null?void 0:j.some(c=>c.id===m.id),t=(D=s.value.responsibles)==null?void 0:D.some(c=>c.id===m.id),p=(F=(E=s.value.project)==null?void 0:E.executors)==null?void 0:F.some(c=>c.id===m.id),u=(S=(R=s.value.project)==null?void 0:R.managers)==null?void 0:S.some(c=>c.id===m.id),q=e||n||t,z=a||u||p;return{canCreateSubtask:a||e||t||n||u||p,canUpdate:a||u||p,canDelete:a||u||p,canUpload:n||t||p||a,canFinish:s.value.progress===100&&!s.value.completed&&!((M=s.value.subtasks)!=null&&M.some(c=>!c.completed)),canManageMembers:z,canManageTask:q}}),i=async()=>{k.value=!0;try{const{data:a}=await r.get(`/api/tasks/${l}`);s.value=a;const e=await r.get(`/api/projects/${a.project.id}/employees`);g.value=e.data}catch(a){console.error(a)}finally{k.value=!1}},T=async a=>{await r.put(`/api/tasks/${l}`,a),o.value.edit=!1,await i()},U=async a=>{await r.patch(`/api/tasks/${l}/description`,{description:a}),o.value.description=!1,await i()},A=async a=>{await r.patch(`/api/tasks/${l}/progress`,{progress:a}),s.value.progress=a},W=async()=>{await r.delete(`/api/tasks/${l}`),window.history.back()},B=async()=>{await r.patch(`/api/tasks/${l}/complete`),await i()},V=async a=>{const e=new FormData;for(let n=0;n<a.length;n++)e.append("files[]",a[n]);await r.post(`/api/tasks/${l}/files`,e),await i()},H=async a=>{confirm("햒햢햟햩햦혝혧?")&&(await r.delete(`/api/tasks/files/${a}`),await i())},I=async a=>{await r.post(`/api/tasks/${l}/subtasks`,a),o.value.subtask=!1,await i()},N=async({type:a,oldId:e,newId:n})=>{const t=a==="executor"?"executor":"responsible";await r.patch(`/api/tasks/${l}/${t}`,{replace_user_id:e,user_id:n}),o.value[a]=!1,await i()},O=async({type:a,ids:e,singleId:n})=>{if(a==="watcher")await r.post(`/api/tasks/${l}/watchers`,{user_id:n}),o.value.addWatcher=!1;else{const t=a==="executor"?"executors":"responsibles";await r.post(`/api/tasks/${l}/${t}/add`,{user_ids:e}),o.value["add"+a.charAt(0).toUpperCase()+a.slice(1)]=!1}await i()},Q=async({role:a,id:e})=>{const n=a==="watcherstask"?"watchers":a;await r.delete(`/api/tasks/${l}/${n}`,{data:{user_id:e}}),await i()},Z=async a=>{var n,t,p;const e=a||((n=s.value)==null?void 0:n.id)||l;if(!e){console.error("ID 향햟햢햟혢햦 햫햣 햫햟햧햢햣햫");return}try{const{data:u}=await r.post(`/api/tasks/${e}/start`);s.value=u.task}catch(u){console.error(u),alert(((p=(t=u.response)==null?void 0:t.data)==null?void 0:p.message)||"뤰걣쟳쐃쥃")}};return K(i),(a,e)=>{var n;return w(),$(X,null,[d(P(Y),{title:((n=s.value)==null?void 0:n.title)||"행햟햢햟혢햟"},null,8,["title"]),d(ee,null,{default:L(()=>[!k.value&&s.value?(w(),$("div",de,[d(ae,{task:s.value,perms:b.value,onStartWork:Z,onEdit:e[0]||(e[0]=t=>o.value.edit=!0),onDelete:e[1]||(e[1]=t=>o.value.delete=!0),onDescription:e[2]||(e[2]=t=>o.value.description=!0),onBack:e[3]||(e[3]=()=>a.$inertia.visit(`/projects/${s.value.project_id}`)),onFinish:B,onChangeExecutor:e[4]||(e[4]=t=>o.value.executor=!0),onChangeResponsible:e[5]||(e[5]=t=>o.value.responsible=!0),onAddExecutor:e[6]||(e[6]=t=>o.value.addExecutor=!0),onAddResponsible:e[7]||(e[7]=t=>o.value.addResponsible=!0),onAddWatcher:e[8]||(e[8]=t=>o.value.addWatcher=!0),onManageMembers:e[9]||(e[9]=t=>o.value.manage=!0)},null,8,["task","perms"]),v("div",ue,[v("div",ce,[v("div",pe,[d(se,{task:s.value,loading:k.value,"can-upload":b.value.canUpload,onUpdateProgress:A,onUploadFiles:V,onDeleteFile:H},null,8,["task","loading","can-upload"]),v("div",me,[d(ie,{task:s.value,"current-user":P(m),onRefresh:i},null,8,["task","current-user"])]),d(te,{subtasks:s.value.subtasks,"can-create":b.value.canCreateSubtask,onCreate:e[10]||(e[10]=t=>o.value.subtask=!0)},null,8,["subtasks","can-create"]),v("div",ve,[e[13]||(e[13]=v("h3",{class:"font-bold mb-4 dark:text-white"},"游눫 햖햟혝",-1)),d(ne,{"task-id":s.value.id,"can-chat":!0,members:[...s.value.executors||[],...s.value.responsibles||[],s.value.creator]},null,8,["task-id","members"])])]),v("div",ke,[d(oe,{task:s.value},null,8,["task"])])])])])):(w(),$("div",fe,"행햟햡혞향햨햟 향햟햢햟혢햦...")),d(re,{modals:o.value,task:s.value,employees:g.value,onClose:e[11]||(e[11]=t=>o.value[t]=!1),onUpdate:T,onSaveDescription:U,onDeleteTask:W,onCreateSubtask:I},null,8,["modals","task","employees"]),d(le,{modals:o.value,task:s.value,employees:g.value,onClose:e[12]||(e[12]=t=>o.value[t]=!1),onChange:N,onAdd:O,onRemove:Q},null,8,["modals","task","employees"])]),_:1})],64)}}};export{Se as default};
