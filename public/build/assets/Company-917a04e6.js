import{R as z,h as o,c as p,z as A,o as V,a as B,m as l,u as x,M as G,F as H,j as v,Z as L,b as r,f as Q,g as R}from"./app-c38d94e2.js";import{_ as W}from"./AuthenticatedLayout-db748a92.js";import Z from"./CompanyHero-6c0b9837.js";import q from"./ProjectGrid-ddf2f607.js";import D from"./ProjectDurationChart-11c25ecf.js";import J from"./TaskProgressChart-8c9b2bc4.js";import K from"./CreateProjectModal-ea726f24.js";import U from"./CompanyMembersModal-34b454d7.js";import"./ApplicationLogo-4f0caa45.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./install-69b691fd.js";import"./index-7b6c413d.js";const X={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12"},Y={key:0,class:"space-y-8",style:{display:"none"}},ee={class:"grid grid-cols-1 xl:grid-cols-2 gap-8"},ae={id:"task-stats-section"},fe={__name:"Company",setup(se){const{props:i}=z(),m=i.id,f=o(!0),n=o(null),_=o([]),d=o(!1),g=o(!1),y=o(!1),j=o(""),h=o(!1),C=o(null),b=o([]),w=o(!1),k=p(()=>{var a,e,s;return((a=n.value)==null?void 0:a.user_id)===((s=(e=i.auth)==null?void 0:e.user)==null?void 0:s.id)}),N=p(()=>{var a,e;return(e=(a=n.value)==null?void 0:a.users)==null?void 0:e.some(s=>{var t,c,u;return s.id===((c=(t=i.auth)==null?void 0:t.user)==null?void 0:c.id)&&((u=s.pivot)==null?void 0:u.role)==="manager"})}),I=p(()=>k.value||N.value),S=p(()=>{var a,e;return(e=(a=i.auth)==null?void 0:a.roles)==null?void 0:e.includes("admin")}),$=async()=>{f.value=!0;try{const{data:a}=await v.get(`/api/companies/${m}`);n.value=a}catch(a){console.error(a)}finally{f.value=!1}},E=async()=>{const{data:a}=await v.get(`/api/users/managers?company_id=${m}`);_.value=a},F=async a=>{var s;const e=n.value.projects.find(t=>t.name===a);if(e){C.value=e,w.value=!0;try{const{data:t}=await v.get(`/api/projects/${e.id}/task-stats`);b.value=t}finally{w.value=!1}(s=document.getElementById("task-stats-section"))==null||s.scrollIntoView({behavior:"smooth"})}},O=async()=>{j.value="",await E(),d.value=!0},T=async a=>{var e,s;y.value=!0;try{await v.post("/api/projects",{...a,company_id:m}),d.value=!1,await $()}catch(t){j.value=((s=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:s.message)||"Ошибка создания"}finally{y.value=!1}};return A(()=>{$(),h.value=window.innerWidth<768}),(a,e)=>{var s;return V(),B(H,null,[l(x(L),{title:((s=n.value)==null?void 0:s.name)||"Компания"},null,8,["title"]),l(W,null,{default:G(()=>{var t,c,u,M;return[r("div",X,[e[4]||(e[4]=Q(" 123 ",-1)),l(Z,{company:n.value,"is-owner":k.value,"is-admin":S.value,"can-create":I.value,onCreate:O,onOpenMembers:e[0]||(e[0]=P=>g.value=!0)},null,8,["company","is-owner","is-admin","can-create"]),l(q,{projects:(t=n.value)==null?void 0:t.projects,loading:f.value},null,8,["projects","loading"]),!h.value&&((u=(c=n.value)==null?void 0:c.projects)!=null&&u.length)?(V(),B("div",Y,[e[3]||(e[3]=r("div",{class:"flex items-center gap-4"},[r("div",{class:"h-px flex-1 bg-slate-200 dark:bg-slate-700"}),r("h2",{class:"text-xl font-bold text-slate-400 uppercase tracking-widest"},"Аналитика"),r("div",{class:"h-px flex-1 bg-slate-200 dark:bg-slate-700"})],-1)),r("div",ee,[l(D,{projects:n.value.projects,onProjectClick:F},null,8,["projects"]),r("div",ae,[l(J,{stats:b.value,loading:w.value,"project-name":(M=C.value)==null?void 0:M.name},null,8,["stats","loading","project-name"])])])])):R("",!0)]),l(K,{show:d.value,managers:_.value,loading:y.value,error:j.value,"current-user-id":x(i).auth.user.id,onClose:e[1]||(e[1]=P=>d.value=!1),onSubmit:T},null,8,["show","managers","loading","error","current-user-id"]),l(U,{show:g.value,"company-id":x(m),onClose:e[2]||(e[2]=P=>g.value=!1)},null,8,["show","company-id"])]}),_:1})],64)}}};export{fe as default};
