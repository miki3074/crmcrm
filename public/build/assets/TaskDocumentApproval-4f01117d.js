import{h as p,c as y,o as r,a as o,b as s,L as S,w as D,l as O,f as w,t as n,F as H,d as q,g as d,v as E,j as m,H as I}from"./app-9a2dd688.js";import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";const G={class:"space-y-8"},J={class:"relative group rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/50 hover:bg-blue-50 dark:hover:bg-gray-800 transition-colors p-6 text-center"},K=["disabled"],Q={key:0,class:"animate-pulse flex flex-col items-center"},W={key:1,class:"flex flex-col items-center pointer-events-none"},X={class:"hidden absolute bottom-4 left-1/2 -translate-x-1/2 z-20 flex items-center gap-2 bg-white dark:bg-gray-700 px-3 py-1.5 rounded-full shadow-md border border-gray-200 dark:border-gray-600"},Y={key:0},Z={class:"flex items-center gap-2 font-bold text-gray-800 dark:text-gray-200 mb-4"},ee={class:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-xs px-2 py-0.5 rounded-full"},te={class:"grid gap-4"},se={class:"flex flex-col sm:flex-row gap-4 justify-between"},ae={class:"flex gap-3"},re={class:"text-3xl select-none"},oe={class:"min-w-0"},ne=["href","title"],le={class:"flex flex-wrap items-center gap-2 text-xs opacity-75 mt-1"},de={class:"sm:hidden mt-2"},ie={class:"inline-flex items-center px-2 py-1 rounded text-xs font-bold bg-white/50 border border-black/5"},ce={class:"mr-1"},ue={class:"flex flex-col items-end gap-2"},pe={class:"hidden sm:inline-flex items-center px-2.5 py-1 rounded-md text-xs font-bold bg-white/50 border border-black/5 shadow-sm"},xe={class:"mr-1.5"},ge={class:"flex items-center gap-2 mt-auto"},be={key:0,class:"flex gap-2"},me=["onClick"],ve=["onClick"],he={key:1},fe=["id","onChange"],ye=["for"],_e=["onClick"],ke={key:0,class:"mt-3 relative"},we={class:"bg-rose-50/80 border border-rose-200 text-rose-800 text-sm p-3 rounded-lg"},Ce={class:"whitespace-pre-wrap"},je={key:0},$e=["onClick"],De={key:1,class:"fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 transition-opacity"},Fe={class:"bg-white dark:bg-gray-800 p-6 rounded-2xl w-full max-w-md shadow-2xl scale-100 transform transition-transform"},Me={class:"flex justify-end gap-3 mt-4"},Ae={__name:"TaskDocumentApproval",props:{task:Object,currentUser:Object},emits:["refresh"],setup(F,{emit:M}){const i=F,x=M,v=p(!1),h=p(!0),f=p(!1),C=p(null),g=p(""),c=p(new Set),j=y(()=>{var a;return(a=i.task.executors)==null?void 0:a.some(t=>t.id===i.currentUser.id)}),$=y(()=>{var a;return(a=i.task.responsibles)==null?void 0:a.some(t=>t.id===i.currentUser.id)}),_=y(()=>{var a;return((a=i.task.files)==null?void 0:a.filter(t=>t.status!=="none"))||[]});y(()=>{var a;return((a=i.task.files)==null?void 0:a.filter(t=>t.status==="none"))||[]});const A=a=>new Date(a).toLocaleDateString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),k=a=>a.file_name&&a.file_name.trim()!==""?a.file_name:a.file_path?a.file_path.split("/").pop():"–î–æ–∫—É–º–µ–Ω—Ç –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",B=a=>{const e=k(a).split(".").pop().toLowerCase();return["pdf"].includes(e)?"üìï":["doc","docx"].includes(e)?"üìò":["xls","xlsx"].includes(e)?"üìä":["ppt","pptx"].includes(e)?"üìô":"üìÑ"},T=async a=>{const t=a.target.files;if(!t.length)return;v.value=!0;const e=new FormData;for(let l=0;l<t.length;l++)e.append("files[]",t[l]);e.append("requires_approval",h.value?"1":"0");try{await m.post(`/api/tasks/${i.task.id}/files`,e,{headers:{"Content-Type":"multipart/form-data"}}),x("refresh"),a.target.value=null,h.value=!1}catch{alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏")}finally{v.value=!1}},V=async a=>{if(confirm("–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ?"))try{await m.delete(`/api/tasks/files/${a}`),x("refresh")}catch{}},R=async a=>{if(confirm(`–£—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç "${a.file_name}"?`))try{await m.put(`/api/files/${a.id}/approve`),x("refresh")}catch{}},U=a=>{C.value=a,g.value="",f.value=!0},z=async()=>{if(g.value.trim())try{await m.put(`/api/files/${C.value.id}/reject`,{reason:g.value}),f.value=!1,x("refresh")}catch{}},L=async(a,t)=>{const e=a.target.files[0];if(!e)return;if(!confirm(`–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ "${e.name}"? –°—Ç–∞—Ç—É—Å —Å–±—Ä–æ—Å–∏—Ç—Å—è –Ω–∞ "–û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏".`)){a.target.value=null;return}const l=new FormData;l.append("file",e);try{await m.post(`/api/files/${t}/replace`,l,{headers:{"Content-Type":"multipart/form-data"}}),x("refresh")}catch{alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–º–µ–Ω–µ")}},N=a=>{c.value.has(a)?c.value.delete(a):c.value.add(a)},b=a=>{switch(a){case"approved":return{text:"–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ",classes:"bg-emerald-100 text-emerald-700 border-emerald-200",icon:"‚úÖ"};case"rejected":return{text:"–ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–µ",classes:"bg-rose-100 text-rose-700 border-rose-200",icon:"üõë"};default:return{text:"–ñ–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏",classes:"bg-amber-50 text-amber-600 border-amber-200",icon:"‚è≥"}}};return(a,t)=>(r(),o("div",G,[s("div",J,[t[6]||(t[6]=s("h1",{class:"font-semibold text-gray-700 dark:text-gray-200"},"–§–∞–π–ª—ã –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",-1)),s("input",{type:"file",multiple:"",class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:T,disabled:v.value},null,40,K),v.value?(r(),o("div",Q,t[3]||(t[3]=[s("svg",{class:"w-8 h-8 text-blue-500 mb-2 animate-spin",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),s("span",{class:"text-sm text-gray-500"},"–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...",-1)]))):(r(),o("div",W,t[4]||(t[4]=[S('<div class="p-3 bg-white dark:bg-gray-700 rounded-full shadow-sm mb-3" data-v-47c37a4b><svg class="w-6 h-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-47c37a4b><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-v-47c37a4b></path></svg></div><h4 class="font-semibold text-gray-700 dark:text-gray-200" data-v-47c37a4b>–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã</h4><p class="text-xs text-gray-400 mt-1" data-v-47c37a4b>PDF, Office (–¥–æ 20MB)</p>',3)]))),s("div",X,[D(s("input",{type:"checkbox",id:"chkApprove","onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),class:"w-4 h-4 rounded text-blue-600 focus:ring-blue-500 cursor-pointer"},null,512),[[O,h.value]]),t[5]||(t[5]=s("label",{for:"chkApprove",class:"text-xs font-medium text-gray-700 dark:text-gray-200 select-none cursor-pointer"}," –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ ",-1))])]),_.value.length>0?(r(),o("div",Y,[s("h3",Z,[t[7]||(t[7]=s("span",null,"üìã",-1)),t[8]||(t[8]=w(" –î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç ",-1)),s("span",ee,n(_.value.length),1)]),s("div",te,[(r(!0),o(H,null,q(_.value,e=>{var l;return r(),o("div",{key:e.id,class:I(["group relative bg-white dark:bg-gray-800 border rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow",b(e.status).classes])},[s("div",se,[s("div",ae,[s("div",re,n(B(e)),1),s("div",oe,[s("a",{href:`/api/tasks/files/${e.id}`,target:"_blank",class:"font-bold hover:underline truncate block text-gray-900 dark:text-white",title:k(e)},n(k(e)),9,ne),s("div",le,[s("span",null,"üë§ "+n((l=e.user)==null?void 0:l.name),1),t[9]||(t[9]=s("span",null,"‚Ä¢",-1)),s("span",null,n(A(e.created_at)),1)]),s("div",de,[s("span",ie,[s("span",ce,n(b(e.status).icon),1),w(" "+n(b(e.status).text),1)])])])]),s("div",ue,[s("span",pe,[s("span",xe,n(b(e.status).icon),1),w(" "+n(b(e.status).text),1)]),s("div",ge,[$.value&&e.status==="pending"?(r(),o("div",be,[s("button",{onClick:u=>R(e),class:"btn-action bg-emerald-600 hover:bg-emerald-700 text-white"}," ‚úî –ü—Ä–∏–Ω—è—Ç—å ",8,me),s("button",{onClick:u=>U(e),class:"btn-action bg-rose-500 hover:bg-rose-600 text-white"}," ‚úñ –í–µ—Ä–Ω—É—Ç—å ",8,ve)])):d("",!0),j.value&&e.status==="rejected"?(r(),o("div",he,[s("input",{type:"file",id:"replace-"+e.id,class:"hidden",onChange:u=>L(u,e.id)},null,40,fe),s("label",{for:"replace-"+e.id,class:"btn-action bg-blue-600 hover:bg-blue-700 text-white cursor-pointer"}," üîÑ –ó–∞–º–µ–Ω–∏—Ç—å ",8,ye)])):d("",!0),(j.value||$.value)&&e.status!=="approved"?(r(),o("button",{key:2,onClick:u=>V(e.id),class:"p-1.5 text-gray-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition",title:"–£–¥–∞–ª–∏—Ç—å"},t[10]||(t[10]=[s("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,_e)):d("",!0)])])]),e.status==="rejected"&&e.rejection_reason?(r(),o("div",ke,[t[12]||(t[12]=s("div",{class:"absolute -top-1.5 left-6 w-3 h-3 bg-rose-50 border-t border-l border-rose-200 rotate-45"},null,-1)),s("div",we,[t[11]||(t[11]=s("span",{class:"font-bold text-xs uppercase opacity-70 mr-2"},"–ü—Ä–∏—á–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞:",-1)),s("span",Ce,n(c.value.has(e.id)?e.rejection_reason:e.rejection_reason.slice(0,80)),1),!c.value.has(e.id)&&e.rejection_reason.length>80?(r(),o("span",je,"...")):d("",!0),e.rejection_reason.length>80?(r(),o("button",{key:1,onClick:u=>N(e.id),class:"ml-2 text-xs font-bold text-rose-600 hover:underline"},n(c.value.has(e.id)?"–°–≤–µ—Ä–Ω—É—Ç—å":"–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ"),9,$e)):d("",!0)])])):d("",!0)],2)}),128))])])):d("",!0),f.value?(r(),o("div",De,[s("div",Fe,[t[13]||(t[13]=s("h3",{class:"font-bold text-lg mb-1 dark:text-white"},"–í–µ—Ä–Ω—É—Ç—å –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É",-1)),t[14]||(t[14]=s("p",{class:"text-sm text-gray-500 mb-4"},"–£–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.",-1)),D(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>g.value=e),class:"w-full border border-gray-300 dark:border-gray-600 rounded-xl p-3 h-32 text-sm focus:ring-2 focus:ring-rose-500 focus:border-rose-500 dark:bg-gray-700 dark:text-white",placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–µ–≤–µ—Ä–Ω–∞—è –¥–∞—Ç–∞ –≤ —à–∞–ø–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞...",autofocus:""},null,512),[[E,g.value]]),s("div",Me,[s("button",{onClick:t[2]||(t[2]=e=>f.value=!1),class:"px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg transition dark:text-gray-300 dark:hover:bg-gray-700"},"–û—Ç–º–µ–Ω–∞"),s("button",{onClick:z,class:"px-4 py-2 text-sm font-bold bg-rose-600 text-white rounded-lg shadow hover:bg-rose-700 transition"},"–í–µ—Ä–Ω—É—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç")])])])):d("",!0)]))}},Ve=P(Ae,[["__scopeId","data-v-47c37a4b"]]);export{Ve as default};
