import{Q as G,r as o,j as p,x as L,o as B,c as I,k as l,u as w,I as Q,F as T,f as v,Z as W,a as r,d as Z}from"./app-e92293fe.js";import{_ as q}from"./AuthenticatedLayout-93dd1f4c.js";import z from"./CompanyHero-8a6f153a.js";import D from"./ProjectGrid-527f02aa.js";import H from"./ProjectDurationChart-ab33bb2f.js";import J from"./TaskProgressChart-27d7ebd9.js";import K from"./CreateProjectModal-6d19a864.js";import R from"./CompanyMembersModal-8b7936b3.js";import"./ApplicationLogo-b041db19.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./install-27c09b59.js";import"./index-a91ff812.js";const U={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12"},X={key:0,class:"space-y-8"},Y={class:"grid grid-cols-1 xl:grid-cols-2 gap-8"},ee={id:"task-stats-section"},ve={__name:"Show",setup(ae){const{props:i}=G(),m=i.id,f=o(!0),n=o(null),j=o([]),d=o(!1),g=o(!1),y=o(!1),_=o(""),x=o(!1),k=o(null),C=o([]),h=o(!1),$=p(()=>{var a,e,s;return((a=n.value)==null?void 0:a.user_id)===((s=(e=i.auth)==null?void 0:e.user)==null?void 0:s.id)}),S=p(()=>{var a,e;return(e=(a=n.value)==null?void 0:a.users)==null?void 0:e.some(s=>{var t,c,u;return s.id===((c=(t=i.auth)==null?void 0:t.user)==null?void 0:c.id)&&((u=s.pivot)==null?void 0:u.role)==="manager"})}),V=p(()=>$.value||S.value),N=p(()=>{var a,e;return(e=(a=i.auth)==null?void 0:a.roles)==null?void 0:e.includes("admin")}),b=async()=>{f.value=!0;try{const{data:a}=await v.get(`/api/companies/${m}`);n.value=a}catch(a){console.error(a)}finally{f.value=!1}},E=async()=>{const{data:a}=await v.get(`/api/users/managers?company_id=${m}`);j.value=a},F=async a=>{var s;const e=n.value.projects.find(t=>t.name===a);if(e){k.value=e,h.value=!0;try{const{data:t}=await v.get(`/api/projects/${e.id}/task-stats`);C.value=t}finally{h.value=!1}(s=document.getElementById("task-stats-section"))==null||s.scrollIntoView({behavior:"smooth"})}},O=async()=>{_.value="",await E(),d.value=!0},A=async a=>{var e,s;y.value=!0;try{await v.post("/api/projects",{...a,company_id:m}),d.value=!1,await b()}catch(t){_.value=((s=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:s.message)||"Ошибка создания"}finally{y.value=!1}};return L(()=>{b(),x.value=window.innerWidth<768}),(a,e)=>{var s;return B(),I(T,null,[l(w(W),{title:((s=n.value)==null?void 0:s.name)||"Компания"},null,8,["title"]),l(q,null,{default:Q(()=>{var t,c,u,M;return[r("div",U,[l(z,{company:n.value,"is-owner":$.value,"is-admin":N.value,"can-create":V.value,onCreate:O,onOpenMembers:e[0]||(e[0]=P=>g.value=!0)},null,8,["company","is-owner","is-admin","can-create"]),l(D,{projects:(t=n.value)==null?void 0:t.projects,loading:f.value},null,8,["projects","loading"]),!x.value&&((u=(c=n.value)==null?void 0:c.projects)!=null&&u.length)?(B(),I("div",X,[e[3]||(e[3]=r("div",{class:"flex items-center gap-4"},[r("div",{class:"h-px flex-1 bg-slate-200 dark:bg-slate-700"}),r("h2",{class:"text-xl font-bold text-slate-400 uppercase tracking-widest"},"Аналитика"),r("div",{class:"h-px flex-1 bg-slate-200 dark:bg-slate-700"})],-1)),r("div",Y,[l(H,{projects:n.value.projects,onProjectClick:F},null,8,["projects"]),r("div",ee,[l(J,{stats:C.value,loading:h.value,"project-name":(M=k.value)==null?void 0:M.name},null,8,["stats","loading","project-name"])])])])):Z("",!0)]),l(K,{show:d.value,managers:j.value,loading:y.value,error:_.value,"current-user-id":w(i).auth.user.id,onClose:e[1]||(e[1]=P=>d.value=!1),onSubmit:A},null,8,["show","managers","loading","error","current-user-id"]),l(R,{show:g.value,"company-id":w(m),onClose:e[2]||(e[2]=P=>g.value=!1)},null,8,["show","company-id"])]}),_:1})],64)}}};export{ve as default};
