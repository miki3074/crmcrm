import{Q as q,r as z,m as $,q as D,o as l,f as d,a as N,u as I,w as S,F as V,i as p,Z as L,b as t,t as a,n as B,d as M,g as x,x as Q}from"./app-4448dbe9.js";import{_ as T}from"./AuthenticatedLayout-60250e5e.js";import"./ApplicationLogo-0de6f794.js";import"./_plugin-vue_export-helper-c27b6911.js";const U={class:"flex items-center justify-between gap-3"},Z={class:"text-xl font-bold text-gray-800 dark:text-gray-200"},A={key:0,class:"flex items-center gap-2"},G={class:"inline-flex items-center gap-2 text-sm px-3 py-1 rounded-full ring-1 ring-gray-200 dark:ring-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300"},H={key:1,class:"px-3 py-1.5 rounded-md bg-emerald-100 text-emerald-700 text-sm dark:bg-emerald-900/30 dark:text-emerald-300"},J={class:"max-w-4xl mx-auto py-8 px-4"},K={key:0,class:"grid gap-6"},O={class:"bg-white dark:bg-gray-800 rounded-2xl shadow p-6"},R={class:"grid sm:grid-cols-2 gap-4 text-sm"},W={class:"font-medium text-gray-900 dark:text-white"},X={class:"font-medium text-gray-900 dark:text-white"},Y={class:"font-medium text-gray-900 dark:text-white"},tt={class:"font-medium text-gray-900 dark:text-white"},et={class:"font-medium text-gray-900 dark:text-white"},st={class:"mt-6 grid sm:grid-cols-3 gap-4"},at={class:"font-medium text-gray-900 dark:text-white"},rt={class:"font-medium text-gray-900 dark:text-white"},ot={class:"font-medium text-gray-900 dark:text-white"},lt={class:"bg-white dark:bg-gray-800 rounded-2xl shadow p-6"},dt={class:"flex items-center justify-between mb-3"},nt={class:"text-sm text-gray-500 dark:text-gray-400"},it={class:"flex mt-2 space-x-1 select-none"},ut=["title","onClick"],ct={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-2"},gt={key:1,class:"text-gray-600 dark:text-gray-300"},_t={__name:"Show",setup(pt){var y;const{props:m}=q(),c=m.id,e=z(null),g=(y=m.auth)==null?void 0:y.user,E=async()=>{const{data:o}=await p.get(`/api/subtasks/${c}`);e.value=o},n=$(()=>!e.value||!g?!1:(e.value.executors||[]).some(s=>s.id===g.id)||g.id===e.value.creator_id),v=$(()=>e.value?n.value&&e.value.progress===100&&!e.value.completed:!1),F=async o=>{if(!n.value)return;const{data:s}=await p.patch(`/api/subtasks/${c}/progress`,{progress:o});e.value.progress=s.progress},P=async()=>{if(!v.value||!confirm("Завершить подзадачу?"))return;const{data:o}=await p.patch(`/api/subtasks/${c}/complete`);e.value.completed=o.completed,e.value.completed_at=o.completed_at};return D(E),(o,s)=>(l(),d(V,null,[N(I(L),{title:"Подзадача"}),N(T,null,{header:S(()=>{var i,u;return[t("div",U,[t("h2",Z," Подзадача: "+a(((i=e.value)==null?void 0:i.title)??"Загрузка..."),1),e.value?(l(),d("div",A,[t("span",G,[t("span",{class:B(["w-2 h-2 rounded-full",{"bg-red-500":(e.value.progress??0)<30,"bg-amber-500":(e.value.progress??0)>=30&&(e.value.progress??0)<70,"bg-green-500":(e.value.progress??0)>=70}])},null,2),M(" "+a(e.value.progress??0)+"% ",1)]),v.value?(l(),d("button",{key:0,onClick:P,class:"px-3 py-1.5 rounded-md bg-emerald-600 text-white text-sm hover:bg-emerald-700"}," Завершить ")):e.value.completed?(l(),d("span",H," Завершена • "+a(((u=e.value.completed_at)==null?void 0:u.slice(0,16))??""),1)):x("",!0)])):x("",!0)])]}),default:S(()=>{var i,u,k,_,h,f,b,w,C;return[t("div",J,[e.value?(l(),d("div",K,[t("div",O,[t("div",R,[t("div",null,[s[0]||(s[0]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Автор",-1)),t("p",W,a((i=e.value.creator)==null?void 0:i.name),1)]),t("div",null,[s[1]||(s[1]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Исполнитель",-1)),t("p",X,a((u=e.value.executors)!=null&&u.length?e.value.executors.map(r=>r.name).join(", "):"—"),1)]),t("div",null,[s[2]||(s[2]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Ответственный",-1)),t("p",Y,a((k=e.value.responsibles)!=null&&k.length?e.value.responsibles.map(r=>r.name).join(", "):"—"),1)]),t("div",null,[s[3]||(s[3]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Дата начала",-1)),t("p",tt,a(e.value.start_date),1)]),t("div",null,[s[4]||(s[4]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Дата окончания",-1)),t("p",et,a(e.value.due_date),1)])]),t("div",st,[t("div",null,[s[5]||(s[5]=t("p",{class:"text-gray-500 dark:text-gray-400 text-sm"},"Задача",-1)),t("p",at,a((_=e.value.task)==null?void 0:_.title),1)]),t("div",null,[s[6]||(s[6]=t("p",{class:"text-gray-500 dark:text-gray-400 text-sm"},"Проект",-1)),t("p",rt,a((f=(h=e.value.task)==null?void 0:h.project)==null?void 0:f.name),1)]),t("div",null,[s[7]||(s[7]=t("p",{class:"text-gray-500 dark:text-gray-400 text-sm"},"Компания",-1)),t("p",ot,a((C=(w=(b=e.value.task)==null?void 0:b.project)==null?void 0:w.company)==null?void 0:C.name),1)])])]),t("div",lt,[t("div",dt,[s[8]||(s[8]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Прогресс подзадачи",-1)),t("span",nt,"Выполнено "+a(e.value.progress??0)+"%",1)]),t("div",it,[(l(),d(V,null,Q(10,r=>{var j;return t("div",{key:r,title:r*10+"%",onClick:xt=>n.value?F(r*10):null,class:B(["h-4 sm:h-5 flex-1 rounded transition",{"cursor-pointer hover:opacity-80":n.value,"bg-green-600":(e.value.progress??0)>=r*10,"bg-gray-200 dark:bg-gray-700":(e.value.progress??0)<r*10,"pointer-events-none opacity-60":(j=e.value)==null?void 0:j.completed}])},null,10,ut)}),64))]),n.value?x("",!0):(l(),d("p",ct," Изменять прогресс могут только исполнитель и автор подзадачи. "))])])):(l(),d("div",gt,"Загрузка..."))])]}),_:1})],64))}};export{_t as default};
