import{r as p,j as y,o as r,c as a,a as t,I as S,h as $,i as N,b as k,t as n,F as O,e as E,d,v as I,f as m,E as q}from"./app-79ce4b65.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";const P={class:"space-y-8"},G={class:"relative group rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/50 hover:bg-blue-50 dark:hover:bg-gray-800 transition-colors p-6 text-center"},J=["disabled"],K={key:0,class:"animate-pulse flex flex-col items-center"},Q={key:1,class:"flex flex-col items-center pointer-events-none"},W={class:"hidden absolute bottom-4 left-1/2 -translate-x-1/2 z-20 flex items-center gap-2 bg-white dark:bg-gray-700 px-3 py-1.5 rounded-full shadow-md border border-gray-200 dark:border-gray-600"},X={key:0},Y={class:"flex items-center gap-2 font-bold text-gray-800 dark:text-gray-200 mb-4"},Z={class:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-xs px-2 py-0.5 rounded-full"},ee={class:"grid gap-4"},te={class:"flex flex-col sm:flex-row gap-4 justify-between"},se={class:"flex gap-3"},oe={class:"text-3xl select-none"},re={class:"min-w-0"},ae=["href","title"],ne={class:"flex flex-wrap items-center gap-2 text-xs opacity-75 mt-1"},le={class:"sm:hidden mt-2"},de={class:"inline-flex items-center px-2 py-1 rounded text-xs font-bold bg-white/50 border border-black/5"},ie={class:"mr-1"},ce={class:"flex flex-col items-end gap-2"},ue={class:"hidden sm:inline-flex items-center px-2.5 py-1 rounded-md text-xs font-bold bg-white/50 border border-black/5 shadow-sm"},pe={class:"mr-1.5"},xe={class:"flex items-center gap-2 mt-auto"},ge={key:0,class:"flex gap-2"},be=["onClick"],me=["onClick"],ve={key:1},he=["id","onChange"],fe=["for"],ye=["onClick"],_e={key:0,class:"mt-3 relative"},ke={class:"bg-rose-50/80 border border-rose-200 text-rose-800 text-sm p-3 rounded-lg"},we={class:"whitespace-pre-wrap"},Ce={key:0},je=["onClick"],$e={key:1,class:"fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 transition-opacity"},De={class:"bg-white dark:bg-gray-800 p-6 rounded-2xl w-full max-w-md shadow-2xl scale-100 transform transition-transform"},Me={class:"flex justify-end gap-3 mt-4"},Ae={__name:"TaskDocumentApproval",props:{task:Object,currentUser:Object},emits:["refresh"],setup(D,{emit:M}){const i=D,x=M,v=p(!1),h=p(!0),f=p(!1),w=p(null),g=p(""),c=p(new Set),C=y(()=>{var o;return(o=i.task.executors)==null?void 0:o.some(e=>e.id===i.currentUser.id)}),j=y(()=>{var o;return(o=i.task.responsibles)==null?void 0:o.some(e=>e.id===i.currentUser.id)}),_=y(()=>{var o;return((o=i.task.files)==null?void 0:o.filter(e=>e.status!=="none"))||[]});y(()=>{var o;return((o=i.task.files)==null?void 0:o.filter(e=>e.status==="none"))||[]});const A=o=>new Date(o).toLocaleDateString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),F=o=>{const e=o.split(".").pop().toLowerCase();return["pdf"].includes(e)?"üìï":["doc","docx"].includes(e)?"üìò":["xls","xlsx"].includes(e)?"üìä":"üìÑ"},B=async o=>{const e=o.target.files;if(!e.length)return;v.value=!0;const s=new FormData;for(let l=0;l<e.length;l++)s.append("files[]",e[l]);s.append("requires_approval",h.value?"1":"0");try{await m.post(`/api/tasks/${i.task.id}/files`,s,{headers:{"Content-Type":"multipart/form-data"}}),x("refresh"),o.target.value=null,h.value=!1}catch{alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏")}finally{v.value=!1}},T=async o=>{if(confirm("–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ?"))try{await m.delete(`/api/tasks/files/${o}`),x("refresh")}catch{}},V=async o=>{if(confirm(`–£—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç "${o.file_name}"?`))try{await m.put(`/api/files/${o.id}/approve`),x("refresh")}catch{}},R=o=>{w.value=o,g.value="",f.value=!0},U=async()=>{if(g.value.trim())try{await m.put(`/api/files/${w.value.id}/reject`,{reason:g.value}),f.value=!1,x("refresh")}catch{}},z=async(o,e)=>{const s=o.target.files[0];if(!s)return;if(!confirm(`–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ "${s.name}"? –°—Ç–∞—Ç—É—Å —Å–±—Ä–æ—Å–∏—Ç—Å—è –Ω–∞ "–û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏".`)){o.target.value=null;return}const l=new FormData;l.append("file",s);try{await m.post(`/api/files/${e}/replace`,l,{headers:{"Content-Type":"multipart/form-data"}}),x("refresh")}catch{alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–º–µ–Ω–µ")}},L=o=>{c.value.has(o)?c.value.delete(o):c.value.add(o)},b=o=>{switch(o){case"approved":return{text:"–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ",classes:"bg-emerald-100 text-emerald-700 border-emerald-200",icon:"‚úÖ"};case"rejected":return{text:"–ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–µ",classes:"bg-rose-100 text-rose-700 border-rose-200",icon:"üõë"};default:return{text:"–ñ–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏",classes:"bg-amber-50 text-amber-600 border-amber-200",icon:"‚è≥"}}};return(o,e)=>(r(),a("div",P,[t("div",G,[e[6]||(e[6]=t("h1",{class:"font-semibold text-gray-700 dark:text-gray-200"},"–§–∞–π–ª—ã –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",-1)),t("input",{type:"file",multiple:"",class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:B,disabled:v.value},null,40,J),v.value?(r(),a("div",K,e[3]||(e[3]=[t("svg",{class:"w-8 h-8 text-blue-500 mb-2 animate-spin",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),t("span",{class:"text-sm text-gray-500"},"–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...",-1)]))):(r(),a("div",Q,e[4]||(e[4]=[S('<div class="p-3 bg-white dark:bg-gray-700 rounded-full shadow-sm mb-3" data-v-38966b9e><svg class="w-6 h-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-38966b9e><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-v-38966b9e></path></svg></div><h4 class="font-semibold text-gray-700 dark:text-gray-200" data-v-38966b9e>–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã</h4><p class="text-xs text-gray-400 mt-1" data-v-38966b9e>PDF, Office (–¥–æ 20MB)</p>',3)]))),t("div",W,[$(t("input",{type:"checkbox",id:"chkApprove","onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),class:"w-4 h-4 rounded text-blue-600 focus:ring-blue-500 cursor-pointer"},null,512),[[N,h.value]]),e[5]||(e[5]=t("label",{for:"chkApprove",class:"text-xs font-medium text-gray-700 dark:text-gray-200 select-none cursor-pointer"}," –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ ",-1))])]),_.value.length>0?(r(),a("div",X,[t("h3",Y,[e[7]||(e[7]=t("span",null,"üìã",-1)),e[8]||(e[8]=k(" –î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç ",-1)),t("span",Z,n(_.value.length),1)]),t("div",ee,[(r(!0),a(O,null,E(_.value,s=>{var l;return r(),a("div",{key:s.id,class:q(["group relative bg-white dark:bg-gray-800 border rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow",b(s.status).classes])},[t("div",te,[t("div",se,[t("div",oe,n(F(s.file_name)),1),t("div",re,[t("a",{href:`/storage/${s.file_path}`,target:"_blank",class:"font-bold hover:underline truncate block text-gray-900 dark:text-white",title:s.file_name},n(s.file_name),9,ae),t("div",ne,[t("span",null,"üë§ "+n((l=s.user)==null?void 0:l.name),1),e[9]||(e[9]=t("span",null,"‚Ä¢",-1)),t("span",null,n(A(s.created_at)),1)]),t("div",le,[t("span",de,[t("span",ie,n(b(s.status).icon),1),k(" "+n(b(s.status).text),1)])])])]),t("div",ce,[t("span",ue,[t("span",pe,n(b(s.status).icon),1),k(" "+n(b(s.status).text),1)]),t("div",xe,[j.value&&s.status==="pending"?(r(),a("div",ge,[t("button",{onClick:u=>V(s),class:"btn-action bg-emerald-600 hover:bg-emerald-700 text-white"}," ‚úî –ü—Ä–∏–Ω—è—Ç—å ",8,be),t("button",{onClick:u=>R(s),class:"btn-action bg-rose-500 hover:bg-rose-600 text-white"}," ‚úñ –í–µ—Ä–Ω—É—Ç—å ",8,me)])):d("",!0),C.value&&s.status==="rejected"?(r(),a("div",ve,[t("input",{type:"file",id:"replace-"+s.id,class:"hidden",onChange:u=>z(u,s.id)},null,40,he),t("label",{for:"replace-"+s.id,class:"btn-action bg-blue-600 hover:bg-blue-700 text-white cursor-pointer"}," üîÑ –ó–∞–º–µ–Ω–∏—Ç—å ",8,fe)])):d("",!0),(C.value||j.value)&&s.status!=="approved"?(r(),a("button",{key:2,onClick:u=>T(s.id),class:"p-1.5 text-gray-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition",title:"–£–¥–∞–ª–∏—Ç—å"},e[10]||(e[10]=[t("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,ye)):d("",!0)])])]),s.status==="rejected"&&s.rejection_reason?(r(),a("div",_e,[e[12]||(e[12]=t("div",{class:"absolute -top-1.5 left-6 w-3 h-3 bg-rose-50 border-t border-l border-rose-200 rotate-45"},null,-1)),t("div",ke,[e[11]||(e[11]=t("span",{class:"font-bold text-xs uppercase opacity-70 mr-2"},"–ü—Ä–∏—á–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞:",-1)),t("span",we,n(c.value.has(s.id)?s.rejection_reason:s.rejection_reason.slice(0,80)),1),!c.value.has(s.id)&&s.rejection_reason.length>80?(r(),a("span",Ce,"...")):d("",!0),s.rejection_reason.length>80?(r(),a("button",{key:1,onClick:u=>L(s.id),class:"ml-2 text-xs font-bold text-rose-600 hover:underline"},n(c.value.has(s.id)?"–°–≤–µ—Ä–Ω—É—Ç—å":"–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ"),9,je)):d("",!0)])])):d("",!0)],2)}),128))])])):d("",!0),f.value?(r(),a("div",$e,[t("div",De,[e[13]||(e[13]=t("h3",{class:"font-bold text-lg mb-1 dark:text-white"},"–í–µ—Ä–Ω—É—Ç—å –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É",-1)),e[14]||(e[14]=t("p",{class:"text-sm text-gray-500 mb-4"},"–£–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.",-1)),$(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),class:"w-full border border-gray-300 dark:border-gray-600 rounded-xl p-3 h-32 text-sm focus:ring-2 focus:ring-rose-500 focus:border-rose-500 dark:bg-gray-700 dark:text-white",placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–µ–≤–µ—Ä–Ω–∞—è –¥–∞—Ç–∞ –≤ —à–∞–ø–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞...",autofocus:""},null,512),[[I,g.value]]),t("div",Me,[t("button",{onClick:e[2]||(e[2]=s=>f.value=!1),class:"px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg transition dark:text-gray-300 dark:hover:bg-gray-700"},"–û—Ç–º–µ–Ω–∞"),t("button",{onClick:U,class:"px-4 py-2 text-sm font-bold bg-rose-600 text-white rounded-lg shadow hover:bg-rose-700 transition"},"–í–µ—Ä–Ω—É—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç")])])])):d("",!0)]))}},Te=H(Ae,[["__scopeId","data-v-38966b9e"]]);export{Te as default};
