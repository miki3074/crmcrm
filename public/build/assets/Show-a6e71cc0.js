import{R as A,h as o,c as p,z as G,o as B,a as S,m as l,u as w,M as L,F as Q,j as v,Z as R,b as r,g as T}from"./app-9a2dd688.js";import{_ as W}from"./AuthenticatedLayout-57faf720.js";import Z from"./CompanyHero-9dfdda9b.js";import q from"./ProjectGrid-eb3582bf.js";import D from"./ProjectDurationChart-c52e5bd9.js";import H from"./TaskProgressChart-02a2b4cb.js";import J from"./CreateProjectModal-33031dbe.js";import K from"./CompanyMembersModal-6b6c19ef.js";import"./ApplicationLogo-f81164ff.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./install-10bca7f3.js";import"./index-01f0d1c5.js";const U={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12"},X={key:0,class:"space-y-8"},Y={class:"grid grid-cols-1 xl:grid-cols-2 gap-8"},ee={id:"task-stats-section"},ve={__name:"Show",setup(ae){const{props:i}=A(),m=i.id,f=o(!0),n=o(null),j=o([]),d=o(!1),g=o(!1),y=o(!1),_=o(""),x=o(!1),C=o(null),b=o([]),h=o(!1),k=p(()=>{var a,e,s;return((a=n.value)==null?void 0:a.user_id)===((s=(e=i.auth)==null?void 0:e.user)==null?void 0:s.id)}),V=p(()=>{var a,e;return(e=(a=n.value)==null?void 0:a.users)==null?void 0:e.some(s=>{var t,c,u;return s.id===((c=(t=i.auth)==null?void 0:t.user)==null?void 0:c.id)&&((u=s.pivot)==null?void 0:u.role)==="manager"})}),I=p(()=>k.value||V.value),N=p(()=>{var a,e;return(e=(a=i.auth)==null?void 0:a.roles)==null?void 0:e.includes("admin")}),$=async()=>{f.value=!0;try{const{data:a}=await v.get(`/api/companies/${m}`);n.value=a}catch(a){console.error(a)}finally{f.value=!1}},E=async()=>{const{data:a}=await v.get(`/api/users/managers?company_id=${m}`);j.value=a},F=async a=>{var s;const e=n.value.projects.find(t=>t.name===a);if(e){C.value=e,h.value=!0;try{const{data:t}=await v.get(`/api/projects/${e.id}/task-stats`);b.value=t}finally{h.value=!1}(s=document.getElementById("task-stats-section"))==null||s.scrollIntoView({behavior:"smooth"})}},O=async()=>{_.value="",await E(),d.value=!0},z=async a=>{var e,s;y.value=!0;try{await v.post("/api/projects",{...a,company_id:m}),d.value=!1,await $()}catch(t){_.value=((s=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:s.message)||"Ошибка создания"}finally{y.value=!1}};return G(()=>{$(),x.value=window.innerWidth<768}),(a,e)=>{var s;return B(),S(Q,null,[l(w(R),{title:((s=n.value)==null?void 0:s.name)||"Компания"},null,8,["title"]),l(W,null,{default:L(()=>{var t,c,u,M;return[r("div",U,[l(Z,{company:n.value,"is-owner":k.value,"is-admin":N.value,"can-create":I.value,onCreate:O,onOpenMembers:e[0]||(e[0]=P=>g.value=!0)},null,8,["company","is-owner","is-admin","can-create"]),l(q,{projects:(t=n.value)==null?void 0:t.projects,loading:f.value},null,8,["projects","loading"]),!x.value&&((u=(c=n.value)==null?void 0:c.projects)!=null&&u.length)?(B(),S("div",X,[e[3]||(e[3]=r("div",{class:"flex items-center gap-4"},[r("div",{class:"h-px flex-1 bg-slate-200 dark:bg-slate-700"}),r("h2",{class:"text-xl font-bold text-slate-400 uppercase tracking-widest"},"Аналитика"),r("div",{class:"h-px flex-1 bg-slate-200 dark:bg-slate-700"})],-1)),r("div",Y,[l(D,{projects:n.value.projects,onProjectClick:F},null,8,["projects"]),r("div",ee,[l(H,{stats:b.value,loading:h.value,"project-name":(M=C.value)==null?void 0:M.name},null,8,["stats","loading","project-name"])])])])):T("",!0)]),l(J,{show:d.value,managers:j.value,loading:y.value,error:_.value,"current-user-id":w(i).auth.user.id,onClose:e[1]||(e[1]=P=>d.value=!1),onSubmit:z},null,8,["show","managers","loading","error","current-user-id"]),l(K,{show:g.value,"company-id":w(m),onClose:e[2]||(e[2]=P=>g.value=!1)},null,8,["show","company-id"])]}),_:1})],64)}}};export{ve as default};
