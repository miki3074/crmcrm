import{h as u,c as B,o as r,a as l,b as t,g as f,F as m,d as _,w as x,v as h,t as g,j as w,H as z,l as C}from"./app-76fc43c1.js";import{_ as D}from"./_plugin-vue_export-helper-c27b6911.js";const E={class:"bg-white dark:bg-gray-800 rounded-2xl shadow p-6 mt-6"},F={class:"flex items-center justify-between mb-3"},I={key:0,class:"space-y-2"},N={class:"font-medium text-gray-800 dark:text-gray-200"},H=["href"],L={key:1,class:"text-sm text-gray-500 dark:text-gray-400 italic"},T={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4"},q={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-md shadow-xl flex flex-col max-h-[90vh]"},A={class:"space-y-4 overflow-y-auto pr-2 custom-scrollbar"},G={class:"max-h-32 overflow-y-auto border rounded-lg p-2 dark:border-gray-600 dark:bg-gray-700/50"},J=["value"],K={class:"text-sm text-gray-700 dark:text-gray-200"},O={class:"max-h-32 overflow-y-auto border rounded-lg p-2 dark:border-gray-600 dark:bg-gray-700/50"},P=["value"],Q={class:"text-sm text-gray-700 dark:text-gray-200"},R={key:0,class:"text-rose-600 text-sm mt-3"},W={class:"flex justify-end gap-2 mt-5 pt-2 border-t dark:border-gray-700"},X=["disabled"],Y={key:0},Z={key:1},ee={__name:"SubtaskChildren",props:["subtask","user"],emits:["refresh"],setup(p,{emit:V}){const v=p,M=V,c=u(!1),b=u(!1),i=u(""),y=u([]),o=u({title:"",due_date:"",executor_ids:[],responsible_ids:[]}),j=B(()=>{var s,n;const{subtask:d,user:e}=v;if(!d||!e)return!1;const a=(s=d.task)==null?void 0:s.project;return e.id===d.creator_id||e.id===((n=a==null?void 0:a.company)==null?void 0:n.user_id)||((a==null?void 0:a.managers)||[]).some(k=>k.id===e.id)||((a==null?void 0:a.executors)||[]).some(k=>k.id===e.id)}),S=async()=>{var d,e;if(!(y.value.length>0))try{const a=(e=(d=v.subtask.task)==null?void 0:d.project)==null?void 0:e.id;if(!a)return;const{data:s}=await w.get(`/api/projects/${a}/employees`);y.value=s}catch(a){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",a)}},U=async()=>{await S(),o.value={title:"",due_date:"",executor_ids:[],responsible_ids:[]},i.value="",c.value=!0},$=async()=>{var d,e;b.value=!0,i.value="";try{await w.post(`/api/subtasks/${v.subtask.id}/children`,o.value),M("refresh"),c.value=!1}catch(a){i.value=((e=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:e.message)||"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–∑–∞–¥–∞—á–∏"}finally{b.value=!1}};return(d,e)=>{var a;return r(),l(m,null,[t("div",E,[t("div",F,[e[5]||(e[5]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"üß© –í–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏",-1)),j.value?(r(),l("button",{key:0,onClick:U,class:"px-3 py-1 bg-emerald-600 hover:bg-emerald-700 text-white rounded-md text-sm transition"}," ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á—É ")):f("",!0)]),(a=p.subtask.children)!=null&&a.length?(r(),l("ul",I,[(r(!0),l(m,null,_(p.subtask.children,s=>(r(),l("li",{key:s.id,class:"flex justify-between items-center bg-gray-50 dark:bg-gray-700 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition"},[t("div",null,[t("span",N,g(s.title),1),t("span",{class:z(["text-xs ml-2 px-2 py-0.5 rounded-full",{"bg-green-100 text-green-700":s.completed,"bg-gray-200 text-gray-600":!s.completed}])},g(s.completed?"–ó–∞–≤–µ—Ä—à–µ–Ω–∞":(s.progress??0)+"%"),3)]),t("a",{href:`/subtasks/${s.id}`,class:"text-blue-600 dark:text-blue-400 hover:underline text-sm font-medium"}," –û—Ç–∫—Ä—ã—Ç—å ‚Üí ",8,H)]))),128))])):(r(),l("p",L," –ù–µ—Ç –¥–æ—á–µ—Ä–Ω–∏—Ö –ø–æ–¥–∑–∞–¥–∞—á "))]),c.value?(r(),l("div",T,[t("div",q,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," ‚ûï –ù–æ–≤–∞—è –¥–æ—á–µ—Ä–Ω—è—è –ø–æ–¥–∑–∞–¥–∞—á–∞ ",-1)),t("div",A,[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," –ù–∞–∑–≤–∞–Ω–∏–µ ",-1)),x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.title=s),type:"text",class:"w-full border rounded-lg p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-emerald-500 outline-none",placeholder:"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ..."},null,512),[[h,o.value.title]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è ",-1)),x(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.due_date=s),type:"date",class:"w-full border rounded-lg p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[h,o.value.due_date]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ ",-1)),t("div",G,[(r(!0),l(m,null,_(y.value,s=>(r(),l("label",{key:s.id,class:"flex items-center gap-2 py-1 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 rounded px-1"},[x(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=n=>o.value.executor_ids=n),value:s.id,class:"rounded text-emerald-600 focus:ring-emerald-500"},null,8,J),[[C,o.value.executor_ids]]),t("span",K,g(s.name),1)]))),128))])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ ",-1)),t("div",O,[(r(!0),l(m,null,_(y.value,s=>(r(),l("label",{key:s.id,class:"flex items-center gap-2 py-1 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 rounded px-1"},[x(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=n=>o.value.responsible_ids=n),value:s.id,class:"rounded text-amber-600 focus:ring-amber-500"},null,8,P),[[C,o.value.responsible_ids]]),t("span",Q,g(s.name),1)]))),128))])])]),i.value?(r(),l("p",R,g(i.value),1)):f("",!0),t("div",W,[t("button",{onClick:e[4]||(e[4]=s=>c.value=!1),class:"px-4 py-2 border rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition"}," –û—Ç–º–µ–Ω–∞ "),t("button",{onClick:$,class:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition disabled:opacity-50",disabled:b.value||!o.value.title},[b.value?(r(),l("span",Z,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(r(),l("span",Y,"–°–æ–∑–¥–∞—Ç—å"))],8,X)])])])):f("",!0)],64)}}},ae=D(ee,[["__scopeId","data-v-3d613220"]]);export{ae as default};
