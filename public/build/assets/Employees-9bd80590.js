import{l as v,m as i,k as D,p as P,o as s,f as o,a as L,u as T,w as $,F as x,Z,b as e,h as u,v as b,q as _,s as h,g as m,e as A,t as n,n as G}from"./app-048e9485.js";import{_ as H}from"./AuthenticatedLayout-aadadc44.js";import"./ApplicationLogo-47ea3b8a.js";import"./_plugin-vue_export-helper-c27b6911.js";const I={class:"flex items-center justify-between"},J={class:"max-w-6xl mx-auto py-8 px-4"},K={class:"grid gap-3 md:grid-cols-3 mb-4"},O=["value"],Q={class:"overflow-hidden rounded-2xl border dark:border-gray-700 bg-white dark:bg-gray-900"},R={class:"w-full text-sm"},W={key:0},X={key:1},Y={class:"px-4 py-3 font-medium text-gray-900 dark:text-gray-100"},ee={class:"px-4 py-3 text-gray-600 dark:text-gray-300"},te={class:"px-4 py-3 text-gray-600 dark:text-gray-300"},le={class:"px-4 py-3"},ae={key:0},se={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50"},oe={class:"w-full max-w-xl rounded-2xl bg-white p-6 shadow-xl dark:bg-gray-900"},re={class:"flex items-center justify-between"},de={key:0,class:"mt-1 text-xs text-rose-600"},ne={key:0,class:"mt-1 text-xs text-rose-600"},ie={class:"grid md:grid-cols-2 gap-3"},ue={key:0,class:"mt-1 text-xs text-rose-600"},pe={class:"grid md:grid-cols-2 gap-3"},me=["value"],ge={key:0,class:"mt-1 text-xs text-rose-600"},ye={class:"flex justify-end gap-2 pt-2"},ve=["disabled"],ke={__name:"Employees",setup(xe){v.defaults.withCredentials=!0;const C=i(!1),f=i(!1),U=i([]),V=i([]),w=i(""),c=i("all"),k=i("all"),g=i(!1),r=i({name:"",email:"",password:"",password_confirmation:"",role:"employee",company_id:""}),d=i({}),S=D(()=>{let a=[...U.value];if(w.value.trim()){const t=w.value.toLowerCase();a=a.filter(l=>{var p,y;return((p=l.name)==null?void 0:p.toLowerCase().includes(t))||((y=l.email)==null?void 0:y.toLowerCase().includes(t))})}return c.value!=="all"&&(a=a.filter(t=>{var l,p;return(((p=(l=t.roles)==null?void 0:l[0])==null?void 0:p.name)??"employee")===c.value})),k.value!=="all"&&(a=a.filter(t=>{var l;return String((l=t.company)==null?void 0:l.id)===String(k.value)})),a}),q=a=>a==="manager"?"bg-indigo-100 text-indigo-700 ring-1 ring-indigo-200":"bg-emerald-100 text-emerald-700 ring-1 ring-emerald-200",B=async()=>{const{data:a}=await v.get("/api/companies");V.value=a},E=async()=>{C.value=!0;try{const{data:a}=await v.get("/api/employees");U.value=a}finally{C.value=!1}},N=()=>{r.value={name:"",email:"",password:"",password_confirmation:"",role:"employee",company_id:""},d.value={}},z=async()=>{var a;d.value={},f.value=!0;try{await v.get("/sanctum/csrf-cookie"),await v.post("/api/employees",r.value),g.value=!1,N(),await E()}catch(t){((a=t.response)==null?void 0:a.status)===422?d.value=t.response.data.errors??{}:alert("Не удалось создать сотрудника")}finally{f.value=!1}};return P(async()=>{await Promise.all([B(),E()])}),(a,t)=>(s(),o(x,null,[L(T(Z),{title:"Сотрудники"}),L(H,null,{header:$(()=>[e("div",I,[t[12]||(t[12]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Сотрудники",-1)),e("button",{class:"rounded-xl bg-indigo-600 text-white px-4 py-2 hover:bg-indigo-700",onClick:t[0]||(t[0]=l=>g.value=!0)}," + Сотрудник ")])]),default:$(()=>[e("div",J,[e("div",K,[e("div",null,[u(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>w.value=l),placeholder:"Поиск по имени или email…",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[b,w.value]])]),e("div",null,[u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>c.value=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},t[13]||(t[13]=[e("option",{value:"all"},"Все роли",-1),e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[_,c.value]])]),e("div",null,[u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>k.value=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},[t[14]||(t[14]=e("option",{value:"all"},"Все компании",-1)),(s(!0),o(x,null,h(V.value,l=>(s(),o("option",{key:l.id,value:String(l.id)},n(l.name),9,O))),128))],512),[[_,k.value]])])]),e("div",Q,[e("table",R,[t[17]||(t[17]=e("thead",{class:"bg-gray-50 dark:bg-gray-800"},[e("tr",null,[e("th",{class:"text-left px-4 py-3"},"Имя"),e("th",{class:"text-left px-4 py-3"},"Email"),e("th",{class:"text-left px-4 py-3"},"Компания"),e("th",{class:"text-left px-4 py-3"},"Роль")])],-1)),C.value?(s(),o("tbody",W,[(s(),o(x,null,h(5,l=>e("tr",{key:l,class:"animate-pulse"},t[15]||(t[15]=[e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-56 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-5 w-20 bg-gray-200 dark:bg-gray-700 rounded-full"})],-1)]))),64))])):(s(),o("tbody",X,[(s(!0),o(x,null,h(S.value,l=>{var p,y,F,M,j;return s(),o("tr",{key:l.id,class:"border-t dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/60"},[e("td",Y,n(l.name),1),e("td",ee,n(l.email),1),e("td",te,n(((p=l.company)==null?void 0:p.name)??"—"),1),e("td",le,[e("span",{class:G(["inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ring-1",q(((F=(y=l.roles)==null?void 0:y[0])==null?void 0:F.name)??"employee")])},n(((j=(M=l.roles)==null?void 0:M[0])==null?void 0:j.name)==="manager"?"Менеджер":"Сотрудник"),3)])])}),128)),S.value.length?m("",!0):(s(),o("tr",ae,t[16]||(t[16]=[e("td",{colspan:"4",class:"px-4 py-6 text-center text-gray-500 dark:text-gray-400"}," Ничего не найдено ",-1)])))]))])])]),g.value?(s(),o("div",se,[e("div",oe,[e("div",re,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Новый сотрудник",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:t[4]||(t[4]=l=>g.value=!1)},"✕")]),e("form",{class:"mt-4 space-y-4",onSubmit:A(z,["prevent"])},[e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm mb-1"},"Имя",-1)),u(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>r.value.name=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[b,r.value.name]]),d.value.name?(s(),o("p",de,n(d.value.name[0]),1)):m("",!0)]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm mb-1"},"Email",-1)),u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>r.value.email=l),type:"email",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[b,r.value.email]]),d.value.email?(s(),o("p",ne,n(d.value.email[0]),1)):m("",!0)]),e("div",ie,[e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm mb-1"},"Пароль",-1)),u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>r.value.password=l),type:"password",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[b,r.value.password]]),d.value.password?(s(),o("p",ue,n(d.value.password[0]),1)):m("",!0)]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm mb-1"},"Подтверждение",-1)),u(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>r.value.password_confirmation=l),type:"password",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[b,r.value.password_confirmation]])])]),e("div",pe,[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm mb-1"},"Компания",-1)),u(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>r.value.company_id=l),required:"",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},[t[23]||(t[23]=e("option",{disabled:"",value:""},"Выберите компанию",-1)),(s(!0),o(x,null,h(V.value,l=>(s(),o("option",{key:l.id,value:l.id},n(l.name),9,me))),128))],512),[[_,r.value.company_id]]),d.value.company_id?(s(),o("p",ge,n(d.value.company_id[0]),1)):m("",!0)]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm mb-1"},"Роль",-1)),u(e("select",{"onUpdate:modelValue":t[10]||(t[10]=l=>r.value.role=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},t[25]||(t[25]=[e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[_,r.value.role]])])]),e("div",ye,[e("button",{type:"button",class:"rounded-lg bg-gray-500 px-4 py-2 text-white",onClick:t[11]||(t[11]=l=>g.value=!1)},"Отмена"),e("button",{type:"submit",class:"rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-50",disabled:f.value},n(f.value?"Создаю…":"Создать"),9,ve)])],32)])])):m("",!0)]),_:1})],64))}};export{ke as default};
