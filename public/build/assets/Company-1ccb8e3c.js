import{Q as T,r as n,m as z,q as Z,o as l,f as o,a as D,u as G,w as E,F as _,i as y,Z as H,b as e,t as u,g as c,x as C,j as $,k as I,s as J}from"./app-435657a6.js";import{_ as P}from"./AuthenticatedLayout-2b6f7581.js";import"./ApplicationLogo-b1afa860.js";import"./_plugin-vue_export-helper-c27b6911.js";const R={class:"flex items-center justify-between"},W={class:"text-xl font-bold text-gray-800 dark:text-gray-200"},X={class:"flex gap-2"},Y={class:"max-w-6xl mx-auto py-8 px-4"},ee={class:"bg-white dark:bg-gray-800 rounded-lg border p-4"},te={key:0,class:"text-gray-500"},se={key:1,class:"overflow-x-auto"},ae={class:"min-w-full text-sm"},le={class:"py-2 pr-4 text-gray-900 dark:text-white"},oe={class:"py-2 pr-4 text-gray-700 dark:text-gray-300"},ne={class:"py-2 pr-4"},re={key:0,class:"px-2 py-1 rounded text-xs bg-green-100 text-green-700"},de={key:1,class:"px-2 py-1 rounded text-xs bg-purple-100 text-purple-700"},ie={class:"py-2 pr-4 text-gray-700 dark:text-gray-300"},ue={class:"py-2 pr-0 flex gap-2"},ce=["onClick"],pe=["onClick"],ye={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},ge={class:"bg-white dark:bg-gray-800 rounded p-6 w-full max-w-lg"},xe={class:"space-y-2 max-h-64 overflow-y-auto border rounded p-2"},ve=["value"],me={class:"text-gray-800 dark:text-gray-200"},be={class:"flex justify-end gap-2 mt-4"},he={key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},_e={class:"bg-white dark:bg-gray-800 rounded p-6 w-full max-w-lg"},fe={class:"mb-3"},we={key:0,class:"mb-3"},ke={class:"space-y-2 max-h-48 overflow-y-auto border rounded p-2"},Ce=["value"],$e={class:"text-gray-800 dark:text-gray-200"},Ue={class:"mb-3"},Me={class:"flex justify-end gap-2"},De={__name:"Company",setup(je){const{props:U}=T(),g=U.id,M=U.auth,r=n(null),f=n([]),x=n(!1),j=n([]),v=n([]),m=n(!1),d=n("company_all"),F=n([]),b=n([]),p=n(null),w=z(()=>{var s;return((s=r.value)==null?void 0:s.user_id)===M.user.id}),k=z(()=>{if(!r.value)return!1;const s=(r.value.storage_managers||[]).map(t=>t.id);return w.value||s.includes(M.user.id)}),h=async()=>{const{data:s}=await y.get(`/api/storage/companies/${g}`);r.value=s.company,f.value=s.files},V=async()=>{const{data:s}=await y.get(`/api/companies/${g}/employees`);j.value=s,F.value=s},N=async()=>{w.value&&(await V(),v.value=(r.value.storage_managers||[]).map(s=>s.id),x.value=!0)},A=async()=>{await y.post(`/api/storage/companies/${g}/managers`,{user_ids:v.value}),x.value=!1,await h()},S=s=>{p.value=s.target.files},q=async()=>{k.value&&(await V(),d.value="company_all",b.value=[],p.value=null,m.value=!0)},K=async()=>{const s=new FormData;if(s.append("visibility",d.value),d.value==="selected"&&b.value.forEach(t=>s.append("allowed_user_ids[]",t)),p.value)for(let t=0;t<p.value.length;t++)s.append("files[]",p.value[t]);await y.post(`/api/storage/companies/${g}/files`,s,{headers:{"Content-Type":"multipart/form-data"}}),m.value=!1,await h()},L=s=>{window.location=`/api/storage/files/${s}/download`},O=async s=>{confirm("Удалить файл?")&&(await y.delete(`/api/storage/files/${s}`),await h())};return Z(h),(s,t)=>{var B;return l(),o(_,null,[D(G(H),{title:(B=r.value)!=null&&B.name?`Хранилище: ${r.value.name}`:"Хранилище"},null,8,["title"]),D(P,null,{header:E(()=>{var a;return[e("div",R,[e("h2",W," Хранилище: "+u(((a=r.value)==null?void 0:a.name)??"..."),1),e("div",X,[w.value?(l(),o("button",{key:0,onClick:N,class:"px-3 py-2 rounded bg-amber-600 text-white hover:bg-amber-700"}," Назначить менеджеров ")):c("",!0),k.value?(l(),o("button",{key:1,onClick:q,class:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"}," Добавить файлы ")):c("",!0)])])]}),default:E(()=>[e("div",Y,[e("div",ee,[t[6]||(t[6]=e("h3",{class:"font-semibold text-gray-900 dark:text-white mb-3"},"Файлы",-1)),f.value.length?(l(),o("div",se,[e("table",ae,[t[5]||(t[5]=e("thead",null,[e("tr",{class:"text-left text-gray-500 border-b"},[e("th",{class:"py-2 pr-4"},"Имя"),e("th",{class:"py-2 pr-4"},"Размер"),e("th",{class:"py-2 pr-4"},"Доступ"),e("th",{class:"py-2 pr-4"},"Загрузил"),e("th",{class:"py-2 pr-4"})])],-1)),e("tbody",null,[(l(!0),o(_,null,C(f.value,a=>{var i;return l(),o("tr",{key:a.id,class:"border-b last:border-0"},[e("td",le,u(a.original_name),1),e("td",oe,u((a.size/1024).toFixed(1))+" KB",1),e("td",ne,[a.visibility==="company_all"?(l(),o("span",re," Все сотрудники ")):(l(),o("span",de," Выбранные пользователи "))]),e("td",ie,u(((i=a.uploader)==null?void 0:i.name)??"—"),1),e("td",ue,[e("button",{onClick:Q=>L(a.id),class:"px-3 py-1 rounded bg-indigo-600 text-white text-xs hover:bg-indigo-700"}," Скачать ",8,ce),k.value?(l(),o("button",{key:0,onClick:Q=>O(a.id),class:"px-3 py-1 rounded bg-red-600 text-white text-xs hover:bg-red-700"}," Удалить ",8,pe)):c("",!0)])])}),128))])])])):(l(),o("div",te,"Файлов пока нет"))])]),x.value?(l(),o("div",ye,[e("div",ge,[t[7]||(t[7]=e("h3",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-white"},"Менеджеры хранилища",-1)),t[8]||(t[8]=e("p",{class:"text-sm text-gray-500 mb-3"},"Могут загружать/удалять файлы и видеть раздел.",-1)),e("div",xe,[(l(!0),o(_,null,C(j.value,a=>(l(),o("label",{key:a.id,class:"flex items-center gap-2"},[$(e("input",{type:"checkbox",value:a.id,"onUpdate:modelValue":t[0]||(t[0]=i=>v.value=i)},null,8,ve),[[I,v.value]]),e("span",me,u(a.name),1)]))),128))]),e("div",be,[e("button",{onClick:t[1]||(t[1]=a=>x.value=!1),class:"px-4 py-2 rounded bg-gray-500 text-white"},"Отмена"),e("button",{onClick:A,class:"px-4 py-2 rounded bg-amber-600 text-white hover:bg-amber-700"},"Сохранить")])])])):c("",!0),m.value?(l(),o("div",he,[e("div",_e,[t[12]||(t[12]=e("h3",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-white"},"Добавить файлы",-1)),e("div",fe,[t[10]||(t[10]=e("label",{class:"block text-sm text-gray-700 dark:text-gray-300 mb-1"},"Доступ",-1)),$(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>d.value=a),class:"w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},t[9]||(t[9]=[e("option",{value:"company_all"},"Все сотрудники компании",-1),e("option",{value:"selected"},"Только выбранные пользователи",-1)]),512),[[J,d.value]])]),d.value==="selected"?(l(),o("div",we,[t[11]||(t[11]=e("label",{class:"block text-sm text-gray-700 dark:text-gray-300 mb-1"},"Кому",-1)),e("div",ke,[(l(!0),o(_,null,C(F.value,a=>(l(),o("label",{key:a.id,class:"flex items-center gap-2"},[$(e("input",{type:"checkbox",value:a.id,"onUpdate:modelValue":t[3]||(t[3]=i=>b.value=i)},null,8,Ce),[[I,b.value]]),e("span",$e,u(a.name),1)]))),128))])])):c("",!0),e("div",Ue,[e("input",{type:"file",multiple:"",onChange:S,class:"w-full text-sm border rounded px-3 py-2 bg-white dark:bg-gray-700 dark:text-white"},null,32)]),e("div",Me,[e("button",{onClick:t[4]||(t[4]=a=>m.value=!1),class:"px-4 py-2 rounded bg-gray-500 text-white"},"Отмена"),e("button",{onClick:K,class:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"},"Загрузить")])])])):c("",!0)]),_:1})],64)}}};export{De as default};
