import{K as R,h as m,i as _,o as l,I as q,M as B,b as a,k as F,f as x,w as p,P as k,u as o,a as i,d as v,t as n,F as y,g as c,v as U,H as N,l as S,j as b}from"./app-9a2dd688.js";import{_ as T}from"./AuthenticatedLayout-57faf720.js";import"./ApplicationLogo-f81164ff.js";import"./_plugin-vue_export-helper-c27b6911.js";const D={class:"max-w-4xl mx-auto p-6 bg-white rounded shadow"},L={class:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg border"},z={class:"col-span-1 md:col-span-2"},A=["value"],E={key:0},H=["value"],K={key:1},P=["value"],G={key:2},J=["value"],O={key:0},Q={class:"grid grid-cols-1 gap-4"},W={key:0,class:"text-red-500 text-sm mt-1"},X={class:"mt-4"},Y=["value"],Z={key:0,class:"text-xs text-blue-600 mt-1"},I={class:"mt-6"},tt={key:0,class:"text-gray-500 text-sm"},st={key:1,class:"border border-gray-300 rounded-lg p-4 max-h-60 overflow-y-auto bg-gray-50"},et={key:0,class:"text-gray-500 text-center"},at={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},ot=["value"],lt={class:"text-sm"},it={class:"font-medium text-gray-800"},rt={class:"text-gray-500 text-xs"},dt={class:"flex justify-between mt-2 text-sm text-gray-500"},nt={key:2,class:"text-red-500 text-sm mt-1"},ut={class:"mt-6"},pt={class:"mt-8"},ct=["disabled"],bt={key:0},mt={key:1},vt={key:1,class:"text-center py-10 text-gray-400 bg-gray-50 rounded border border-dashed"},xt={__name:"Create",props:{available_companies:Array},setup(C){const s=R({company_id:"",project_id:"",task_id:"",subtask_id:"",title:"",start_time:"",responsible_id:"",agenda:"",participants:[]}),f=m([]),w=m([]),g=m([]),h=m([]),d=m([]),j=m(!1);_(()=>s.company_id,async r=>{if($(["project","task","subtask","users"]),!!r){j.value=!0;try{const t=await b.get(`/api/companies/${r}/users`);h.value=t.data,d.value=t.data;const e=await b.get(`/api/companies/${r}/projects`);f.value=e.data}catch(t){console.error(t)}finally{j.value=!1}}}),_(()=>s.project_id,async r=>{if($(["task","subtask"]),!!r)try{const t=await b.get(`/api/projects/${r}/tasks`);w.value=t.data}catch(t){console.error(t)}}),_(()=>s.task_id,async r=>{if(s.subtask_id="",g.value=[],!r){d.value=h.value;return}try{const t=await b.get(`/api/tasks/${r}/subtasks`);g.value=t.data;const e=await b.get(`/api/tasks/${r}/users`);d.value=e.data;const u=d.value.map(V=>V.id);s.participants=s.participants.filter(V=>u.includes(V))}catch(t){console.error(t)}}),_(()=>s.subtask_id,async r=>{if(!r&&s.task_id){const t=await b.get(`/api/tasks/${s.task_id}/users`);d.value=t.data;return}if(r)try{const t=await b.get(`/api/subtasks/${r}/users`);d.value=t.data;const e=d.value.map(u=>u.id);s.participants=s.participants.filter(u=>e.includes(u))}catch(t){console.error(t)}});function $(r){r.includes("project")&&(s.project_id="",f.value=[]),r.includes("task")&&(s.task_id="",w.value=[]),r.includes("subtask")&&(s.subtask_id="",g.value=[]),r.includes("users")&&(h.value=[],d.value=[],s.participants=[],s.responsible_id="")}const M=()=>{s.post(route("meetings.store"))};return(r,t)=>(l(),q(T,null,{default:B(()=>[a("div",D,[t[24]||(t[24]=a("h1",{class:"text-2xl font-bold mb-6 text-gray-800"},"Создать совещание",-1)),a("form",{onSubmit:F(M,["prevent"]),class:"space-y-6"},[a("div",L,[a("div",z,[t[11]||(t[11]=a("label",{class:"block font-semibold text-gray-700 mb-1"},[x("Компания "),a("span",{class:"text-red-500"},"*")],-1)),p(a("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>o(s).company_id=e),class:"w-full border-gray-300 rounded shadow-sm focus:ring-blue-500",required:""},[t[10]||(t[10]=a("option",{value:"",disabled:""},"Выберите компанию",-1)),(l(!0),i(y,null,v(C.available_companies,e=>(l(),i("option",{key:e.id,value:e.id},n(e.name),9,A))),128))],512),[[k,o(s).company_id]])]),o(s).company_id?(l(),i("div",E,[t[13]||(t[13]=a("label",{class:"block font-semibold text-gray-700 mb-1"},"выбор задачи если нужно",-1)),p(a("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o(s).project_id=e),class:"w-full border-gray-300 rounded shadow-sm"},[t[12]||(t[12]=a("option",{value:""},"-- Без проекта --",-1)),(l(!0),i(y,null,v(f.value,e=>(l(),i("option",{key:e.id,value:e.id},n(e.name),9,H))),128))],512),[[k,o(s).project_id]])])):c("",!0),o(s).project_id?(l(),i("div",K,[t[15]||(t[15]=a("label",{class:"block font-semibold text-gray-700 mb-1"},"Задача",-1)),p(a("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>o(s).task_id=e),class:"w-full border-gray-300 rounded shadow-sm"},[t[14]||(t[14]=a("option",{value:""},"-- Без задачи --",-1)),(l(!0),i(y,null,v(w.value,e=>(l(),i("option",{key:e.id,value:e.id},n(e.title)+" ("+n(e.status)+")",9,P))),128))],512),[[k,o(s).task_id]])])):c("",!0),o(s).task_id&&g.value.length>0?(l(),i("div",G,[t[17]||(t[17]=a("label",{class:"block font-semibold text-gray-700 mb-1"},"Подзадача",-1)),p(a("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>o(s).subtask_id=e),class:"w-full border-gray-300 rounded shadow-sm"},[t[16]||(t[16]=a("option",{value:""},"-- без участников подзадачи --",-1)),(l(!0),i(y,null,v(g.value,e=>(l(),i("option",{key:e.id,value:e.id},n(e.title),9,J))),128))],512),[[k,o(s).subtask_id]])])):c("",!0)]),o(s).company_id?(l(),i("div",O,[a("div",Q,[a("div",null,[t[18]||(t[18]=a("label",{class:"block font-semibold text-gray-700 mb-1"},[x("Тема совещания "),a("span",{class:"text-red-500"},"*")],-1)),p(a("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>o(s).title=e),type:"text",class:"w-full border-gray-300 rounded shadow-sm",required:"",placeholder:"Например: Обсуждение спринта"},null,512),[[U,o(s).title]]),o(s).errors.title?(l(),i("div",W,n(o(s).errors.title),1)):c("",!0)]),a("div",null,[t[19]||(t[19]=a("label",{class:"block font-semibold text-gray-700 mb-1"},[x("Дата и время "),a("span",{class:"text-red-500"},"*")],-1)),p(a("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>o(s).start_time=e),type:"datetime-local",class:"w-full border-gray-300 rounded shadow-sm",required:""},null,512),[[U,o(s).start_time]])])]),a("div",X,[t[21]||(t[21]=a("label",{class:"block font-semibold text-gray-700 mb-1"},[x("Ответственный (Секретарь) "),a("span",{class:"text-red-500"},"*")],-1)),p(a("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>o(s).responsible_id=e),class:"w-full border-gray-300 rounded shadow-sm",required:""},[t[20]||(t[20]=a("option",{value:"",disabled:""},"Выберите ответственного",-1)),(l(!0),i(y,null,v(d.value,e=>(l(),i("option",{key:e.id,value:e.id},n(e.name),9,Y))),128))],512),[[k,o(s).responsible_id]]),o(s).task_id?(l(),i("p",Z," ℹ️ Список ограничен участниками выбранной задачи. ")):c("",!0)]),a("div",I,[t[22]||(t[22]=a("label",{class:"block font-semibold text-gray-700 mb-2"},"Участники",-1)),j.value?(l(),i("div",tt,"Загрузка списка...")):(l(),i("div",st,[d.value.length===0?(l(),i("div",et," Нет доступных сотрудников ")):c("",!0),a("div",at,[(l(!0),i(y,null,v(d.value,e=>(l(),i("label",{key:e.id,class:N(["flex items-center space-x-3 p-2 hover:bg-white rounded cursor-pointer transition select-none",{"bg-blue-50 border-blue-200 border":o(s).participants.includes(e.id)}])},[p(a("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[7]||(t[7]=u=>o(s).participants=u),class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},null,8,ot),[[S,o(s).participants]]),a("div",lt,[a("div",it,n(e.name),1),a("div",rt,n(e.email),1)])],2))),128))])])),a("div",dt,[a("span",null,"Выбрано: "+n(o(s).participants.length),1),a("button",{type:"button",onClick:t[8]||(t[8]=e=>o(s).participants=d.value.map(u=>u.id)),class:"text-blue-600 hover:underline"}," Выбрать всех ")]),o(s).errors.participants?(l(),i("div",nt,n(o(s).errors.participants),1)):c("",!0)]),a("div",ut,[t[23]||(t[23]=a("label",{class:"block font-semibold text-gray-700 mb-1"},"Повестка дня",-1)),p(a("textarea",{"onUpdate:modelValue":t[9]||(t[9]=e=>o(s).agenda=e),class:"w-full border-gray-300 rounded shadow-sm h-24",placeholder:"Краткий план мероприятия..."},null,512),[[U,o(s).agenda]])]),a("div",pt,[a("button",{type:"submit",class:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition disabled:opacity-50 shadow-md",disabled:o(s).processing},[o(s).processing?(l(),i("span",bt,"Отправка...")):(l(),i("span",mt,"Создать совещание"))],8,ct)])])):(l(),i("div",vt," Выберите компанию, чтобы начать заполнение "))],32)])]),_:1}))}};export{xt as default};
