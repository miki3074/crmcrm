import{i as v,Q as te,r as d,m as O,q as le,o as s,f as o,a as Q,u as ae,w as Z,F as x,Z as se,b as e,j as p,v as k,s as b,x as f,t as n,n as oe,g as c,e as re}from"./app-562a7a64.js";import{_ as de}from"./AuthenticatedLayout-df9aad9a.js";import"./ApplicationLogo-71dd096f.js";import"./_plugin-vue_export-helper-c27b6911.js";const ne={class:"flex items-center justify-between"},ie={class:"max-w-6xl mx-auto py-8 px-4"},ue={class:"grid gap-3 md:grid-cols-3 mb-4"},pe=["value"],me={class:"overflow-hidden rounded-2xl border dark:border-gray-700 bg-white dark:bg-gray-900"},ve={class:"w-full text-sm"},ye={key:0},ge={key:1},xe={class:"px-4 py-3 font-medium text-gray-900 dark:text-gray-100"},be={class:"px-4 py-3 text-gray-600 dark:text-gray-300"},ce={class:"px-4 py-3 text-gray-600 dark:text-gray-300"},fe={class:"px-4 py-3"},ke={class:"px-4 py-3 text-right"},we=["onClick"],_e={key:0},he={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50"},Ce={class:"w-full max-w-xl rounded-2xl bg-white p-6 shadow-xl dark:bg-gray-900"},Ue={class:"flex items-center justify-between"},Ve={key:0,class:"mt-1 text-xs text-rose-600"},je={key:0,class:"mt-1 text-xs text-rose-600"},$e={class:"grid md:grid-cols-2 gap-3"},Se={key:0,class:"mt-1 text-xs text-rose-600"},Fe={class:"grid md:grid-cols-2 gap-3"},Le=["value"],Me={key:0,class:"mt-1 text-xs text-rose-600"},Ae={class:"flex justify-end gap-2 pt-2"},Ee=["disabled"],qe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4"},ze={class:"relative w-full max-w-3xl rounded-2xl shadow-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700"},Be={class:"flex items-center justify-between border-b border-slate-200 dark:border-slate-700 px-6 py-4"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4 px-6 py-4"},De=["value"],Pe={class:"px-6 pb-4"},Te={class:"mb-3 max-h-64 overflow-auto border border-slate-200 dark:border-slate-700 rounded-xl divide-y divide-slate-100 dark:divide-slate-700"},Oe={key:0,class:"p-4 text-sm text-slate-500"},Qe={class:"font-medium text-slate-800 dark:text-slate-100"},Ze={class:"text-xs text-slate-500"},Ge={class:"flex items-center gap-2"},He=["onClick"],Ie={class:"flex justify-end gap-2 px-6 py-4 border-t border-slate-200 dark:border-slate-700"},Je=["disabled"],Ke={key:2,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},Re={class:"bg-white dark:bg-gray-800 rounded-xl p-6 w-96"},We={class:"text-lg font-semibold mb-4"},Xe=["value"],Ye={class:"flex justify-end gap-2 mt-4"},rt={__name:"Employees",setup(et){v.defaults.withCredentials=!0,te();const L=d(!1),h=d(!1),B=d([]),M=d([]),C=d(""),U=d("all"),V=d("all"),w=d(!1),u=d({name:"",email:"",password:"",password_confirmation:"",role:"employee",company_id:""}),m=d({}),N=O(()=>{let a=[...B.value];if(C.value.trim()){const t=C.value.toLowerCase();a=a.filter(r=>{var l,g;return((l=r.name)==null?void 0:l.toLowerCase().includes(t))||((g=r.email)==null?void 0:g.toLowerCase().includes(t))})}return U.value!=="all"&&(a=a.filter(t=>{var r,l;return(((l=(r=t.roles)==null?void 0:r[0])==null?void 0:l.name)??"employee")===U.value})),V.value!=="all"&&(a=a.filter(t=>{var r;return String((r=t.company)==null?void 0:r.id)===String(V.value)})),a}),G=a=>a==="manager"?"bg-indigo-100 text-indigo-700 ring-1 ring-indigo-200":"bg-emerald-100 text-emerald-700 ring-1 ring-emerald-200",H=async()=>{const{data:a}=await v.get("/api/companies");M.value=a},A=async()=>{L.value=!0;try{const{data:a}=await v.get("/api/employees");B.value=a}finally{L.value=!1}},I=()=>{u.value={name:"",email:"",password:"",password_confirmation:"",role:"employee",company_id:""},m.value={}},J=async()=>{var a;m.value={},h.value=!0;try{await v.get("/sanctum/csrf-cookie"),await v.post("/api/employees",u.value),w.value=!1,I(),await A()}catch(t){((a=t.response)==null?void 0:a.status)===422?m.value=t.response.data.errors??{}:alert("Не удалось создать сотрудника")}finally{h.value=!1}},_=d(!1),E=d([]),q=d([]),i=d({user_id:"",role:"employee",company_id:""}),z=d(!1),j=d(!1),$=d(""),K=async()=>{z.value=!0;try{const{data:a}=await v.get("/api/users/for-attach");E.value=a}finally{z.value=!1}},D=async()=>{const{data:a}=await v.get("/api/companies");q.value=a,a.length&&!i.value.company_id&&(i.value.company_id=String(a[0].id))},R=async()=>{_.value=!0,await Promise.all([K(),D()])},W=O(()=>{if(!$.value)return E.value;const a=$.value.toLowerCase();return E.value.filter(t=>(t.name||"").toLowerCase().includes(a)||(t.email||"").toLowerCase().includes(a))}),X=async()=>{var a,t;if(!(!i.value.user_id||!i.value.company_id||!i.value.role)){j.value=!0;try{const{data:r}=await v.post("/api/employees/attach",{user_id:i.value.user_id,company_id:i.value.company_id,role:i.value.role});_.value=!1,i.value={user_id:"",role:"employee",company_id:i.value.company_id},alert("Пользователь добавлен")}catch(r){console.error(r),alert(((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||"Ошибка")}finally{j.value=!1}}},S=d(!1),F=d(null),y=d({company_id:"",role:"employee"}),Y=async()=>{var a,t,r;if(!((a=F.value)!=null&&a.id)||!y.value.company_id){alert("Выберите компанию");return}try{await v.post("/api/employees/attach",{user_id:F.value.id,company_id:y.value.company_id,role:y.value.role}),alert("Пользователь присоединён"),S.value=!1,await A()}catch(l){console.error(l),alert(((r=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:r.message)||"Ошибка")}},ee=async a=>{F.value=a,y.value={company_id:"",role:"employee"},S.value=!0,await D()};return le(async()=>{await Promise.all([H(),A()])}),(a,t)=>(s(),o(x,null,[Q(ae(se),{title:"Сотрудники"}),Q(de,null,{header:Z(()=>[e("div",ne,[t[20]||(t[20]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Сотрудники",-1)),e("button",{class:"rounded-xl bg-indigo-600 text-white px-4 py-2 hover:bg-indigo-700",onClick:t[0]||(t[0]=r=>w.value=!0)}," + Сотрудник "),e("button",{class:"ms-3 rounded-xl bg-green-600 text-white px-4 py-2 hover:bg-green-700",onClick:R}," Сотрудники 2 ")])]),default:Z(()=>{var r;return[e("div",ie,[e("div",ue,[e("div",null,[p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>C.value=l),placeholder:"Поиск по имени или email…",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[k,C.value]])]),e("div",null,[p(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>U.value=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},t[21]||(t[21]=[e("option",{value:"all"},"Все роли",-1),e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[b,U.value]])]),e("div",null,[p(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>V.value=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},[t[22]||(t[22]=e("option",{value:"all"},"Все компании",-1)),(s(!0),o(x,null,f(M.value,l=>(s(),o("option",{key:l.id,value:String(l.id)},n(l.name),9,pe))),128))],512),[[b,V.value]])])]),e("div",me,[e("table",ve,[t[25]||(t[25]=e("thead",{class:"bg-gray-50 dark:bg-gray-800"},[e("tr",null,[e("th",{class:"text-left px-4 py-3"},"Имя"),e("th",{class:"text-left px-4 py-3"},"Email"),e("th",{class:"text-left px-4 py-3"},"Компания"),e("th",{class:"text-left px-4 py-3"},"Роль")])],-1)),L.value?(s(),o("tbody",ye,[(s(),o(x,null,f(5,l=>e("tr",{key:l,class:"animate-pulse"},t[23]||(t[23]=[e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-56 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-5 w-20 bg-gray-200 dark:bg-gray-700 rounded-full"})],-1)]))),64))])):(s(),o("tbody",ge,[(s(!0),o(x,null,f(N.value,l=>{var g,P,T;return s(),o("tr",{key:l.id,class:"border-t dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/60"},[e("td",xe,n(l.name),1),e("td",be,n(l.email),1),e("td",ce,n(((g=l.company)==null?void 0:g.name)??"—"),1),e("td",fe,[e("span",{class:oe(["inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ring-1",G(((T=(P=l.roles)==null?void 0:P[0])==null?void 0:T.name)??"employee")])},n(l.role==="manager"?"Менеджер":"Сотрудник"),3)]),e("td",ke,[e("button",{onClick:tt=>ee(l),class:"text-xs rounded bg-indigo-600 text-white px-3 py-1 hover:bg-indigo-700"}," Присоединить к компании ",8,we)])])}),128)),N.value.length?c("",!0):(s(),o("tr",_e,t[24]||(t[24]=[e("td",{colspan:"4",class:"px-4 py-6 text-center text-gray-500 dark:text-gray-400"}," Ничего не найдено ",-1)])))]))])])]),w.value?(s(),o("div",he,[e("div",Ce,[e("div",Ue,[t[26]||(t[26]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Новый сотрудник",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:t[4]||(t[4]=l=>w.value=!1)},"✕")]),e("form",{class:"mt-4 space-y-4",onSubmit:re(J,["prevent"])},[e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm mb-1"},"Имя",-1)),p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>u.value.name=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[k,u.value.name]]),m.value.name?(s(),o("p",Ve,n(m.value.name[0]),1)):c("",!0)]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm mb-1"},"Email",-1)),p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>u.value.email=l),type:"email",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[k,u.value.email]]),m.value.email?(s(),o("p",je,n(m.value.email[0]),1)):c("",!0)]),e("div",$e,[e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm mb-1"},"Пароль",-1)),p(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>u.value.password=l),type:"password",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[k,u.value.password]]),m.value.password?(s(),o("p",Se,n(m.value.password[0]),1)):c("",!0)]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm mb-1"},"Подтверждение",-1)),p(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>u.value.password_confirmation=l),type:"password",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[k,u.value.password_confirmation]])])]),e("div",Fe,[e("div",null,[t[32]||(t[32]=e("label",{class:"block text-sm mb-1"},"Компания",-1)),p(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>u.value.company_id=l),required:"",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},[t[31]||(t[31]=e("option",{disabled:"",value:""},"Выберите компанию",-1)),(s(!0),o(x,null,f(M.value,l=>(s(),o("option",{key:l.id,value:l.id},n(l.name),9,Le))),128))],512),[[b,u.value.company_id]]),m.value.company_id?(s(),o("p",Me,n(m.value.company_id[0]),1)):c("",!0)]),e("div",null,[t[34]||(t[34]=e("label",{class:"block text-sm mb-1"},"Роль",-1)),p(e("select",{"onUpdate:modelValue":t[10]||(t[10]=l=>u.value.role=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},t[33]||(t[33]=[e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[b,u.value.role]])])]),e("div",Ae,[e("button",{type:"button",class:"rounded-lg bg-gray-500 px-4 py-2 text-white",onClick:t[11]||(t[11]=l=>w.value=!1)},"Отмена"),e("button",{type:"submit",class:"rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-50",disabled:h.value},n(h.value?"Создаю…":"Создать"),9,Ee)])],32)])])):c("",!0),_.value?(s(),o("div",qe,[e("div",ze,[e("div",Be,[t[35]||(t[35]=e("h3",{class:"text-lg font-semibold text-slate-800 dark:text-slate-100"}," Добавить зарегистрированного пользователя ",-1)),e("button",{onClick:t[12]||(t[12]=l=>_.value=!1),class:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300"}," ✕ ")]),e("div",Ne,[e("div",null,[t[36]||(t[36]=e("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1"},"Поиск",-1)),p(e("input",{"onUpdate:modelValue":t[13]||(t[13]=l=>$.value=l),class:"w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"Имя или email"},null,512),[[k,$.value]])]),e("div",null,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1"},"Компания",-1)),p(e("select",{"onUpdate:modelValue":t[14]||(t[14]=l=>i.value.company_id=l),class:"w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none"},[(s(!0),o(x,null,f(q.value,l=>(s(),o("option",{key:l.id,value:String(l.id)},n(l.name),9,De))),128))],512),[[b,i.value.company_id]])])]),e("div",Pe,[e("div",Te,[z.value?(s(),o("div",Oe,"Загрузка пользователей...")):(s(!0),o(x,{key:1},f(W.value,l=>(s(),o("div",{key:l.id,class:"flex items-center justify-between gap-3 p-3 hover:bg-slate-50 dark:hover:bg-slate-800/40 transition rounded"},[e("div",null,[e("div",Qe,n(l.name),1),e("div",Ze,n(l.email),1)]),e("div",Ge,[t[39]||(t[39]=e("label",{class:"text-xs text-slate-500"},"Роль",-1)),p(e("select",{"onUpdate:modelValue":t[15]||(t[15]=g=>i.value.role=g),class:"rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm px-2 py-1"},t[38]||(t[38]=[e("option",{value:"employee"},"Сотрудник",-1),e("option",{value:"manager"},"Менеджер",-1)]),512),[[b,i.value.role]]),e("button",{onClick:g=>i.value.user_id=l.id,class:"px-3 py-1.5 rounded-lg bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700 transition"}," Выбрать ",8,He)])]))),128))])]),e("div",Ie,[e("button",{onClick:t[16]||(t[16]=l=>_.value=!1),class:"px-4 py-2 rounded-xl bg-slate-200 text-slate-700 dark:bg-slate-700 dark:text-slate-200 hover:opacity-80 transition"}," Отмена "),e("button",{onClick:X,disabled:j.value,class:"px-4 py-2 rounded-xl bg-emerald-600 text-white font-medium hover:bg-emerald-700 disabled:opacity-60 transition"},n(j.value?"Добавление...":"Добавить"),9,Je)])])])):c("",!0),S.value?(s(),o("div",Ke,[e("div",Re,[e("h3",We," Присоединить: "+n((r=F.value)==null?void 0:r.name),1),t[42]||(t[42]=e("label",{class:"block text-sm mb-2"},"Компания",-1)),p(e("select",{"onUpdate:modelValue":t[17]||(t[17]=l=>y.value.company_id=l),class:"w-full border rounded p-2 mb-3"},[t[40]||(t[40]=e("option",{value:""},"-- Выберите компанию --",-1)),(s(!0),o(x,null,f(q.value,l=>(s(),o("option",{key:l.id,value:l.id},n(l.name),9,Xe))),128))],512),[[b,y.value.company_id]]),t[43]||(t[43]=e("label",{class:"block text-sm mb-2"},"Роль",-1)),p(e("select",{"onUpdate:modelValue":t[18]||(t[18]=l=>y.value.role=l),class:"w-full border rounded p-2 mb-3"},t[41]||(t[41]=[e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[b,y.value.role]]),e("div",Ye,[e("button",{onClick:t[19]||(t[19]=l=>S.value=!1),class:"px-3 py-1 text-sm rounded bg-gray-200"},"Отмена"),e("button",{onClick:Y,class:"px-3 py-1 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700"}," Сохранить ")])])])):c("",!0)]}),_:1})],64))}};export{rt as default};
