import{i as y,Q as ne,r as d,m as G,q as ie,o as s,f as o,a as H,u as ue,w as I,F as c,Z as pe,b as e,j as p,v as k,s as g,x as f,t as i,n as me,g as x,e as ve}from"./app-a27f08d6.js";import{_ as ye}from"./AuthenticatedLayout-b8826cc5.js";import"./ApplicationLogo-bd8f87f2.js";import"./_plugin-vue_export-helper-c27b6911.js";const ge={class:"flex items-center justify-between"},xe={class:"max-w-6xl mx-auto py-8 px-4"},be={class:"grid gap-3 md:grid-cols-3 mb-4"},ce=["value"],fe={class:"overflow-hidden rounded-2xl border dark:border-gray-700 bg-white dark:bg-gray-900"},ke={class:"w-full text-sm"},we={key:0},_e={key:1},he={class:"px-4 py-3 font-medium text-gray-900 dark:text-gray-100"},Ce={class:"px-4 py-3 text-gray-600 dark:text-gray-300"},Ue={class:"px-4 py-3 text-gray-600 dark:text-gray-300"},Ve={class:"px-4 py-3"},je={class:"px-4 py-3 text-right flex gap-2 justify-end"},$e=["onClick"],Me=["onClick"],Ee={key:0},Fe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50"},Se={class:"w-full max-w-xl rounded-2xl bg-white p-6 shadow-xl dark:bg-gray-900"},Le={class:"flex items-center justify-between"},Ae={key:0,class:"mt-1 text-xs text-rose-600"},qe={key:0,class:"mt-1 text-xs text-rose-600"},ze={class:"grid md:grid-cols-2 gap-3"},Be={key:0,class:"mt-1 text-xs text-rose-600"},Ne={class:"grid md:grid-cols-2 gap-3"},De=["value"],Pe={key:0,class:"mt-1 text-xs text-rose-600"},Te={class:"flex justify-end gap-2 pt-2"},Oe=["disabled"],Qe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4"},Re={class:"relative w-full max-w-3xl rounded-2xl shadow-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700"},Ze={class:"flex items-center justify-between border-b border-slate-200 dark:border-slate-700 px-6 py-4"},Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4 px-6 py-4"},He=["value"],Ie={class:"px-6 pb-4"},Je={class:"mb-3 max-h-64 overflow-auto border border-slate-200 dark:border-slate-700 rounded-xl divide-y divide-slate-100 dark:divide-slate-700"},Ke={key:0,class:"p-4 text-sm text-slate-500"},We={class:"font-medium text-slate-800 dark:text-slate-100"},Xe={class:"text-xs text-slate-500"},Ye={class:"flex items-center gap-2"},et=["onClick"],tt={class:"flex justify-end gap-2 px-6 py-4 border-t border-slate-200 dark:border-slate-700"},lt=["disabled"],at={key:2,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},st={class:"bg-white dark:bg-gray-800 rounded-xl p-6 w-96"},ot={class:"text-lg font-semibold mb-4"},rt=["value"],dt={class:"flex justify-end gap-2 mt-4"},nt={key:3,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},it={class:"bg-white dark:bg-gray-800 rounded-xl p-6 w-96"},ut={class:"text-lg font-semibold mb-4"},pt={class:"flex justify-end gap-2 mt-4"},bt={__name:"Employees",setup(mt){y.defaults.withCredentials=!0,ne();const z=d(!1),C=d(!1),T=d([]),B=d([]),U=d(""),V=d("all"),j=d("all"),w=d(!1),m=d({name:"",email:"",password:"",password_confirmation:"",role:"employee",company_id:""}),v=d({}),O=G(()=>{let a=[...T.value];if(U.value.trim()){const t=U.value.toLowerCase();a=a.filter(r=>{var n,l;return((n=r.name)==null?void 0:n.toLowerCase().includes(t))||((l=r.email)==null?void 0:l.toLowerCase().includes(t))})}return V.value!=="all"&&(a=a.filter(t=>{var r,n;return(((n=(r=t.roles)==null?void 0:r[0])==null?void 0:n.name)??"employee")===V.value})),j.value!=="all"&&(a=a.filter(t=>{var r;return String((r=t.company)==null?void 0:r.id)===String(j.value)})),a}),J=a=>a==="manager"?"bg-indigo-100 text-indigo-700 ring-1 ring-indigo-200":"bg-emerald-100 text-emerald-700 ring-1 ring-emerald-200",K=async()=>{const{data:a}=await y.get("/api/companies");B.value=a},$=async()=>{z.value=!0;try{const{data:a}=await y.get("/api/employees");T.value=a}finally{z.value=!1}},W=()=>{m.value={name:"",email:"",password:"",password_confirmation:"",role:"employee",company_id:""},v.value={}},X=async()=>{var a;v.value={},C.value=!0;try{await y.get("/sanctum/csrf-cookie"),await y.post("/api/employees",m.value),w.value=!1,W(),await $()}catch(t){((a=t.response)==null?void 0:a.status)===422?v.value=t.response.data.errors??{}:alert("Не удалось создать сотрудника")}finally{C.value=!1}},_=d(!1),N=d([]),D=d([]),u=d({user_id:"",role:"employee",company_id:""}),P=d(!1),M=d(!1),E=d(""),Y=async()=>{P.value=!0;try{const{data:a}=await y.get("/api/users/for-attach");N.value=a}finally{P.value=!1}},Q=async()=>{const{data:a}=await y.get("/api/owner-companies");D.value=a,a.length&&!u.value.company_id&&(u.value.company_id=String(a[0].id))},ee=async()=>{_.value=!0,await Promise.all([Y(),Q()])},te=G(()=>{if(!E.value)return N.value;const a=E.value.toLowerCase();return N.value.filter(t=>(t.name||"").toLowerCase().includes(a)||(t.email||"").toLowerCase().includes(a))}),le=async()=>{var a,t;if(!(!u.value.user_id||!u.value.company_id||!u.value.role)){M.value=!0;try{const{data:r}=await y.post("/api/employees/attach",{user_id:u.value.user_id,company_id:u.value.company_id,role:u.value.role});_.value=!1,u.value={user_id:"",role:"employee",company_id:u.value.company_id},alert("Пользователь добавлен")}catch(r){console.error(r),alert(((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||"Ошибка")}finally{M.value=!1}}},F=d(!1),S=d(null),b=d({company_id:"",role:"employee"}),ae=async()=>{var a,t,r;if(!((a=S.value)!=null&&a.id)||!b.value.company_id){alert("Выберите компанию");return}try{await y.post("/api/employees/attach",{user_id:S.value.id,company_id:b.value.company_id,role:b.value.role}),alert("Пользователь присоединён"),F.value=!1,await $()}catch(n){console.error(n),alert(((r=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:r.message)||"Ошибка")}},se=async a=>{S.value=a,b.value={company_id:"",role:"employee"},F.value=!0,await Q()},L=d(!1),A=d(null),q=d({role:"employee"}),oe=a=>{A.value=a,q.value={role:a.role||"employee"},L.value=!0},re=async()=>{var a,t,r;if((a=A.value)!=null&&a.id)try{await y.put(`/api/employees/${A.value.id}/update-role`,{role:q.value.role}),alert("Роль обновлена"),L.value=!1,await $()}catch(n){console.error(n),alert(((r=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:r.message)||"Ошибка обновления")}};return ie(async()=>{await Promise.all([K(),$()])}),(a,t)=>(s(),o(c,null,[H(ue(pe),{title:"Сотрудники"}),H(ye,null,{header:I(()=>[e("div",ge,[t[22]||(t[22]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Сотрудники",-1)),e("button",{class:"rounded-xl bg-indigo-600 text-white px-4 py-2 hover:bg-indigo-700",onClick:t[0]||(t[0]=r=>w.value=!0)}," + Сотрудник "),e("button",{class:"ms-3 rounded-xl bg-green-600 text-white px-4 py-2 hover:bg-green-700",onClick:ee}," Пригласить сотрудника ")])]),default:I(()=>{var r,n;return[e("div",xe,[e("div",be,[e("div",null,[p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>U.value=l),placeholder:"Поиск по имени или email…",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[k,U.value]])]),e("div",null,[p(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>V.value=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},t[23]||(t[23]=[e("option",{value:"all"},"Все роли",-1),e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[g,V.value]])]),e("div",null,[p(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>j.value=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},[t[24]||(t[24]=e("option",{value:"all"},"Все компании",-1)),(s(!0),o(c,null,f(B.value,l=>(s(),o("option",{key:l.id,value:String(l.id)},i(l.name),9,ce))),128))],512),[[g,j.value]])])]),e("div",fe,[e("table",ke,[t[27]||(t[27]=e("thead",{class:"bg-gray-50 dark:bg-gray-800"},[e("tr",null,[e("th",{class:"text-left px-4 py-3"},"Имя"),e("th",{class:"text-left px-4 py-3"},"Email"),e("th",{class:"text-left px-4 py-3"},"Компания"),e("th",{class:"text-left px-4 py-3"},"Роль")])],-1)),z.value?(s(),o("tbody",we,[(s(),o(c,null,f(5,l=>e("tr",{key:l,class:"animate-pulse"},t[25]||(t[25]=[e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-56 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-5 w-20 bg-gray-200 dark:bg-gray-700 rounded-full"})],-1)]))),64))])):(s(),o("tbody",_e,[(s(!0),o(c,null,f(O.value,l=>{var h,R,Z;return s(),o("tr",{key:l.id,class:"border-t dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/60"},[e("td",he,i(l.name),1),e("td",Ce,i(l.email),1),e("td",Ue,i(((h=l.company)==null?void 0:h.name)??"—"),1),e("td",Ve,[e("span",{class:me(["inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ring-1",J(((Z=(R=l.roles)==null?void 0:R[0])==null?void 0:Z.name)??"employee")])},i(l.role==="manager"?"Менеджер":"Сотрудник"),3)]),e("td",je,[e("button",{onClick:de=>se(l),class:"text-xs rounded bg-indigo-600 text-white px-3 py-1 hover:bg-indigo-700"}," Присоединить к компании ",8,$e),e("button",{onClick:de=>oe(l),class:"text-xs rounded bg-yellow-500 text-white px-3 py-1 hover:bg-yellow-600"}," Обновить ",8,Me)])])}),128)),O.value.length?x("",!0):(s(),o("tr",Ee,t[26]||(t[26]=[e("td",{colspan:"4",class:"px-4 py-6 text-center text-gray-500 dark:text-gray-400"}," Ничего не найдено ",-1)])))]))])])]),w.value?(s(),o("div",Fe,[e("div",Se,[e("div",Le,[t[28]||(t[28]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Новый сотрудник",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:t[4]||(t[4]=l=>w.value=!1)},"✕")]),e("form",{class:"mt-4 space-y-4",onSubmit:ve(X,["prevent"])},[e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm mb-1"},"Имя",-1)),p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>m.value.name=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[k,m.value.name]]),v.value.name?(s(),o("p",Ae,i(v.value.name[0]),1)):x("",!0)]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm mb-1"},"Email",-1)),p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>m.value.email=l),type:"email",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[k,m.value.email]]),v.value.email?(s(),o("p",qe,i(v.value.email[0]),1)):x("",!0)]),e("div",ze,[e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm mb-1"},"Пароль",-1)),p(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>m.value.password=l),type:"password",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[k,m.value.password]]),v.value.password?(s(),o("p",Be,i(v.value.password[0]),1)):x("",!0)]),e("div",null,[t[32]||(t[32]=e("label",{class:"block text-sm mb-1"},"Подтверждение",-1)),p(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>m.value.password_confirmation=l),type:"password",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[k,m.value.password_confirmation]])])]),e("div",Ne,[e("div",null,[t[34]||(t[34]=e("label",{class:"block text-sm mb-1"},"Компания",-1)),p(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>m.value.company_id=l),required:"",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},[t[33]||(t[33]=e("option",{disabled:"",value:""},"Выберите компанию",-1)),(s(!0),o(c,null,f(B.value,l=>(s(),o("option",{key:l.id,value:l.id},i(l.name),9,De))),128))],512),[[g,m.value.company_id]]),v.value.company_id?(s(),o("p",Pe,i(v.value.company_id[0]),1)):x("",!0)]),e("div",null,[t[36]||(t[36]=e("label",{class:"block text-sm mb-1"},"Роль",-1)),p(e("select",{"onUpdate:modelValue":t[10]||(t[10]=l=>m.value.role=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},t[35]||(t[35]=[e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[g,m.value.role]])])]),e("div",Te,[e("button",{type:"button",class:"rounded-lg bg-gray-500 px-4 py-2 text-white",onClick:t[11]||(t[11]=l=>w.value=!1)},"Отмена"),e("button",{type:"submit",class:"rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-50",disabled:C.value},i(C.value?"Создаю…":"Создать"),9,Oe)])],32)])])):x("",!0),_.value?(s(),o("div",Qe,[e("div",Re,[e("div",Ze,[t[37]||(t[37]=e("h3",{class:"text-lg font-semibold text-slate-800 dark:text-slate-100"}," Добавить зарегистрированного пользователя ",-1)),e("button",{onClick:t[12]||(t[12]=l=>_.value=!1),class:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300"}," ✕ ")]),e("div",Ge,[e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1"},"Поиск",-1)),p(e("input",{"onUpdate:modelValue":t[13]||(t[13]=l=>E.value=l),class:"w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none",placeholder:"Имя или email"},null,512),[[k,E.value]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1"},"Компания",-1)),p(e("select",{"onUpdate:modelValue":t[14]||(t[14]=l=>u.value.company_id=l),class:"w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none"},[(s(!0),o(c,null,f(D.value,l=>(s(),o("option",{key:l.id,value:String(l.id)},i(l.name),9,He))),128))],512),[[g,u.value.company_id]])])]),e("div",Ie,[e("div",Je,[P.value?(s(),o("div",Ke,"Загрузка пользователей...")):(s(!0),o(c,{key:1},f(te.value,l=>(s(),o("div",{key:l.id,class:"flex items-center justify-between gap-3 p-3 hover:bg-slate-50 dark:hover:bg-slate-800/40 transition rounded"},[e("div",null,[e("div",We,i(l.name),1),e("div",Xe,i(l.email),1)]),e("div",Ye,[t[41]||(t[41]=e("label",{class:"text-xs text-slate-500"},"Роль",-1)),p(e("select",{"onUpdate:modelValue":t[15]||(t[15]=h=>u.value.role=h),class:"rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm px-2 py-1"},t[40]||(t[40]=[e("option",{value:"employee"},"Сотрудник",-1),e("option",{value:"manager"},"Менеджер",-1)]),512),[[g,u.value.role]]),e("button",{onClick:h=>u.value.user_id=l.id,class:"px-3 py-1.5 rounded-lg bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700 transition"}," Выбрать ",8,et)])]))),128))])]),e("div",tt,[e("button",{onClick:t[16]||(t[16]=l=>_.value=!1),class:"px-4 py-2 rounded-xl bg-slate-200 text-slate-700 dark:bg-slate-700 dark:text-slate-200 hover:opacity-80 transition"}," Отмена "),e("button",{onClick:le,disabled:M.value,class:"px-4 py-2 rounded-xl bg-emerald-600 text-white font-medium hover:bg-emerald-700 disabled:opacity-60 transition"},i(M.value?"Добавление...":"Добавить"),9,lt)])])])):x("",!0),F.value?(s(),o("div",at,[e("div",st,[e("h3",ot," Присоединить: "+i((r=S.value)==null?void 0:r.name),1),t[44]||(t[44]=e("label",{class:"block text-sm mb-2"},"Компания",-1)),p(e("select",{"onUpdate:modelValue":t[17]||(t[17]=l=>b.value.company_id=l),class:"w-full border rounded p-2 mb-3"},[t[42]||(t[42]=e("option",{value:""},"-- Выберите компанию --",-1)),(s(!0),o(c,null,f(D.value,l=>(s(),o("option",{key:l.id,value:l.id},i(l.name),9,rt))),128))],512),[[g,b.value.company_id]]),t[45]||(t[45]=e("label",{class:"block text-sm mb-2"},"Роль",-1)),p(e("select",{"onUpdate:modelValue":t[18]||(t[18]=l=>b.value.role=l),class:"w-full border rounded p-2 mb-3"},t[43]||(t[43]=[e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[g,b.value.role]]),e("div",dt,[e("button",{onClick:t[19]||(t[19]=l=>F.value=!1),class:"px-3 py-1 text-sm rounded bg-gray-200"},"Отмена"),e("button",{onClick:ae,class:"px-3 py-1 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700"}," Сохранить ")])])])):x("",!0),L.value?(s(),o("div",nt,[e("div",it,[e("h3",ut," Обновить роль: "+i((n=A.value)==null?void 0:n.name),1),t[47]||(t[47]=e("label",{class:"block text-sm mb-2"},"Роль",-1)),p(e("select",{"onUpdate:modelValue":t[20]||(t[20]=l=>q.value.role=l),class:"w-full border rounded p-2 mb-3"},t[46]||(t[46]=[e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[g,q.value.role]]),e("div",pt,[e("button",{onClick:t[21]||(t[21]=l=>L.value=!1),class:"px-3 py-1 text-sm rounded bg-gray-200"},"Отмена"),e("button",{onClick:re,class:"px-3 py-1 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700"}," Сохранить ")])])])):x("",!0)]}),_:1})],64))}};export{bt as default};
