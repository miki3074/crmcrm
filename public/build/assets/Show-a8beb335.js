import{r as v,q as W,I as Ae,o as l,f as o,b as e,F as f,x as w,t as r,g as p,j as h,v as M,i as m,n as N,s as H,k as Ee,d as _,Q as Pe,m as F,z as Qe,a as B,w as Ge,y as Je,e as Me}from"./app-ffc1bf17.js";import{_ as Ke}from"./AuthenticatedLayout-e3422244.js";import"./ApplicationLogo-19c443d0.js";import"./_plugin-vue_export-helper-c27b6911.js";const Re={class:"rounded-2xl border bg-white dark:bg-gray-800 p-5 mt-8"},Xe={class:"space-y-3 max-h-80 overflow-y-auto pr-1"},Ye={class:"flex-1"},Ze={class:"flex items-center gap-2"},et={class:"text-sm font-medium text-gray-900 dark:text-white"},tt={class:"text-xs text-gray-500"},st=["onClick"],at={class:"mt-1 text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap"},lt={key:0,class:"text-sm text-gray-500"},ot={key:0,class:"mt-4"},dt={class:"mt-2 flex justify-end"},it=["disabled"],rt={key:1,class:"mt-3 text-xs text-gray-500"},nt={__name:"TaskChat",props:{taskId:{type:Number,required:!0},canChat:{type:Boolean,default:!0}},setup($){const j=$,x=v([]),g=v("");let k=null;const s=async()=>{const{data:b}=await m.get(`/api/tasks/${j.taskId}/comments`,{withCredentials:!0});x.value=b},C=async()=>{g.value.trim()&&(await m.get("/sanctum/csrf-cookie"),await m.post(`/api/tasks/${j.taskId}/comments`,{body:g.value},{withCredentials:!0}),g.value="",await s())},V=async b=>{await m.delete(`/api/task-comments/${b}`),await s()};return W(async()=>{await s(),k=setInterval(s,1e4)}),Ae(()=>{k&&clearInterval(k)}),(b,c)=>(l(),o("div",Re,[c[1]||(c[1]=e("div",{class:"mb-4 flex items-center justify-between"},[e("h3",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Комментарии")],-1)),e("div",Xe,[(l(!0),o(f,null,w(x.value,i=>{var u;return l(),o("div",{key:i.id,class:"flex gap-3"},[e("div",Ye,[e("div",Ze,[e("div",et,r(((u=i.user)==null?void 0:u.name)??"—"),1),e("div",tt,r(new Date(i.created_at).toLocaleString()),1),b.$page.props.auth.user&&i.user&&i.user.id===b.$page.props.auth.user.id?(l(),o("button",{key:0,class:"ml-auto text-xs text-red-600 hover:underline",onClick:y=>V(i.id)},"Удалить",8,st)):p("",!0)]),e("div",at,r(i.body),1)])])}),128)),x.value.length?p("",!0):(l(),o("div",lt,"Пока нет сообщений."))]),$.canChat?(l(),o("div",ot,[h(e("textarea",{"onUpdate:modelValue":c[0]||(c[0]=i=>g.value=i),rows:"2",placeholder:"Напишите комментарий…",class:"w-full rounded-lg border bg-white/80 dark:bg-gray-700 px-3 py-2 text-sm dark:text-white"},null,512),[[M,g.value]]),e("div",dt,[e("button",{onClick:C,disabled:!g.value.trim(),class:"px-4 py-2 rounded-lg bg-indigo-600 text-white disabled:opacity-40"},"Отправить",8,it)])])):(l(),o("div",rt," У вас нет прав на участие в чате этой задачи. "))]))}},ut={class:"mt-6"},pt={key:0,class:"space-y-2"},vt=["checked","onChange"],gt={key:0,class:"text-sm text-gray-500"},ct={key:1,class:"text-gray-500"},xt={key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center"},mt={class:"bg-white rounded p-6 w-96"},bt=["value"],yt=["value"],kt=["value"],ft={class:"flex items-center gap-2 mb-2"},ht={class:"flex justify-end gap-2"},wt={__name:"TaskChecklists",props:{taskId:{type:Number,required:!0},executors:{type:Array,default:()=>[]},responsibles:{type:Array,default:()=>[]},creator:{type:Object,default:()=>null}},setup($){const j=$,x=v([]),g=v(!1),k=v(!1),s=v({title:"",assigned_to:[],important:!1,files:[]}),C=async()=>{g.value=!0;try{const{data:c}=await m.get(`/api/tasks/${j.taskId}/checklists`);x.value=c}finally{g.value=!1}},V=async()=>{const c=new FormData;c.append("title",s.value.title),s.value.assigned_to&&c.append("assigned_to",s.value.assigned_to),c.append("important",s.value.important?1:0);for(let i of s.value.files)c.append("files[]",i);await m.post(`/api/tasks/${j.taskId}/checklists`,c),k.value=!1,s.value={title:"",assigned_to:"",important:!1,files:[]},await C()},b=async c=>{await m.patch(`/api/checklists/${c.id}/toggle`),await C()};return W(C),(c,i)=>(l(),o("div",ut,[i[10]||(i[10]=e("h3",{class:"text-lg font-semibold mb-2"},"Чек-листы",-1)),x.value.length?(l(),o("ul",pt,[(l(!0),o(f,null,w(x.value,u=>(l(),o("li",{key:u.id,class:"flex items-center gap-2"},[e("input",{type:"checkbox",checked:u.completed,onChange:y=>b(u)},null,40,vt),e("span",{class:N({"font-bold text-red-600":u.important})},r(u.title),3),u.assignee?(l(),o("span",gt,"("+r(u.assignee.name)+")",1)):p("",!0)]))),128))])):(l(),o("p",ct,"Нет чек-листов")),e("button",{class:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded",onClick:i[0]||(i[0]=u=>k.value=!0)}," Добавить чек-лист "),k.value?(l(),o("div",xt,[e("div",mt,[i[8]||(i[8]=e("h4",{class:"text-lg font-semibold mb-4"},"Новый пункт чек-листа",-1)),h(e("input",{"onUpdate:modelValue":i[1]||(i[1]=u=>s.value.title=u),type:"text",placeholder:"Название",class:"w-full border mb-2 p-2"},null,512),[[M,s.value.title]]),i[9]||(i[9]=e("label",{class:"block text-sm"},"Ответственный",-1)),h(e("select",{"onUpdate:modelValue":i[2]||(i[2]=u=>s.value.assigned_to=u),class:"w-full border mb-2 p-2"},[i[6]||(i[6]=e("option",{value:""},"—",-1)),(l(!0),o(f,null,w($.executors,u=>(l(),o("option",{key:"exec-"+u.id,value:u.id},r(u.name),9,bt))),128)),(l(!0),o(f,null,w($.responsibles,u=>(l(),o("option",{key:"resp-"+u.id,value:u.id},r(u.name),9,yt))),128)),$.creator?(l(),o("option",{key:0,value:$.creator.id},r($.creator.name),9,kt)):p("",!0)],512),[[H,s.value.assigned_to]]),e("label",ft,[h(e("input",{type:"checkbox","onUpdate:modelValue":i[3]||(i[3]=u=>s.value.important=u)},null,512),[[Ee,s.value.important]]),i[7]||(i[7]=_(" Важно ",-1))]),e("input",{type:"file",multiple:"",onChange:i[4]||(i[4]=u=>s.value.files=Array.from(u.target.files)),class:"mb-4"},null,32),e("div",ht,[e("button",{onClick:i[5]||(i[5]=u=>k.value=!1),class:"px-3 py-1 border"},"Отмена"),e("button",{onClick:V,class:"px-3 py-1 bg-indigo-600 text-white"},"Сохранить")])])])):p("",!0)]))}},_t={class:"relative overflow-hidden"},$t={class:"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-white"},Ct={class:"flex items-start gap-4"},jt={class:"flex-1"},Vt={class:"text-2xl sm:text-3xl font-semibold"},St={class:"mt-2 flex flex-wrap items-center gap-2 text-sm"},Ut={class:"px-2 py-1 rounded-full bg-white/20"},Mt={class:"px-2 py-1 rounded-full bg-white/20"},It={class:"px-2 py-1 rounded-full bg-white/20"},Ft={class:"px-2 py-1 rounded-full bg-white/20"},Tt={class:"px-2 py-1 rounded-full bg-white/20"},qt={key:0,class:"px-2 py-1 rounded-full bg-white/20"},Dt={class:"hidden sm:flex items-center gap-3"},zt=["href"],Bt={key:0,class:"mt-3"},Nt={key:1,class:"text-xs text-amber-600 mt-2"},Ht={key:0},Lt={key:2,class:"text-sm mt-2 text-emerald-700"},Ot={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-4 pb-10",style:{"margin-top":"3%"}},Wt={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},At={class:"lg:col-span-2 space-y-4"},Et={class:"rounded-2xl border bg-white dark:bg-gray-800 p-5"},Pt={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},Qt={class:"text-sm font-medium text-gray-900 dark:text-white"},Gt={class:"text-sm font-medium text-gray-900 dark:text-white"},Jt={class:"mt-2"},Kt={class:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},Rt={class:"mt-1 text-xs text-gray-600 dark:text-gray-300"},Xt={class:"flex mt-3 gap-1"},Yt=["onClick","title"],Zt={class:"rounded-2xl border bg-white dark:bg-gray-800 p-5"},es={key:0,class:"flex items-center gap-2"},ts={key:1,class:"mt-4 grid grid-cols-2 gap-2"},ss={key:2,class:"mt-3"},as={key:0,class:"text-sm text-gray-600 dark:text-gray-300"},ls={key:1,class:"flex flex-wrap gap-2"},os=["href"],ds={class:"rounded-2xl border bg-white dark:bg-gray-800 p-5"},is={class:"flex items-center justify-between mb-3"},rs={key:0,class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},ns={key:1,class:"text-sm text-gray-600 dark:text-gray-300"},us={key:2,class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},ps=["onClick"],vs={class:"flex items-start justify-between gap-3"},gs={class:"text-base font-semibold text-gray-900 dark:text-white leading-snug"},cs={class:"mt-2 text-sm text-gray-600 dark:text-gray-300 space-y-1.5"},xs={class:"space-y-4"},ms={class:"rounded-2xl border bg-white dark:bg-gray-800 p-5"},bs={class:"mt-3 space-y-2 text-sm text-gray-700 dark:text-gray-300"},ys={class:"flex justify-between"},ks={class:"font-medium"},fs={class:"flex justify-between"},hs={class:"font-medium"},ws={class:"flex justify-between"},_s={class:"font-medium"},$s={class:"flex justify-between"},Cs={class:"font-medium"},js={class:"flex justify-between"},Vs={class:"font-medium"},Ss={class:"flex justify-between"},Us={key:0,class:"rounded-2xl border bg-white dark:bg-gray-800 p-5"},Ms={key:0,class:"space-y-4"},Is={class:"rounded-2xl border bg-white dark:bg-gray-800 p-5"},Fs={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},Ts={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},qs={class:"relative w-full max-w-md bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6"},Ds={class:"flex items-center justify-between"},zs={key:0,class:"mt-3 text-sm text-rose-600"},Bs=["value"],Ns=["value"],Hs={class:"grid grid-cols-2 gap-4"},Ls={class:"flex justify-end gap-2"},Os=["disabled"],Ws={key:0},As={key:1},Es={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Ps={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg w-full max-w-md p-6"},Qs={class:"mb-3"},Gs={class:"mb-3"},Js={class:"mb-3"},Ks={class:"flex justify-end gap-2 mt-4"},Rs={key:2,class:"fixed inset-0 flex items-center justify-center bg-black/50"},Xs={class:"bg-white p-4 rounded w-96"},Ys=["value"],Zs={class:"flex justify-end gap-2 mt-4"},la={__name:"Show",setup($){var Q;const{props:j}=Pe(),x=j.id,g=(Q=j.auth)==null?void 0:Q.user,k=v(!0),s=v(null),C=v(!1),V=v(""),b=v(null),c=d=>{b.value=d.target.files},i=v(!1),u=v([]),y=v({title:"",executor_id:"",responsible_id:"",start_date:new Date().toISOString().slice(0,10),due_date:""}),T=v(!1),S=v({title:"",start_date:"",due_date:""}),Ie=F(()=>{var d;return!s.value||!g?!1:(s.value.responsibles||[]).some(t=>t.id===g.id)||(((d=s.value.project)==null?void 0:d.managers)||[]).some(t=>t.id===g.id)}),A=d=>d==="high"?"bg-rose-100 text-rose-700 ring-1 ring-rose-200":d==="medium"?"bg-amber-100 text-amber-700 ring-1 ring-amber-200":"bg-emerald-100 text-emerald-700 ring-1 ring-emerald-200",E=d=>d==="high"?"Высокая":d==="medium"?"Средняя":"Обычная",L=async()=>{k.value=!0;try{const{data:d}=await m.get(`/api/tasks/${x}`,{withCredentials:!0});s.value=d,S.value={title:d.title||"",start_date:d.start_date||"",due_date:d.due_date||""}}finally{k.value=!1}},Fe=async()=>{var d,t;try{const{data:n}=await m.put(`/api/tasks/${x}`,S.value,{withCredentials:!0});s.value=n.task,T.value=!1}catch(n){alert(((t=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:t.message)||"Ошибка при обновлении задачи")}},Te=async d=>{try{const{data:t}=await m.patch(`/api/tasks/${x}/progress`,{progress:d},{withCredentials:!0});s.value.progress=t.progress}catch{alert("Недостаточно прав для обновления прогресса.")}},qe=async()=>{var t;if(!((t=b.value)!=null&&t.length))return alert("Выберите файлы");const d=new FormData;for(let n=0;n<b.value.length;n++)d.append("files[]",b.value[n]);try{await m.post(`/api/tasks/${x}/files`,d,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}),b.value=null,await L()}catch{alert("Ошибка при загрузке файлов")}},De=async()=>{const{data:d}=await m.get(`/api/projects/${s.value.project.id}/employees`,{withCredentials:!0});u.value=d,i.value=!0},ze=async()=>{var d,t;C.value=!0,V.value="";try{await m.post(`/api/tasks/${x}/subtasks`,{...y.value,task_id:x},{withCredentials:!0}),i.value=!1,y.value={title:"",executor_id:"",responsible_id:"",start_date:new Date().toISOString().slice(0,10),due_date:""},await L()}catch(n){V.value=((t=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:t.message)||"Ошибка при создании подзадачи"}finally{C.value=!1}},P=F(()=>{var d;return(((d=s.value)==null?void 0:d.subtasks)||[]).some(t=>!t.completed)}),Be=F(()=>{var d,t;return((d=s.value)==null?void 0:d.progress)===100&&!((t=s.value)!=null&&t.completed)&&!P.value}),Ne=async()=>{var d,t;try{const{data:n}=await m.patch(`/api/tasks/${x}/complete`,{},{withCredentials:!0});s.value=n.task}catch(n){const U=((t=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:t.message)||"Не удалось завершить задачу";alert(U)}},He=F(()=>{var t,n;const d=(n=(t=j.auth)==null?void 0:t.user)==null?void 0:n.id;return!d||!s.value?!1:(s.value.executors||[]).some(U=>U.id===d)||(s.value.responsibles||[]).some(U=>U.id===d)}),Le=F(()=>{var d,t;return!s.value||!g?!1:(s.value.executors||[]).some(n=>n.id===g.id)||(s.value.responsibles||[]).some(n=>n.id===g.id)||g.id===((t=(d=s.value.project)==null?void 0:d.company)==null?void 0:t.user_id)}),q=v(!1),D=v(null),Oe=async()=>{const{data:d}=await m.get(`/api/projects/${s.value.project.id}/employees`,{withCredentials:!0});u.value=d,q.value=!0},We=async()=>{var d,t;if(D.value)try{const{data:n}=await m.post(`/api/tasks/${x}/watchers`,{user_id:D.value},{withCredentials:!0});s.value.watchers=n.watchers,q.value=!1}catch(n){alert(((t=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:t.message)||"Ошибка при добавлении наблюдателя")}};return W(L),(d,t)=>{var U;const n=Qe("Head");return l(),o(f,null,[B(n,{title:(U=s.value)!=null&&U.title?`Задача — ${s.value.title}`:"Задача"},null,8,["title"]),B(Ke,null,{default:Ge(()=>{var G,J,K,R,X,Y,Z,ee,te,se,ae,le,oe,de,ie,re,ne,ue,pe,ve,ge,ce,xe,me,be,ye,ke,fe,he,we,_e,$e,Ce,je,Ve,Se,Ue;return[e("div",_t,[t[22]||(t[22]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-sky-600 via-indigo-600 to-fuchsia-600 opacity-90"},null,-1)),e("div",$t,[e("div",Ct,[e("div",jt,[e("h1",Vt,r(((G=s.value)==null?void 0:G.title)??"Загрузка…"),1),e("div",St,[e("span",Ut,[t[15]||(t[15]=_(" Проект: ",-1)),e("b",null,r(((K=(J=s.value)==null?void 0:J.project)==null?void 0:K.name)??"—"),1)]),e("span",Mt,[t[16]||(t[16]=_(" Компания: ",-1)),e("b",null,r(((Y=(X=(R=s.value)==null?void 0:R.project)==null?void 0:X.company)==null?void 0:Y.name)??"—"),1)]),e("span",It,[t[17]||(t[17]=_(" От: ",-1)),e("b",null,r(((ee=(Z=s.value)==null?void 0:Z.creator)==null?void 0:ee.name)??"—"),1)]),e("span",Ft,[t[18]||(t[18]=_(" Кому: ",-1)),e("b",null,r((se=(te=s.value)==null?void 0:te.executors)!=null&&se.length?s.value.executors.map(a=>a.name).join(", "):"—"),1)]),e("span",Tt,[t[19]||(t[19]=_(" Ответственный: ",-1)),e("b",null,r((le=(ae=s.value)==null?void 0:ae.responsibles)!=null&&le.length?s.value.responsibles.map(a=>a.name).join(", "):"—"),1)]),s.value&&s.value.watchers?(l(),o("span",qt,[t[20]||(t[20]=_(" Наблюдатели: ",-1)),e("b",null,r(s.value.watchers.map(a=>a.name).join(", ")||"—"),1)])):p("",!0),s.value?(l(),o("span",{key:1,class:N(["px-2 py-1 rounded-full ring-1 bg-white text-gray-900",A(s.value.priority)])},[t[21]||(t[21]=_(" Приоритет: ",-1)),e("b",null,r(E(s.value.priority)),1)],2)):p("",!0)])]),e("div",Dt,[(de=(oe=s.value)==null?void 0:oe.project)!=null&&de.id?(l(),o("a",{key:0,href:`/projects/${s.value.project.id}`,class:"rounded-xl bg-white text-gray-900 hover:bg-white/90 px-4 py-2 font-medium"}," К проекту ",8,zt)):p("",!0)]),e("button",{onClick:t[0]||(t[0]=a=>T.value=!0),class:"rounded-xl bg-blue-600 text-white px-4 py-2 hover:bg-blue-700"}," ✏️ Изменить "),e("button",{onClick:Oe,class:"rounded bg-blue-600 text-white px-3 py-1 hover:bg-blue-700"}," ➕ Добавить наблюдателя "),He.value?(l(),o("div",Bt,[Be.value?(l(),o("button",{key:0,onClick:Ne,class:"px-4 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700",title:"Завершить задачу"}," Завершить задачу ")):((ie=s.value)==null?void 0:ie.progress)===100&&!((re=s.value)!=null&&re.completed)?(l(),o("div",Nt,[P.value?(l(),o("span",Ht," Есть незавершённые подзадачи — завершите их, чтобы закрыть задачу. ")):p("",!0)])):p("",!0),(ne=s.value)!=null&&ne.completed?(l(),o("div",Lt," Завершена "+r(((ue=s.value)==null?void 0:ue.completed_at)||""),1)):p("",!0)])):p("",!0)])])]),e("div",Ot,[e("div",Wt,[e("div",At,[e("div",Et,[e("div",Pt,[e("div",null,[t[23]||(t[23]=e("div",{class:"text-xs text-gray-500"},"Дата начала",-1)),e("div",Qt,r(((pe=s.value)==null?void 0:pe.start_date)??"—"),1)]),e("div",null,[t[24]||(t[24]=e("div",{class:"text-xs text-gray-500"},"Дата окончания",-1)),e("div",Gt,r(((ve=s.value)==null?void 0:ve.due_date)??"—"),1)]),e("div",null,[t[25]||(t[25]=e("div",{class:"text-xs text-gray-500"},"Прогресс",-1)),e("div",Jt,[e("div",Kt,[e("div",{class:"h-2 bg-emerald-500",style:Je({width:(((ge=s.value)==null?void 0:ge.progress)||0)+"%"})},null,4)]),e("div",Rt,"Выполнено "+r(((ce=s.value)==null?void 0:ce.progress)??0)+"%",1)]),e("div",Xt,[(l(),o(f,null,w(11,a=>{var I;return e("button",{key:a,onClick:O=>Te((a-1)*10),class:N(["flex-1 h-5 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300",{"!bg-emerald-500":(((I=s.value)==null?void 0:I.progress)||0)>=(a-1)*10}]),title:`${(a-1)*10}%`},null,10,Yt)}),64))])])])]),e("div",Zt,[Le.value?(l(),o("div",es,[e("input",{type:"file",multiple:"",onChange:c,accept:".pdf,.doc,.docx,.xls,.xlsx",class:"text-sm text-gray-600 dark:text-gray-300"},null,32),e("button",{onClick:qe,class:"rounded-xl bg-indigo-600 text-white px-4 py-2 hover:bg-indigo-700"}," Загрузить ")])):p("",!0),k.value?(l(),o("div",ts,[(l(),o(f,null,w(4,a=>e("div",{key:a,class:"h-8 rounded-lg bg-gray-200 dark:bg-gray-700 animate-pulse"})),64))])):(l(),o("div",ss,[(me=(xe=s.value)==null?void 0:xe.files)!=null&&me.length?(l(),o("div",ls,[(l(!0),o(f,null,w(s.value.files,a=>(l(),o("a",{key:a.id,href:`/api/tasks/files/${a.id}`,class:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-100"},[t[26]||(t[26]=e("svg",{class:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12V8l-4-6zM6 22V4h7v5h5v13H6z"})],-1)),_(" "+r(a.file_path.split("/").pop()),1)],8,os))),128))])):(l(),o("div",as," Файлы не прикреплены. "))]))]),e("div",ds,[e("div",is,[t[27]||(t[27]=e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Подзадачи",-1)),Ie.value?(l(),o("button",{key:0,onClick:De,class:"rounded-xl bg-emerald-600 text-white px-4 py-2 hover:bg-emerald-700"}," + Подзадача ")):p("",!0)]),k.value?(l(),o("div",rs,[(l(),o(f,null,w(4,a=>e("div",{key:a,class:"rounded-xl border p-4 animate-pulse"},t[28]||(t[28]=[e("div",{class:"h-4 w-1/2 bg-gray-200 dark:bg-gray-700 rounded mb-3"},null,-1),e("div",{class:"h-3 w-2/3 bg-gray-200 dark:bg-gray-700 rounded mb-2"},null,-1),e("div",{class:"h-3 w-1/2 bg-gray-200 dark:bg-gray-700 rounded"},null,-1)]))),64))])):(ye=(be=s.value)==null?void 0:be.subtasks)!=null&&ye.length?(l(),o("div",us,[(l(!0),o(f,null,w(s.value.subtasks,a=>{var I,O;return l(),o("div",{key:a.id,class:"group rounded-xl border p-4 bg-white dark:bg-gray-800 hover:shadow-md transition cursor-pointer",onClick:z=>d.$inertia.visit(`/subtasks/${a.id}`)},[e("div",vs,[e("h3",gs,r(a.title),1)]),e("div",cs,[e("div",null,[t[29]||(t[29]=_(" Исполнитель: ",-1)),e("b",null,r(((I=a.executors)==null?void 0:I.map(z=>z.name).join(", "))||"—"),1)]),e("div",null,[t[30]||(t[30]=_(" Ответсвенный: ",-1)),e("b",null,r(((O=a.responsibles)==null?void 0:O.map(z=>z.name).join(", "))||"—"),1)]),e("div",null,"Сроки: "+r(a.start_date)+" — "+r(a.due_date),1)])],8,ps)}),128))])):(l(),o("div",ns," Подзадач пока нет. "))])]),e("div",xs,[e("div",ms,[t[37]||(t[37]=e("h3",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Кратко о задаче",-1)),e("dl",bs,[e("div",ys,[t[31]||(t[31]=e("dt",null,"Автор",-1)),e("dd",ks,r(((fe=(ke=s.value)==null?void 0:ke.creator)==null?void 0:fe.name)??"—"),1)]),e("div",fs,[t[32]||(t[32]=e("dt",null,"Исполнитель",-1)),e("dd",hs,r((we=(he=s.value)==null?void 0:he.executors)!=null&&we.length?s.value.executors.map(a=>a.name).join(", "):"—"),1)]),e("div",ws,[t[33]||(t[33]=e("dt",null,"Ответственный",-1)),e("dd",_s,r(($e=(_e=s.value)==null?void 0:_e.responsibles)!=null&&$e.length?s.value.responsibles.map(a=>a.name).join(", "):"—"),1)]),e("div",$s,[t[34]||(t[34]=e("dt",null,"Проект",-1)),e("dd",Cs,r(((je=(Ce=s.value)==null?void 0:Ce.project)==null?void 0:je.name)??"—"),1)]),e("div",js,[t[35]||(t[35]=e("dt",null,"Компания",-1)),e("dd",Vs,r(((Ue=(Se=(Ve=s.value)==null?void 0:Ve.project)==null?void 0:Se.company)==null?void 0:Ue.name)??"—"),1)]),e("div",Ss,[t[36]||(t[36]=e("dt",null,"Приоритет",-1)),e("dd",null,[s.value?(l(),o("span",{key:0,class:N(["px-2 py-1 text-xs rounded-full ring-1",A(s.value.priority)])},r(E(s.value.priority)),3)):p("",!0)])])])]),s.value?(l(),o("div",Us,[B(wt,{"task-id":s.value.id,executors:s.value.executors,responsibles:s.value.responsibles,creator:s.value.creator},null,8,["task-id","executors","responsibles","creator"])])):p("",!0)]),s.value?(l(),o("div",Ms,[e("div",Is,[t[38]||(t[38]=e("h3",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Чат",-1)),B(nt,{"task-id":s.value.id,"can-chat":!0},null,8,["task-id"])])])):(l(),o("div",Fs,"Загрузка…"))])]),i.value?(l(),o("div",Ts,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[1]||(t[1]=a=>i.value=!1)}),e("div",qs,[e("div",Ds,[t[39]||(t[39]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Новая подзадача",-1)),e("button",{onClick:t[2]||(t[2]=a=>i.value=!1),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"},"✕")]),V.value?(l(),o("p",zs,r(V.value),1)):p("",!0),e("form",{class:"mt-4 space-y-4",onSubmit:Me(ze,["prevent"])},[e("div",null,[t[40]||(t[40]=e("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Название",-1)),h(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>y.value.title=a),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:""},null,512),[[M,y.value.title]])]),e("div",null,[t[42]||(t[42]=e("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Исполнитель",-1)),h(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>y.value.executor_id=a),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:""},[t[41]||(t[41]=e("option",{disabled:"",value:""},"Выберите сотрудника",-1)),(l(!0),o(f,null,w(u.value,a=>(l(),o("option",{key:a.id,value:a.id},r(a.name),9,Bs))),128))],512),[[H,y.value.executor_id]])]),e("div",null,[t[44]||(t[44]=e("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Ответственный",-1)),h(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>y.value.responsible_id=a),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:""},[t[43]||(t[43]=e("option",{disabled:"",value:""},"Выберите сотрудника",-1)),(l(!0),o(f,null,w(u.value,a=>(l(),o("option",{key:a.id,value:a.id},r(a.name),9,Ns))),128))],512),[[H,y.value.responsible_id]])]),e("div",Hs,[e("div",null,[t[45]||(t[45]=e("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Начало",-1)),h(e("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=a=>y.value.start_date=a),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:""},null,512),[[M,y.value.start_date]])]),e("div",null,[t[46]||(t[46]=e("label",{class:"block text-sm mb-1 text-gray-700 dark:text-gray-300"},"Окончание",-1)),h(e("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=a=>y.value.due_date=a),class:"w-full rounded-xl border px-3 py-2 bg-white dark:bg-gray-700 dark:text-white",required:""},null,512),[[M,y.value.due_date]])])]),e("div",Ls,[e("button",{type:"button",onClick:t[8]||(t[8]=a=>i.value=!1),class:"px-4 py-2 rounded-xl border bg-white dark:bg-gray-700 dark:text-white"},"Отмена"),e("button",{type:"submit",disabled:C.value,class:"px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-60"},[C.value?(l(),o("span",As,"Сохраняю…")):(l(),o("span",Ws,"Создать"))],8,Os)])],32)])])):p("",!0),T.value?(l(),o("div",Es,[e("div",Ps,[t[51]||(t[51]=e("h2",{class:"text-lg font-semibold mb-4 text-gray-900 dark:text-white"},"Редактировать задачу",-1)),e("form",{onSubmit:Me(Fe,["prevent"])},[e("div",Qs,[t[47]||(t[47]=e("label",{class:"block text-sm text-gray-700 dark:text-gray-300"},"Название",-1)),h(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>S.value.title=a),type:"text",class:"w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},null,512),[[M,S.value.title]])]),e("div",Gs,[t[48]||(t[48]=e("label",{class:"block text-sm"},"Дата начала",-1)),h(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>S.value.start_date=a),type:"date",class:"w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},null,512),[[M,S.value.start_date]])]),e("div",Js,[t[49]||(t[49]=e("label",{class:"block text-sm"},"Дата окончания",-1)),h(e("input",{"onUpdate:modelValue":t[11]||(t[11]=a=>S.value.due_date=a),type:"date",class:"w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-white"},null,512),[[M,S.value.due_date]])]),e("div",Ks,[e("button",{type:"button",onClick:t[12]||(t[12]=a=>T.value=!1),class:"px-4 py-2 border rounded"},"Отмена"),t[50]||(t[50]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"},"Сохранить",-1))])],32)])])):p("",!0),q.value?(l(),o("div",Rs,[e("div",Xs,[t[52]||(t[52]=e("h3",{class:"font-semibold mb-3"},"Выберите наблюдателя",-1)),h(e("select",{"onUpdate:modelValue":t[13]||(t[13]=a=>D.value=a),class:"w-full border p-2 rounded"},[(l(!0),o(f,null,w(u.value,a=>(l(),o("option",{key:a.id,value:a.id},r(a.name),9,Ys))),128))],512),[[H,D.value]]),e("div",Zs,[e("button",{onClick:t[14]||(t[14]=a=>q.value=!1),class:"px-3 py-1 border rounded"},"Отмена"),e("button",{onClick:We,class:"px-3 py-1 bg-blue-600 text-white rounded"},"Добавить")])])])):p("",!0)]}),_:1})],64)}}};export{la as default};
