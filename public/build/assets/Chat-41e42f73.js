import{Q as I,r as i,x as K,o as a,G as P,J as U,f as w,k as W,u as G,Z as J,a as t,c as r,b as y,d as v,e as _,E as g,t as u,F as C,h as D,v as F,O,g as Q,D as Z}from"./app-7fd3e59a.js";import{_ as q}from"./AuthenticatedLayout-0ec675ca.js";import{_ as R}from"./_plugin-vue_export-helper-c27b6911.js";import"./ApplicationLogo-7470614f.js";const X={class:"h-[calc(100vh-80px)] max-w-7xl mx-auto p-4 md:p-6 grid grid-cols-1 md:grid-cols-[320px,1fr] gap-6 items-start"},Y={class:"h-full flex flex-col bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden"},ee={class:"flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar"},te={key:0,class:"flex justify-center p-4"},se={key:1,class:"text-center py-10 text-slate-400 text-sm"},ae=["onClick"],le={class:"flex justify-between items-start mb-1"},re={class:"text-[10px] text-slate-400"},oe={class:"text-sm font-semibold text-slate-800 dark:text-slate-200 truncate mb-1"},ne={class:"h-full flex flex-col bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden relative"},de={class:"h-16 px-6 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between shrink-0 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md z-10"},ie={class:"flex items-center gap-3"},ue={class:"w-10 h-10 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm"},ce={class:"font-bold text-slate-800 dark:text-slate-100"},pe={class:"text-xs text-slate-500 flex items-center gap-1"},ve={key:0,class:"flex items-center gap-1"},he={key:1},be={key:0,class:"h-full flex flex-col items-center justify-center text-slate-400 opacity-60"},xe={key:1,class:"flex justify-center py-10"},ge={class:"max-w-[80%] md:max-w-[70%] group relative"},fe={key:0,class:"whitespace-pre-wrap break-words"},me={key:1,class:"mt-3 flex flex-wrap gap-2"},ke=["href"],we=["src"],ye={key:1,class:"flex items-center gap-2 px-3 py-2 bg-black/10 rounded-lg"},_e={class:"text-xs truncate max-w-[150px]"},Ce={key:0,class:"p-4 bg-white dark:bg-slate-900 border-t border-slate-100 dark:border-slate-800"},je={key:0,class:"mb-3 animate-fade-in"},Me={key:1,class:"flex flex-wrap gap-2 mb-3 p-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-100 dark:border-slate-700"},Te={class:"text-xs text-slate-600 dark:text-slate-300 max-w-[150px] truncate"},Be=["onClick"],ze={class:"flex items-end gap-3"},$e={class:"flex-1 relative"},Ve=["disabled"],De={key:0,class:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24"},Fe={key:1,class:"w-5 h-5 translate-x-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},He={key:1,class:"p-4 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-slate-800 text-center text-sm text-slate-500"},Ne={__name:"Chat",setup(Le){const{props:H}=I();H.auth.user;const m=i([]),o=i(null),h=i([]),j=i(!1),M=i(!1),x=i(!1),f=i(""),c=i(""),d=i([]),k=i(null),N=l=>l?new Date(l).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",L=async()=>{j.value=!0;try{const{data:l}=await w.get("/api/support/threads");m.value=l}catch(l){console.error(l)}j.value=!1},T=async()=>{await Z(),k.value&&(k.value.scrollTop=k.value.scrollHeight)},A=async l=>{o.value=l,h.value=[],M.value=!0;try{const{data:e}=await w.get(`/api/support/threads/${l.id}`);h.value=e.messages,T()}catch(e){console.error(e)}M.value=!1},B=async()=>{if(!c.value.trim()&&!d.value.length)return;const l=new FormData;l.append("subject",f.value||""),l.append("message",c.value||""),d.value.forEach((e,p)=>l.append(`files[${p}]`,e)),x.value=!0;try{const{data:e}=await w.post("/api/support/threads",l,{headers:{"Content-Type":"multipart/form-data"}});m.value.unshift(e),o.value=e,h.value=e.messages||[],f.value="",c.value="",d.value=[],T()}catch(e){console.error(e)}x.value=!1},z=async()=>{if(!o.value)return B();if(o.value.status==="closed"){alert("Обращение закрыто. Нельзя отправлять сообщения.");return}if(!c.value.trim()&&!d.value.length)return;const l=new FormData;l.append("message",c.value||""),d.value.forEach((e,p)=>l.append(`files[${p}]`,e)),x.value=!0;try{const{data:e}=await w.post(`/api/support/threads/${o.value.id}/messages`,l,{headers:{"Content-Type":"multipart/form-data"}});h.value.push(e),c.value="",d.value=[],T()}catch(e){console.error(e)}x.value=!1},E=l=>{var p;const e=((p=l.clipboardData)==null?void 0:p.items)||[];for(const s of e)if(s.kind==="file"){const n=s.getAsFile();n&&n.type.startsWith("image/")&&(d.value.push(n),l.preventDefault())}},S=l=>{d.value.splice(l,1)},$=()=>{o.value=null,h.value=[],f.value=""};return K(L),(l,e)=>(a(),P(q,null,{default:U(()=>{var p;return[W(G(J),{title:"Техподдержка"}),t("div",X,[t("div",Y,[t("div",{class:"p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50"},[e[6]||(e[6]=t("h2",{class:"font-bold text-slate-700 dark:text-slate-200"},"Ваши обращения",-1)),t("button",{onClick:$,class:"p-2 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 dark:bg-blue-900/30 dark:text-blue-400 transition-colors",title:"Новое обращение"},e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z","clip-rule":"evenodd"})],-1)]))]),t("div",ee,[j.value?(a(),r("div",te,e[7]||(e[7]=[t("svg",{class:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):m.value.length===0?(a(),r("div",se,e[8]||(e[8]=[y(" Нет активных диалогов.",-1),t("br",null,null,-1),y("Создайте новый! ",-1)]))):v("",!0),(a(!0),r(C,null,_(m.value,s=>{var n;return a(),r("div",{key:s.id,onClick:b=>A(s),class:g(["group p-3 rounded-xl cursor-pointer transition-all duration-200 border border-transparent",((n=o.value)==null?void 0:n.id)===s.id?"bg-blue-50 border-blue-100 dark:bg-blue-900/20 dark:border-blue-800":"hover:bg-slate-50 dark:hover:bg-slate-800"])},[t("div",le,[t("span",{class:g(["text-xs font-medium px-2 py-0.5 rounded-md",s.status==="open"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-slate-100 text-slate-500 dark:bg-slate-800 dark:text-slate-400"])},u(s.status==="open"?"В работе":"Закрыт"),3),t("span",re," #"+u(s.id),1)]),t("div",oe,u(s.subject||"Без темы"),1)],10,ae)}),128))])]),t("div",ne,[t("div",de,[t("div",ie,[t("div",ue,u(o.value?"S":"N"),1),t("div",null,[t("div",ce,u(o.value?o.value.subject||"Обращение #"+o.value.id:"Новое обращение"),1),t("div",pe,[o.value?(a(),r("span",ve,[t("span",{class:g(["w-1.5 h-1.5 rounded-full",o.value.status==="open"?"bg-green-500":"bg-slate-400"])},null,2),y(" "+u(o.value.status==="open"?"Открыто":"Закрыто"),1)])):(a(),r("span",he,"Заполните форму ниже"))])])])]),t("div",{ref_key:"messagesContainer",ref:k,class:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 dark:bg-[#0B1120] custom-scrollbar"},[!o.value&&h.value.length===0?(a(),r("div",be,e[9]||(e[9]=[t("svg",{class:"w-16 h-16 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),t("p",null,"История сообщений пуста",-1)]))):v("",!0),M.value?(a(),r("div",xe,e[10]||(e[10]=[t("svg",{class:"animate-spin h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):v("",!0),(a(!0),r(C,null,_(h.value,s=>{var n;return a(),r("div",{key:s.id,class:g(["flex w-full",s.is_support?"justify-start":"justify-end"])},[t("div",ge,[t("div",{class:g(["rounded-2xl px-4 py-3 shadow-sm text-[15px] leading-relaxed",[s.is_support?"bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200 border border-slate-100 dark:border-slate-700 rounded-tl-none":"bg-blue-600 text-white rounded-tr-none"]])},[s.body?(a(),r("div",fe,u(s.body),1)):v("",!0),(n=s.attachments)!=null&&n.length?(a(),r("div",me,[(a(!0),r(C,null,_(s.attachments,b=>{var V;return a(),r("div",{key:b.id,class:"relative group/file"},[t("a",{href:`/storage/${b.path}`,target:"_blank",class:"block overflow-hidden rounded-lg border border-white/20"},[(V=b.mime_type)!=null&&V.startsWith("image")?(a(),r("img",{key:0,src:`/storage/${b.path}`,class:"max-w-[200px] max-h-[150px] object-cover hover:scale-105 transition-transform"},null,8,we)):(a(),r("div",ye,[e[11]||(e[11]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)),t("span",_e,u(b.original_name),1)]))],8,ke)])}),128))])):v("",!0)],2),t("div",{class:g(["text-[10px] text-slate-400 mt-1 px-1 opacity-0 group-hover:opacity-100 transition-opacity",s.is_support?"text-left":"text-right"])},u(N(s.created_at)),3)])],2)}),128))],512),!o.value||o.value.status!=="closed"?(a(),r("div",Ce,[o.value?v("",!0):(a(),r("div",je,[D(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),type:"text",placeholder:"Тема обращения (кратко)",class:"w-full text-sm font-semibold px-4 py-2 bg-slate-50 dark:bg-slate-800 border-none rounded-lg focus:ring-1 focus:ring-blue-500 placeholder:font-normal"},null,512),[[F,f.value]])])),d.value.length?(a(),r("div",Me,[(a(!0),r(C,null,_(d.value,(s,n)=>(a(),r("div",{key:n,class:"flex items-center gap-2 bg-white dark:bg-slate-900 px-2 py-1 rounded-md shadow-sm border border-slate-200 dark:border-slate-700"},[t("span",Te,u(s.name),1),t("button",{onClick:b=>S(n),class:"text-slate-400 hover:text-red-500"},e[12]||(e[12]=[t("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Be)]))),128))])):v("",!0),t("div",ze,[t("div",$e,[D(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),rows:"1",onInput:e[2]||(e[2]=s=>{s.target.style.height="auto",s.target.style.height=s.target.scrollHeight+"px"}),class:"w-full max-h-32 min-h-[44px] py-2.5 pl-4 pr-4 bg-slate-100 dark:bg-slate-800 border-transparent focus:border-blue-500 focus:bg-white dark:focus:bg-slate-900 focus:ring-0 rounded-2xl text-sm resize-none overflow-hidden transition-all",placeholder:"Напишите сообщение... ",onPaste:E,onKeydown:e[3]||(e[3]=O(Q(s=>o.value?z():B(),["exact","prevent"]),["enter"]))},null,544),[[F,c.value]])]),t("button",{onClick:e[4]||(e[4]=s=>o.value?z():B()),disabled:x.value||!c.value.trim()&&!d.value.length,class:"p-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg shadow-blue-600/30 disabled:opacity-50 disabled:shadow-none transition-all transform hover:scale-105 active:scale-95"},[x.value?(a(),r("svg",De,e[13]||(e[13]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(a(),r("svg",Fe,e[14]||(e[14]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])))],8,Ve)])])):v("",!0),((p=o.value)==null?void 0:p.status)==="closed"?(a(),r("div",He,[e[15]||(e[15]=y(" Этот тикет закрыт. ",-1)),t("button",{onClick:$,class:"text-blue-600 hover:underline"},"Создать новый?")])):v("",!0)])])]}),_:1}))}},Ke=R(Ne,[["__scopeId","data-v-f1920de2"]]);export{Ke as default};
