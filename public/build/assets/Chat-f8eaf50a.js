import{r as o,x as M,f as p,o as n,L as N,H as S,c as u,a as t,h as T,v as $,U as j,t as g,d as x,e as B,E as w,g as U,F as V,D as z}from"./app-f33d6ccc.js";import{_ as F}from"./AuthenticatedLayout-2906ac59.js";import"./ApplicationLogo-428f772f.js";import"./_plugin-vue_export-helper-c27b6911.js";const H={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50"},O={class:"bg-white p-6 rounded-lg shadow-xl w-96 text-center"},I={key:0,class:"text-red-500 text-sm mb-2"},J={class:"flex h-96 bg-gray-100"},P={class:"w-64 bg-white border-r border-gray-200 flex flex-col"},q={class:"flex-1 overflow-y-auto"},A=["onClick"],G={class:"truncate"},Q=["onClick"],R={class:"flex-1 flex flex-col relative"},W={key:0,class:"absolute inset-0 bg-white z-10"},X={class:"p-4 border-t border-gray-200 flex items-center space-x-3"},Y=["disabled"],Z=["disabled"],le={__name:"Chat",setup(ee){const d=o([]),r=o([]),l=o(null),i=o(""),c=o(!1),f=o(null),v=o(!0),b=o(""),h=o("");async function _(){try{await p.post("/api/chat/auth",{password:b.value}),v.value=!1,h.value="",await m()}catch{h.value="Неверный пароль",b.value=""}}M(async()=>{try{await m(),v.value=!1}catch(e){e.response&&e.response.status===403&&(v.value=!0)}});async function m(){d.value=(await p.get("/api/chats")).data}async function D(){const e=(await p.post("/api/chats")).data;d.value.unshift(e),k(e)}async function k(e){l.value=e;try{r.value=(await p.get(`/api/chats/${e.id}`)).data,await z(),K()}catch(s){s.response.status===403&&location.reload()}}async function C(){if(!(!i.value||c.value||!l.value)){r.value.push({role:"user",content:i.value}),r.value.push({role:"assistant",content:""}),c.value=!0;try{const s=await(await fetch("/api/chat/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:l.value.id,message:i.value})})).json();r.value.at(-1).content=s.content}catch(e){r.value.at(-1).content="(Ошибка при отправке запроса)",console.error(e)}c.value=!1,i.value=""}}async function E(e){var s;if(confirm(`Удалить "${e.title}"?`))try{await p.delete(`/api/chats/${e.id}`),d.value=d.value.filter(a=>a.id!==e.id),((s=l.value)==null?void 0:s.id)===e.id&&(l.value=null,r.value=[])}catch(a){console.error(a),alert("Ошибка при удалении чата")}}function K(){z(()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)})}return(e,s)=>(n(),N(F,null,{default:S(()=>[v.value?(n(),u("div",H,[t("div",O,[s[2]||(s[2]=t("h2",{class:"text-xl font-bold mb-4"},"Введите пароль доступа",-1)),T(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>b.value=a),onKeyup:j(_,["enter"]),type:"password",placeholder:"Пароль...",class:"w-full border border-gray-300 rounded px-3 py-2 mb-2 focus:ring-2 focus:ring-blue-500 outline-none",autofocus:""},null,544),[[$,b.value]]),h.value?(n(),u("p",I,g(h.value),1)):x("",!0),t("button",{onClick:_,class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition"}," Войти ")])])):x("",!0),t("div",J,[t("aside",P,[t("div",{class:"p-4 border-b border-gray-200 flex items-center justify-between"},[s[3]||(s[3]=t("h2",{class:"font-bold text-lg"},"Чаты",-1)),t("button",{onClick:D,class:"text-white bg-blue-500 hover:bg-blue-600 px-2 py-1 rounded"}," ➕ ")]),t("div",q,[(n(!0),u(V,null,B(d.value,a=>{var y;return n(),u("div",{key:a.id,class:w(["p-3 cursor-pointer hover:bg-gray-100 border-b border-gray-100 flex justify-between items-center",{"bg-gray-200 font-semibold":((y=l.value)==null?void 0:y.id)===a.id}]),onClick:L=>k(a)},[t("span",G,g(a.title),1),t("button",{onClick:U(L=>E(a),["stop"]),class:"ml-2 text-red-500 hover:text-red-700"},"❌",8,Q)],10,A)}),128))])]),t("main",R,[v.value?(n(),u("div",W)):x("",!0),t("div",{ref_key:"chatContainer",ref:f,class:"flex-1 overflow-y-auto p-4 space-y-3"},[(n(!0),u(V,null,B(r.value,(a,y)=>(n(),u("div",{key:y,class:w(a.role==="user"?"text-right":"text-left")},[t("div",{class:w([a.role==="user"?"inline-block bg-blue-500 text-white":"inline-block bg-gray-200 text-gray-900","px-4 py-2 rounded-lg max-w-xs break-words"])},g(a.content),3)],2))),128))],512),t("div",X,[T(t("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>i.value=a),onKeyup:j(C,["enter"]),disabled:c.value||!l.value,type:"text",placeholder:"Напишите сообщение...",class:"flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"},null,40,Y),[[$,i.value]]),t("button",{onClick:C,disabled:c.value||!i.value||!l.value,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg disabled:opacity-50"},g(c.value?"...":"Отправить"),9,Z)])])])]),_:1}))}};export{le as default};
