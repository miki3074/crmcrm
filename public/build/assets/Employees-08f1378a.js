import{l as g,Q as K,m as r,k as B,p as R,o as s,f as o,a as N,u as W,w as D,F as v,Z as X,b as e,h as u,v as x,q as b,s as c,t as i,n as Y,g as y,e as ee}from"./app-ae673a70.js";import{_ as te}from"./AuthenticatedLayout-72adef68.js";import"./ApplicationLogo-f8b9f43f.js";import"./_plugin-vue_export-helper-c27b6911.js";const le={class:"flex items-center justify-between"},ae={class:"max-w-6xl mx-auto py-8 px-4"},se={class:"grid gap-3 md:grid-cols-3 mb-4"},oe=["value"],re={class:"overflow-hidden rounded-2xl border dark:border-gray-700 bg-white dark:bg-gray-900"},de={class:"w-full text-sm"},ne={key:0},ie={key:1},ue={class:"px-4 py-3 font-medium text-gray-900 dark:text-gray-100"},pe={class:"px-4 py-3 text-gray-600 dark:text-gray-300"},me={class:"px-4 py-3 text-gray-600 dark:text-gray-300"},ge={class:"px-4 py-3"},ve={key:0},ye={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50"},xe={class:"w-full max-w-xl rounded-2xl bg-white p-6 shadow-xl dark:bg-gray-900"},be={class:"flex items-center justify-between"},ce={key:0,class:"mt-1 text-xs text-rose-600"},fe={key:0,class:"mt-1 text-xs text-rose-600"},we={class:"grid md:grid-cols-2 gap-3"},ke={key:0,class:"mt-1 text-xs text-rose-600"},_e={class:"grid md:grid-cols-2 gap-3"},he=["value"],Ce={key:0,class:"mt-1 text-xs text-rose-600"},Ue={class:"flex justify-end gap-2 pt-2"},Ve=["disabled"],Se={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4"},je={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-3xl p-4"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3"},Ee=["value"],Fe={class:"mb-3 max-h-64 overflow-auto border rounded p-2"},Me={key:0},$e={class:"font-medium"},qe={class:"text-xs text-gray-500"},Ae={class:"flex items-center gap-2"},ze=["onClick"],Be={class:"flex justify-end gap-2 mt-4"},Ne=["disabled"],Ze={__name:"Employees",setup(De){g.defaults.withCredentials=!0,K();const S=r(!1),k=r(!1),M=r([]),j=r([]),_=r(""),h=r("all"),C=r("all"),f=r(!1),n=r({name:"",email:"",password:"",password_confirmation:"",role:"employee",company_id:""}),p=r({}),$=B(()=>{let a=[...M.value];if(_.value.trim()){const t=_.value.toLowerCase();a=a.filter(l=>{var m,w;return((m=l.name)==null?void 0:m.toLowerCase().includes(t))||((w=l.email)==null?void 0:w.toLowerCase().includes(t))})}return h.value!=="all"&&(a=a.filter(t=>{var l,m;return(((m=(l=t.roles)==null?void 0:l[0])==null?void 0:m.name)??"employee")===h.value})),C.value!=="all"&&(a=a.filter(t=>{var l;return String((l=t.company)==null?void 0:l.id)===String(C.value)})),a}),P=a=>a==="manager"?"bg-indigo-100 text-indigo-700 ring-1 ring-indigo-200":"bg-emerald-100 text-emerald-700 ring-1 ring-emerald-200",O=async()=>{const{data:a}=await g.get("/api/companies");j.value=a},q=async()=>{S.value=!0;try{const{data:a}=await g.get("/api/employees");M.value=a}finally{S.value=!1}},Q=()=>{n.value={name:"",email:"",password:"",password_confirmation:"",role:"employee",company_id:""},p.value={}},T=async()=>{var a;p.value={},k.value=!0;try{await g.get("/sanctum/csrf-cookie"),await g.post("/api/employees",n.value),f.value=!1,Q(),await q()}catch(t){((a=t.response)==null?void 0:a.status)===422?p.value=t.response.data.errors??{}:alert("Не удалось создать сотрудника")}finally{k.value=!1}},U=r(!1),L=r([]),A=r([]),d=r({user_id:"",role:"employee",company_id:""}),E=r(!1),F=r(!1),V=r(""),Z=async()=>{E.value=!0;try{const{data:a}=await g.get("/api/users/for-attach");L.value=a}finally{E.value=!1}},G=async()=>{const{data:a}=await g.get("/api/companies");A.value=a,a.length&&!d.value.company_id&&(d.value.company_id=String(a[0].id))},H=async()=>{U.value=!0,await Promise.all([Z(),G()])},I=B(()=>{if(!V.value)return L.value;const a=V.value.toLowerCase();return L.value.filter(t=>(t.name||"").toLowerCase().includes(a)||(t.email||"").toLowerCase().includes(a))}),J=async()=>{var a,t;if(!(!d.value.user_id||!d.value.company_id||!d.value.role)){F.value=!0;try{const{data:l}=await g.post("/api/employees/attach",{user_id:d.value.user_id,company_id:d.value.company_id,role:d.value.role});U.value=!1,d.value={user_id:"",role:"employee",company_id:d.value.company_id},alert("Пользователь добавлен")}catch(l){console.error(l),alert(((t=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:t.message)||"Ошибка")}finally{F.value=!1}}};return R(async()=>{await Promise.all([O(),q()])}),(a,t)=>(s(),o(v,null,[N(W(X),{title:"Сотрудники"}),N(te,null,{header:D(()=>[e("div",le,[t[16]||(t[16]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Сотрудники",-1)),e("button",{class:"rounded-xl bg-indigo-600 text-white px-4 py-2 hover:bg-indigo-700",onClick:t[0]||(t[0]=l=>f.value=!0)}," + Сотрудник "),e("button",{class:"ms-3 rounded-xl bg-green-600 text-white px-4 py-2 hover:bg-green-700",onClick:H}," Сотрудники 2 ")])]),default:D(()=>[e("div",ae,[e("div",se,[e("div",null,[u(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>_.value=l),placeholder:"Поиск по имени или email…",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[x,_.value]])]),e("div",null,[u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>h.value=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},t[17]||(t[17]=[e("option",{value:"all"},"Все роли",-1),e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[b,h.value]])]),e("div",null,[u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>C.value=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},[t[18]||(t[18]=e("option",{value:"all"},"Все компании",-1)),(s(!0),o(v,null,c(j.value,l=>(s(),o("option",{key:l.id,value:String(l.id)},i(l.name),9,oe))),128))],512),[[b,C.value]])])]),e("div",re,[e("table",de,[t[21]||(t[21]=e("thead",{class:"bg-gray-50 dark:bg-gray-800"},[e("tr",null,[e("th",{class:"text-left px-4 py-3"},"Имя"),e("th",{class:"text-left px-4 py-3"},"Email"),e("th",{class:"text-left px-4 py-3"},"Компания"),e("th",{class:"text-left px-4 py-3"},"Роль")])],-1)),S.value?(s(),o("tbody",ne,[(s(),o(v,null,c(5,l=>e("tr",{key:l,class:"animate-pulse"},t[19]||(t[19]=[e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-56 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-4 w-40 bg-gray-200 dark:bg-gray-700 rounded"})],-1),e("td",{class:"px-4 py-3"},[e("div",{class:"h-5 w-20 bg-gray-200 dark:bg-gray-700 rounded-full"})],-1)]))),64))])):(s(),o("tbody",ie,[(s(!0),o(v,null,c($.value,l=>{var m,w,z;return s(),o("tr",{key:l.id,class:"border-t dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/60"},[e("td",ue,i(l.name),1),e("td",pe,i(l.email),1),e("td",me,i(((m=l.company)==null?void 0:m.name)??"—"),1),e("td",ge,[e("span",{class:Y(["inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ring-1",P(((z=(w=l.roles)==null?void 0:w[0])==null?void 0:z.name)??"employee")])},i(l.role==="manager"?"Менеджер":"Сотрудник"),3)])])}),128)),$.value.length?y("",!0):(s(),o("tr",ve,t[20]||(t[20]=[e("td",{colspan:"4",class:"px-4 py-6 text-center text-gray-500 dark:text-gray-400"}," Ничего не найдено ",-1)])))]))])])]),f.value?(s(),o("div",ye,[e("div",xe,[e("div",be,[t[22]||(t[22]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Новый сотрудник",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:t[4]||(t[4]=l=>f.value=!1)},"✕")]),e("form",{class:"mt-4 space-y-4",onSubmit:ee(T,["prevent"])},[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm mb-1"},"Имя",-1)),u(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>n.value.name=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[x,n.value.name]]),p.value.name?(s(),o("p",ce,i(p.value.name[0]),1)):y("",!0)]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm mb-1"},"Email",-1)),u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>n.value.email=l),type:"email",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[x,n.value.email]]),p.value.email?(s(),o("p",fe,i(p.value.email[0]),1)):y("",!0)]),e("div",we,[e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm mb-1"},"Пароль",-1)),u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>n.value.password=l),type:"password",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[x,n.value.password]]),p.value.password?(s(),o("p",ke,i(p.value.password[0]),1)):y("",!0)]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm mb-1"},"Подтверждение",-1)),u(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>n.value.password_confirmation=l),type:"password",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},null,512),[[x,n.value.password_confirmation]])])]),e("div",_e,[e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm mb-1"},"Компания",-1)),u(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>n.value.company_id=l),required:"",class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},[t[27]||(t[27]=e("option",{disabled:"",value:""},"Выберите компанию",-1)),(s(!0),o(v,null,c(j.value,l=>(s(),o("option",{key:l.id,value:l.id},i(l.name),9,he))),128))],512),[[b,n.value.company_id]]),p.value.company_id?(s(),o("p",Ce,i(p.value.company_id[0]),1)):y("",!0)]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm mb-1"},"Роль",-1)),u(e("select",{"onUpdate:modelValue":t[10]||(t[10]=l=>n.value.role=l),class:"w-full rounded-lg border px-3 py-2 dark:bg-gray-800 dark:text-white"},t[29]||(t[29]=[e("option",{value:"manager"},"Менеджер",-1),e("option",{value:"employee"},"Сотрудник",-1)]),512),[[b,n.value.role]])])]),e("div",Ue,[e("button",{type:"button",class:"rounded-lg bg-gray-500 px-4 py-2 text-white",onClick:t[11]||(t[11]=l=>f.value=!1)},"Отмена"),e("button",{type:"submit",class:"rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-50",disabled:k.value},i(k.value?"Создаю…":"Создать"),9,Ve)])],32)])])):y("",!0),U.value?(s(),o("div",Se,[e("div",je,[t[35]||(t[35]=e("h3",{class:"text-lg font-semibold mb-3"},"Добавить зарегистрированного пользователя",-1)),e("div",Le,[e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm mb-1"},"Поиск",-1)),u(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>V.value=l),class:"w-full border rounded px-3 py-2",placeholder:"Имя или email"},null,512),[[x,V.value]])]),e("div",null,[t[32]||(t[32]=e("label",{class:"block text-sm mb-1"},"Компания (куда добавить)",-1)),u(e("select",{"onUpdate:modelValue":t[13]||(t[13]=l=>d.value.company_id=l),class:"w-full border rounded px-3 py-2"},[(s(!0),o(v,null,c(A.value,l=>(s(),o("option",{key:l.id,value:String(l.id)},i(l.name),9,Ee))),128))],512),[[b,d.value.company_id]])])]),e("div",Fe,[E.value?(s(),o("div",Me,"Загрузка пользователей...")):(s(!0),o(v,{key:1},c(I.value,l=>(s(),o("div",{key:l.id,class:"flex items-center justify-between gap-3 p-2 hover:bg-gray-50 rounded"},[e("div",null,[e("div",$e,i(l.name),1),e("div",qe,i(l.email),1)]),e("div",Ae,[t[34]||(t[34]=e("label",{class:"text-xs"},"Роль",-1)),u(e("select",{"onUpdate:modelValue":t[14]||(t[14]=m=>d.value.role=m),class:"border rounded px-2 py-1"},t[33]||(t[33]=[e("option",{value:"employee"},"Сотрудник",-1),e("option",{value:"manager"},"Менеджер",-1)]),512),[[b,d.value.role]]),e("button",{onClick:m=>d.value.user_id=l.id,class:"ms-2 px-3 py-1 rounded bg-indigo-600 text-white"},"Выбрать",8,ze)])]))),128))]),e("div",Be,[e("button",{onClick:t[15]||(t[15]=l=>U.value=!1),class:"px-4 py-2 bg-gray-400 text-white rounded"},"Отмена"),e("button",{onClick:J,disabled:F.value,class:"px-4 py-2 bg-green-600 text-white rounded"}," Добавить ",8,Ne)])])])):y("",!0)]),_:1})],64))}};export{Ze as default};
