import{r as p,x as V,o as l,c as o,a as s,F as g,e as y,t as r,E as $,d as m,h as b,v as M,K as T,i as j,b as N,f as x}from"./app-4f3951ff.js";const A={class:"mt-6"},B={key:0,class:"space-y-2"},D=["checked","onChange"],F={key:0,class:"text-sm text-gray-500"},I={key:1,class:"text-gray-500"},U={key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center"},q={class:"bg-white rounded p-6 w-96"},E={key:0,class:"text-sm text-rose-600 mb-2"},O=["value"],S=["value"],z=["value"],K={class:"flex items-center gap-2 mb-2"},L={class:"flex justify-end gap-2"},H={__name:"TaskChecklists",props:{taskId:{type:Number,required:!0},executors:{type:Array,default:()=>[]},responsibles:{type:Array,default:()=>[]},creator:{type:Object,default:()=>null}},setup(i){const u=p(""),k=i,v=p([]),h=p(!1),c=p(!1),a=p({title:"",assigned_to:[],important:!1,files:[]}),f=async()=>{h.value=!0;try{const{data:n}=await x.get(`/api/tasks/${k.taskId}/checklists`);v.value=n}finally{h.value=!1}},C=async()=>{var t,e;u.value="";const n=new FormData;n.append("title",a.value.title),a.value.assigned_to&&n.append("assigned_to",a.value.assigned_to),n.append("important",a.value.important?1:0);for(let d of a.value.files)n.append("files[]",d);try{await x.post(`/api/tasks/${k.taskId}/checklists`,n,{headers:{"Content-Type":"multipart/form-data"}}),c.value=!1,a.value={title:"",assigned_to:"",important:!1,files:[]},await f()}catch(d){if(((t=d.response)==null?void 0:t.status)===422){const w=d.response.data;u.value=w.message||((e=Object.values(w.errors||{})[0])==null?void 0:e[0])||"Ошибка при создании пункта чек-листа."}else u.value="Не удалось создать пункт чек-листа."}},_=async n=>{await x.patch(`/api/checklists/${n.id}/toggle`),await f()};return V(f),(n,t)=>(l(),o("div",A,[t[10]||(t[10]=s("h3",{class:"text-lg font-semibold mb-2"},"Чек-листы",-1)),v.value.length?(l(),o("ul",B,[(l(!0),o(g,null,y(v.value,e=>(l(),o("li",{key:e.id,class:"flex items-center gap-2"},[s("input",{type:"checkbox",checked:e.completed,onChange:d=>_(e)},null,40,D),s("span",{class:$({"font-bold text-red-600":e.important})},r(e.title),3),e.assignee?(l(),o("span",F,"("+r(e.assignee.name)+")",1)):m("",!0)]))),128))])):(l(),o("p",I,"Нет чек-листов")),s("button",{class:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded",onClick:t[0]||(t[0]=e=>c.value=!0)}," Добавить чек-лист "),c.value?(l(),o("div",U,[s("div",q,[t[8]||(t[8]=s("h4",{class:"text-lg font-semibold mb-2"},"Новый пункт чек-листа",-1)),u.value?(l(),o("p",E,r(u.value),1)):m("",!0),b(s("input",{required:"","onUpdate:modelValue":t[1]||(t[1]=e=>a.value.title=e),type:"text",placeholder:"Название",class:"w-full border mb-2 p-2"},null,512),[[M,a.value.title]]),t[9]||(t[9]=s("label",{class:"block text-sm"},"Ответственный",-1)),b(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.value.assigned_to=e),class:"w-full border mb-2 p-2"},[t[6]||(t[6]=s("option",{value:""},"—",-1)),(l(!0),o(g,null,y(i.executors,e=>(l(),o("option",{key:"exec-"+e.id,value:e.id},r(e.name),9,O))),128)),(l(!0),o(g,null,y(i.responsibles,e=>(l(),o("option",{key:"resp-"+e.id,value:e.id},r(e.name),9,S))),128)),i.creator?(l(),o("option",{key:0,value:i.creator.id},r(i.creator.name),9,z)):m("",!0)],512),[[T,a.value.assigned_to]]),s("label",K,[b(s("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>a.value.important=e)},null,512),[[j,a.value.important]]),t[7]||(t[7]=N(" Важно ",-1))]),s("input",{type:"file",multiple:"",onChange:t[4]||(t[4]=e=>a.value.files=Array.from(e.target.files)),class:"mb-4"},null,32),s("div",L,[s("button",{onClick:t[5]||(t[5]=e=>c.value=!1),class:"px-3 py-1 border"},"Отмена"),s("button",{onClick:C,class:"px-3 py-1 bg-indigo-600 text-white"},"Сохранить")])])])):m("",!0)]))}};export{H as _};
