import{Q as z,m as D,k as $,p as E,o as r,f as l,a as j,u as I,w as N,F as S,l as p,Z as L,b as t,t as a,n as V,d as M,g as x,s as Q}from"./app-4ddf8962.js";import{_ as T}from"./AuthenticatedLayout-f8e86824.js";import"./ApplicationLogo-b40f6cbc.js";import"./_plugin-vue_export-helper-c27b6911.js";const U={class:"flex items-center justify-between gap-3"},Z={class:"text-xl font-bold text-gray-800 dark:text-gray-200"},q={key:0,class:"flex items-center gap-2"},A={class:"inline-flex items-center gap-2 text-sm px-3 py-1 rounded-full ring-1 ring-gray-200 dark:ring-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300"},G={key:1,class:"px-3 py-1.5 rounded-md bg-emerald-100 text-emerald-700 text-sm dark:bg-emerald-900/30 dark:text-emerald-300"},H={class:"max-w-4xl mx-auto py-8 px-4"},J={key:0,class:"grid gap-6"},K={class:"bg-white dark:bg-gray-800 rounded-2xl shadow p-6"},O={class:"grid sm:grid-cols-2 gap-4 text-sm"},R={class:"font-medium text-gray-900 dark:text-white"},W={class:"font-medium text-gray-900 dark:text-white"},X={class:"font-medium text-gray-900 dark:text-white"},Y={class:"font-medium text-gray-900 dark:text-white"},tt={class:"mt-6 grid sm:grid-cols-3 gap-4"},et={class:"font-medium text-gray-900 dark:text-white"},st={class:"font-medium text-gray-900 dark:text-white"},at={class:"font-medium text-gray-900 dark:text-white"},rt={class:"bg-white dark:bg-gray-800 rounded-2xl shadow p-6"},lt={class:"flex items-center justify-between mb-3"},ot={class:"text-sm text-gray-500 dark:text-gray-400"},dt={class:"flex mt-2 space-x-1 select-none"},nt=["title","onClick"],it={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-2"},ut={key:1,class:"text-gray-600 dark:text-gray-300"},yt={__name:"Show",setup(ct){var y;const{props:m}=z(),c=m.id,e=D(null),g=(y=m.auth)==null?void 0:y.user,B=async()=>{const{data:o}=await p.get(`/api/subtasks/${c}`);e.value=o},d=$(()=>!e.value||!g?!1:g.id===e.value.executor_id||g.id===e.value.creator_id),v=$(()=>e.value?d.value&&e.value.progress===100&&!e.value.completed:!1),F=async o=>{if(!d.value)return;const{data:s}=await p.patch(`/api/subtasks/${c}/progress`,{progress:o});e.value.progress=s.progress},P=async()=>{if(!v.value||!confirm("Завершить подзадачу?"))return;const{data:o}=await p.patch(`/api/subtasks/${c}/complete`);e.value.completed=o.completed,e.value.completed_at=o.completed_at};return E(B),(o,s)=>(r(),l(S,null,[j(I(L),{title:"Подзадача"}),j(T,null,{header:N(()=>{var n,i;return[t("div",U,[t("h2",Z," Подзадача: "+a(((n=e.value)==null?void 0:n.title)??"Загрузка..."),1),e.value?(r(),l("div",q,[t("span",A,[t("span",{class:V(["w-2 h-2 rounded-full",{"bg-red-500":(e.value.progress??0)<30,"bg-amber-500":(e.value.progress??0)>=30&&(e.value.progress??0)<70,"bg-green-500":(e.value.progress??0)>=70}])},null,2),M(" "+a(e.value.progress??0)+"% ",1)]),v.value?(r(),l("button",{key:0,onClick:P,class:"px-3 py-1.5 rounded-md bg-emerald-600 text-white text-sm hover:bg-emerald-700"}," Завершить ")):e.value.completed?(r(),l("span",G," Завершена • "+a(((i=e.value.completed_at)==null?void 0:i.slice(0,16))??""),1)):x("",!0)])):x("",!0)])]}),default:N(()=>{var n,i,_,k,f,h,b,w;return[t("div",H,[e.value?(r(),l("div",J,[t("div",K,[t("div",O,[t("div",null,[s[0]||(s[0]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Автор",-1)),t("p",R,a((n=e.value.creator)==null?void 0:n.name),1)]),t("div",null,[s[1]||(s[1]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Исполнитель",-1)),t("p",W,a((i=e.value.executor)==null?void 0:i.name),1)]),t("div",null,[s[2]||(s[2]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Дата начала",-1)),t("p",X,a(e.value.start_date),1)]),t("div",null,[s[3]||(s[3]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Дата окончания",-1)),t("p",Y,a(e.value.due_date),1)])]),t("div",tt,[t("div",null,[s[4]||(s[4]=t("p",{class:"text-gray-500 dark:text-gray-400 text-sm"},"Задача",-1)),t("p",et,a((_=e.value.task)==null?void 0:_.title),1)]),t("div",null,[s[5]||(s[5]=t("p",{class:"text-gray-500 dark:text-gray-400 text-sm"},"Проект",-1)),t("p",st,a((f=(k=e.value.task)==null?void 0:k.project)==null?void 0:f.name),1)]),t("div",null,[s[6]||(s[6]=t("p",{class:"text-gray-500 dark:text-gray-400 text-sm"},"Компания",-1)),t("p",at,a((w=(b=(h=e.value.task)==null?void 0:h.project)==null?void 0:b.company)==null?void 0:w.name),1)])])]),t("div",rt,[t("div",lt,[s[7]||(s[7]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Прогресс подзадачи",-1)),t("span",ot,"Выполнено "+a(e.value.progress??0)+"%",1)]),t("div",dt,[(r(),l(S,null,Q(10,u=>{var C;return t("div",{key:u,title:u*10+"%",onClick:gt=>d.value?F(u*10):null,class:V(["h-4 sm:h-5 flex-1 rounded transition",{"cursor-pointer hover:opacity-80":d.value,"bg-green-600":(e.value.progress??0)>=u*10,"bg-gray-200 dark:bg-gray-700":(e.value.progress??0)<u*10,"pointer-events-none opacity-60":(C=e.value)==null?void 0:C.completed}])},null,10,nt)}),64))]),d.value?x("",!0):(r(),l("p",it," Изменять прогресс могут только исполнитель и автор подзадачи. "))])])):(r(),l("div",ut,"Загрузка..."))])]}),_:1})],64))}};export{yt as default};
