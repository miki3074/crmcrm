import{r as u,x as j,f as h,o as i,L as D,H as S,a as t,c as d,e as y,E as g,F as x,t as _,h as E,v as F,U as H,D as w}from"./app-2097a917.js";import{_ as K}from"./AuthenticatedLayout-9323830d.js";import"./ApplicationLogo-fb32f1dc.js";import"./_plugin-vue_export-helper-c27b6911.js";const L={class:"flex h-96 bg-gray-100"},M={class:"w-64 bg-white border-r border-gray-200 flex flex-col"},N={class:"flex-1 overflow-y-auto"},O=["onClick"],U=["onClick"],V=["onClick"],z={class:"flex-1 flex flex-col"},J={class:"p-4 border-t border-gray-200 flex items-center space-x-3"},P=["disabled"],q=["disabled"],W={__name:"Chat",setup(A){const r=u([]),o=u([]),s=u(null),n=u(""),c=u(!1),f=u(null);j(k);async function k(){r.value=(await h.get("/api/chats")).data}async function C(){const e=(await h.post("/api/chats")).data;r.value.unshift(e),b(e)}async function b(e){s.value=e,o.value=(await h.get(`/api/chats/${e.id}`)).data,await w(),T()}async function m(){if(!(!n.value||c.value||!s.value)){o.value.push({role:"user",content:n.value}),o.value.push({role:"assistant",content:""}),c.value=!0;try{const l=await(await fetch("/api/chat/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:s.value.id,message:n.value})})).json();o.value.at(-1).content=l.content}catch(e){o.value.at(-1).content="(Ошибка при отправке запроса)",console.error(e)}c.value=!1,n.value=""}}async function $(e){var l;if(confirm(`Удалить "${e.title}"?`))try{await h.delete(`/api/chats/${e.id}`),r.value=r.value.filter(a=>a.id!==e.id),((l=s.value)==null?void 0:l.id)===e.id&&(s.value=null,o.value=[])}catch(a){console.error(a),alert("Ошибка при удалении чата")}}function T(){w(()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)})}return(e,l)=>(i(),D(K,null,{default:S(()=>[t("div",L,[t("aside",M,[t("div",{class:"p-4 border-b border-gray-200 flex items-center justify-between"},[l[1]||(l[1]=t("h2",{class:"font-bold text-lg"},"Чаты",-1)),t("button",{onClick:C,class:"text-white bg-blue-500 hover:bg-blue-600 px-2 py-1 rounded"}," ➕ ")]),t("div",N,[(i(!0),d(x,null,y(r.value,a=>{var p;return i(),d("div",{key:a.id,onClick:v=>b(a),class:g(["p-3 cursor-pointer hover:bg-gray-100 border-b border-gray-100",{"bg-gray-200 font-semibold":((p=s.value)==null?void 0:p.id)===a.id}])},[(i(!0),d(x,null,y(r.value,v=>(i(),d("div",{key:v.id,class:"chat-item"},[t("span",{onClick:B=>b(v)},_(v.title),9,U),t("button",{onClick:B=>$(v),class:"ml-2 text-red-500"},"❌",8,V)]))),128))],10,O)}),128))])]),t("main",z,[t("div",{ref_key:"chatContainer",ref:f,class:"flex-1 overflow-y-auto p-4 space-y-3"},[(i(!0),d(x,null,y(o.value,(a,p)=>(i(),d("div",{key:p,class:g(a.role==="user"?"text-right":"text-left")},[t("div",{class:g([a.role==="user"?"inline-block bg-blue-500 text-white":"inline-block bg-gray-200 text-gray-900","px-4 py-2 rounded-lg max-w-xs break-words"])},_(a.content),3)],2))),128))],512),t("div",J,[E(t("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>n.value=a),onKeyup:H(m,["enter"]),disabled:c.value||!s.value,type:"text",placeholder:"Напишите сообщение...",class:"flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"},null,40,P),[[F,n.value]]),t("button",{onClick:m,disabled:c.value||!n.value||!s.value,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg disabled:opacity-50"},_(c.value?"...":"Отправить"),9,q)])])])]),_:1}))}};export{W as default};
