import{r as v,o as l,c as r,k as D,u as O,H as F,F as g,Z as T,a as s,d as b,e as f,E as w,t as n,h as N,K as E,v as I,f as $}from"./app-4f3951ff.js";import{_ as J}from"./AuthenticatedLayout-5a8f544d.js";import"./ApplicationLogo-bbbe4689.js";import"./_plugin-vue_export-helper-c27b6911.js";const R={class:"flex h-[80vh] mx-auto bg-white dark:bg-slate-900 rounded-2xl shadow-md overflow-hidden border border-slate-200 dark:border-slate-700"},z={class:"w-1/3 border-r border-slate-200 dark:border-slate-700 overflow-y-auto"},A={key:0,class:"text-slate-500 text-center py-10"},H=["onClick"],K={class:"flex justify-between items-center"},Z={class:"font-medium text-slate-800 dark:text-slate-100 truncate"},q={class:"text-xs text-slate-400"},G={class:"text-sm text-slate-600 dark:text-slate-300 truncate mt-1"},P={class:"text-xs text-slate-400 mt-1 block"},Q={class:"flex-1 flex flex-col"},X={key:0,class:"flex-1 flex items-center justify-center text-slate-500"},Y={key:1,class:"flex flex-col h-full"},ee={class:"p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center"},te={class:"font-semibold text-slate-800 dark:text-slate-100"},se={class:"text-xs text-slate-500"},ae={class:"flex items-center gap-2"},le=["value"],re={class:"p-4 border-b border-slate-200 dark:border-slate-700"},oe={style:{"overflow-wrap":"break-word",width:"58%"},class:"text-sm text-slate-700 dark:text-slate-300"},ne={key:0,class:"mt-2"},de=["href"],ie={key:1,class:"mt-3 space-y-2"},ue=["src"],ce={key:1,controls:"",class:"rounded-lg max-w-xs border"},pe=["src"],me=["href"],xe={class:"flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50 dark:bg-slate-800"},ve={class:"text-xs opacity-70 mb-1"},ge={key:0,class:"text-sm leading-relaxed"},be={key:1,class:"mt-2"},he=["src"],_e={key:1,controls:"",class:"rounded-lg max-w-xs border"},fe=["src"],ye=["href"],ke={class:"text-[10px] opacity-70 mt-1 text-right"},we={class:"p-4 border-t border-slate-200 dark:border-slate-700 flex gap-2 bg-white dark:bg-slate-900"},De={__name:"Index",props:{messages:Object,supportUsers:Array},setup(V){const C=V,y=v({}),k=v({}),M=(o,t)=>{y.value[t]=o.target.files[0]},U=o=>{k.value[o]&&k.value[o].click()},c=v(JSON.parse(JSON.stringify(C.messages))),a=v(null),h=v({}),W=async o=>{var i;const t=h.value[o]??"",d=y.value[o]??null;if(!t.trim()&&!d)return;const e=new FormData;t.trim()&&e.append("reply",t),d&&e.append("file",d);try{const{data:u}=await $.post(`/support/messages/${o}/reply`,e,{headers:{"Content-Type":"multipart/form-data"}}),p=u.reply,m=c.value.data.find(_=>_.id===o);m&&m.replies.push(p),((i=a.value)==null?void 0:i.id)===o&&a.value.replies.push(p),h.value[o]="",y.value[o]=null}catch(u){console.error(u),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞")}},B=async o=>{const t=a.value.newSupport;if(!t)return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞");try{await $.post(`/support/messages/${o}/transfer`,{new_support_id:t}),alert("–û–±—Ä–∞—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω–æ!");const d=c.value.data.find(e=>e.id===o);d&&(d.assigned_support_id=t)}catch(d){console.error(d),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –æ–±—Ä–∞—â–µ–Ω–∏—è")}},L=async o=>{if(!confirm("–ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ?"))return;await $.post(`/support/messages/${o}/close`);const t=c.value.data.find(d=>d.id===o);t&&(t.status="closed")};return(o,t)=>(l(),r(g,null,[D(O(T),{title:"–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞"}),D(J,null,{header:F(()=>t[7]||(t[7]=[s("h2",{class:"font-semibold text-2xl text-slate-800 dark:text-slate-200 flex items-center gap-2"}," üõ† –ü–∞–Ω–µ–ª—å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏ ",-1)])),default:F(()=>{var d;return[s("div",R,[s("div",z,[t[8]||(t[8]=s("div",{class:"p-4 border-b border-slate-200 dark:border-slate-700 font-semibold text-slate-700 dark:text-slate-300"}," –û–±—Ä–∞—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ",-1)),c.value.data.length===0?(l(),r("div",A," –ù–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π. ")):b("",!0),(l(!0),r(g,null,f(c.value.data,e=>{var i;return l(),r("div",{key:e.id,class:w(["p-4 cursor-pointer border-b border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800 transition",((i=a.value)==null?void 0:i.id)===e.id?"bg-blue-50 dark:bg-blue-900/40":""]),onClick:u=>a.value=e},[s("div",K,[s("h3",Z,n(e.user.name),1),s("span",q," #"+n(e.id),1)]),s("p",G,n(e.message),1),s("span",P,n(new Date(e.created_at).toLocaleString()),1)],10,H)}),128))]),s("div",Q,[a.value?(l(),r("div",Y,[s("div",ee,[s("div",null,[s("h3",te,n(a.value.user.name),1),s("p",se,n(a.value.user.email),1)]),s("div",ae,[N(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.value.newSupport=e),class:"border rounded-lg px-2 py-1 text-sm dark:bg-slate-800 dark:text-white"},[t[9]||(t[9]=s("option",{disabled:"",value:""},"–ü–µ—Ä–µ–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ...",-1)),(l(!0),r(g,null,f(C.supportUsers,e=>(l(),r("option",{key:e.id,value:e.id},n(e.name),9,le))),128))],512),[[E,a.value.newSupport]]),s("button",{onClick:t[1]||(t[1]=e=>B(a.value.id)),class:"px-3 py-1 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700"}," –ü–µ—Ä–µ–¥–∞—Ç—å "),s("button",{onClick:t[2]||(t[2]=e=>L(a.value.id)),class:"px-3 py-1 bg-emerald-600 text-white text-sm rounded-lg hover:bg-emerald-700"}," –ó–∞–≤–µ—Ä—à–∏—Ç—å ")])]),s("div",re,[s("p",oe,n(a.value.message),1),a.value.page_url?(l(),r("div",ne,[s("p",{href:a.value.page_url,target:"_blank",class:"text-sm break-all"}," üîó –°—Ç—Ä–∞–Ω–∏—Ü–∞: "+n(a.value.page_url),9,de)])):b("",!0),(d=a.value.attachments)!=null&&d.length?(l(),r("div",ie,[(l(!0),r(g,null,f(a.value.attachments,e=>(l(),r("div",{key:e.id,class:"flex items-start gap-3"},[e.mime_type.startsWith("image")?(l(),r("img",{key:0,src:`/storage/${e.path}`,class:"rounded-lg max-w-xs border"},null,8,ue)):e.mime_type.startsWith("video")?(l(),r("video",ce,[s("source",{src:`/storage/${e.path}`},null,8,pe)])):(l(),r("a",{key:2,href:`/storage/${e.path}`,target:"_blank",class:"text-blue-600 underline"}," üìé "+n(e.original_name),9,me))]))),128))])):b("",!0)]),s("div",xe,[(l(!0),r(g,null,f(a.value.replies,e=>{var i,u,p,m,_,S,j;return l(),r("div",{key:e.id,class:w(["flex",(u=(i=e.user)==null?void 0:i.roles)!=null&&u.some(x=>x.name==="support")?"justify-end":"justify-start"])},[s("div",{class:w(["max-w-[70%] px-4 py-3 rounded-2xl shadow-sm transition",(m=(p=e.user)==null?void 0:p.roles)!=null&&m.some(x=>x.name==="support")?"bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-br-none":"bg-slate-200 dark:bg-slate-700 text-slate-900 dark:text-slate-100 rounded-bl-none"]),style:{"overflow-wrap":"break-word"}},[s("p",ve,n((S=(_=e.user)==null?void 0:_.roles)!=null&&S.some(x=>x.name==="support")?"üõ† –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞":(j=e.user)==null?void 0:j.name),1),e.reply?(l(),r("p",ge,n(e.reply),1)):b("",!0),e.attachment?(l(),r("div",be,[e.attachment.mime_type.startsWith("image")?(l(),r("img",{key:0,src:`/storage/${e.attachment.path}`,class:"rounded-lg max-w-xs border"},null,8,he)):e.attachment.mime_type.startsWith("video")?(l(),r("video",_e,[s("source",{src:`/storage/${e.attachment.path}`},null,8,fe)])):(l(),r("a",{key:2,href:`/storage/${e.attachment.path}`,class:"text-blue-300 underline",target:"_blank"}," üìé "+n(e.attachment.original_name),9,ye))])):b("",!0),s("p",ke,n(new Date(e.created_at).toLocaleTimeString().slice(0,5)),1)],2)],2)}),128))]),s("div",we,[N(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>h.value[a.value.id]=e),type:"text",placeholder:"–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç...",class:"flex-1 border rounded-lg px-3 py-2 text-sm dark:bg-slate-800 dark:text-white"},null,512),[[I,h.value[a.value.id]]]),s("input",{type:"file",class:"hidden",ref:e=>k.value[a.value.id]=e,onChange:t[4]||(t[4]=e=>M(e,a.value.id))},null,544),s("button",{onClick:t[5]||(t[5]=e=>U(a.value.id)),class:"px-3 py-2 bg-slate-200 dark:bg-slate-700 rounded-lg"}," üìé "),s("button",{onClick:t[6]||(t[6]=e=>W(a.value.id)),class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm"}," ‚û§ ")])])):(l(),r("div",X," –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ "))])])]}),_:1})],64))}};export{De as default};
